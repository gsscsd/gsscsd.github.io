<!DOCTYPE html>
<html lang="zh-CN">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="robots" content="noodp" />
        <title>OpenCV计算机视觉编程攻略 - Gsscsd</title><meta name="Description" content="时光划过指缝-阅读挽留时光"><meta property="og:title" content="OpenCV计算机视觉编程攻略" />
<meta property="og:description" content="
Chapter_01 : 基础知识
Chapter_02 : 操作像素
Chapter_03 : 处理图像的颜色
Chapter_04 : 用直方图统计像素
Chapter_05 : 用形态学运算变换图像
Chapter_06  :  图像滤波
Chapter_07 : 提取直线、轮廓和区域
Chapter_08 : 检测兴趣点
Chapter_09 : 描述和匹配兴趣点
Chapter_10 : 估算图像之间的投影关系
Chapter_11  :   三维重建
Chapter_12 : 处理视频序列
Chapter_13  :   跟踪运动物体
Chapter_14  :    实用案列
" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://gsscsd.github.io/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/" /><meta property="og:image" content="https://cdn.jsdelivr.net/gh/gsscsd/BlogImg/20220628173721.png"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2019-03-28T10:20:53+00:00" />
<meta property="article:modified_time" content="2019-03-28T10:20:53+00:00" /><meta property="og:site_name" content="Gsscsd" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://cdn.jsdelivr.net/gh/gsscsd/BlogImg/20220628173721.png"/>

<meta name="twitter:title" content="OpenCV计算机视觉编程攻略"/>
<meta name="twitter:description" content="
Chapter_01 : 基础知识
Chapter_02 : 操作像素
Chapter_03 : 处理图像的颜色
Chapter_04 : 用直方图统计像素
Chapter_05 : 用形态学运算变换图像
Chapter_06  :  图像滤波
Chapter_07 : 提取直线、轮廓和区域
Chapter_08 : 检测兴趣点
Chapter_09 : 描述和匹配兴趣点
Chapter_10 : 估算图像之间的投影关系
Chapter_11  :   三维重建
Chapter_12 : 处理视频序列
Chapter_13  :   跟踪运动物体
Chapter_14  :    实用案列
"/>
<meta name="application-name" content="Gsscsd">
<meta name="apple-mobile-web-app-title" content="Gsscsd"><meta name="theme-color" content="#ffffff"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="manifest" href="/site.webmanifest"><link rel="canonical" href="https://gsscsd.github.io/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/" /><link rel="prev" href="https://gsscsd.github.io/opencv%E4%B9%8Bpractice/" /><link rel="next" href="https://gsscsd.github.io/%E5%89%91%E6%8C%87offer%E4%B9%8B%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E6%95%B0%E5%AD%97/" /><link rel="stylesheet" href="/css/style.min.931bc4ad2d28eb74379d23c35d88889e10d86e4fb73a8e095952c2617800dcce223d542ddf6f22eb6db537ea777ccee425cbdcb03ad216de7941dc3a1574cdfc.css" integrity="sha512-kxvErS0o63Q3nSPDXYiInhDYbk+3Oo4JWVLCYXgA3M4iPVQt328i6221N+p3fM7kJcvcsDrSFt55Qdw6FXTN/A=="><link rel="preload" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.1.1/css/all.min.css"></noscript><link rel="preload" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css" as="style" onload="this.onload=null;this.rel='stylesheet'">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "OpenCV计算机视觉编程攻略",
        "inLanguage": "zh-CN",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/gsscsd.github.io\/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5\/"
        },"image": ["https:\/\/gsscsd.github.io\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "OpenCV","wordcount":  41505 ,
        "url": "https:\/\/gsscsd.github.io\/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5\/","datePublished": "2019-03-28T10:20:53+00:00","dateModified": "2019-03-28T10:20:53+00:00","license": "This work is licensed under a Creative Commons Attribution-NonCommercial 4.0 International License.","publisher": {
            "@type": "Organization",
            "name": "Gsscsd","logo": "https:\/\/cdn.jsdelivr.net\/gh\/gsscsd\/BlogImg\/G_128px.ico"},"author": {
                "@type": "Person",
                "name": "Gsscsd"
            },"description": ""
    }
    </script></head>
    <body data-header-desktop="fixed" data-header-mobile="auto"><script type="text/javascript">(window.localStorage && localStorage.getItem('theme') ? localStorage.getItem('theme') === 'dark' : ('auto' === 'auto' ? window.matchMedia('(prefers-color-scheme: dark)').matches : 'auto' === 'dark')) && document.body.setAttribute('theme', 'dark');</script>

        <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="Gsscsd">Gsscsd</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> 文章 </a><a class="menu-item" href="/tags/"> 标签 </a><a class="menu-item" href="/categories/"> 分类 </a><a class="menu-item" href="/about/"> 关于 </a><a class="menu-item" href="https://github.com/gsscsd" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i>  </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                    <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
                </a>
            </div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="Gsscsd">Gsscsd</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="搜索文章标题或内容..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="搜索">
                            <i class="fas fa-search fa-fw" aria-hidden="true"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="清空">
                            <i class="fas fa-times-circle fa-fw" aria-hidden="true"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin" aria-hidden="true"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        取消
                    </a>
                </div><a class="menu-item" href="/posts/" title="">文章</a><a class="menu-item" href="/tags/" title="">标签</a><a class="menu-item" href="/categories/" title="">分类</a><a class="menu-item" href="/about/" title="">关于</a><a class="menu-item" href="https://github.com/gsscsd" title="GitHub" rel="noopener noreffer" target="_blank"><i class='fab fa-github fa-fw' aria-hidden='true'></i></a><a href="javascript:void(0);" class="menu-item theme-switch" title="切换主题">
                <i class="fas fa-adjust fa-fw" aria-hidden="true"></i>
            </a></div>
    </div>
</header><div class="search-dropdown desktop">
        <div id="search-dropdown-desktop"></div>
    </div>
    <div class="search-dropdown mobile">
        <div id="search-dropdown-mobile"></div>
    </div><main class="main">
                <div class="container"><div class="toc" id="toc-auto">
            <h2 class="toc-title">目录</h2>
            <div class="toc-content" id="toc-content-auto"></div>
        </div><article class="page single"><h1 class="single-title animate__animated animate__flipInX">OpenCV计算机视觉编程攻略</h1><div class="post-meta">
            <div class="post-meta-line"><span class="post-author"><a href="/" title="Author" rel="author" class="author"><i class="fas fa-user-circle fa-fw" aria-hidden="true"></i>Gsscsd</a></span>&nbsp;<span class="post-category">收录于 <a href="/categories/opencv/"><i class="far fa-folder fa-fw" aria-hidden="true"></i>OpenCV</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw" aria-hidden="true"></i>&nbsp;<time datetime="2019-03-28">2019-03-28</time>&nbsp;<i class="fas fa-pencil-alt fa-fw" aria-hidden="true"></i>&nbsp;约 41505 字&nbsp;
                <i class="far fa-clock fa-fw" aria-hidden="true"></i>&nbsp;预计阅读 83 分钟&nbsp;<span id="/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/" class="leancloud_visitors" data-flag-title="OpenCV计算机视觉编程攻略">
                        <i class="far fa-eye fa-fw" aria-hidden="true"></i>&nbsp;<span class=leancloud-visitors-count></span>&nbsp;次阅读
                    </span>&nbsp;</div>
        </div><div class="details toc" id="toc-static"  data-kept="">
                <div class="details-summary toc-title">
                    <span>目录</span>
                    <span><i class="details-icon fas fa-angle-right" aria-hidden="true"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li>
      <ul>
        <li><a href="#chapter_01--基础知识">Chapter_01 : 基础知识</a></li>
        <li><a href="#chapter_02--操作像素">Chapter_02 : 操作像素</a></li>
        <li><a href="#chapter_03--处理图像的颜色">Chapter_03 : 处理图像的颜色</a></li>
        <li><a href="#chapter_04--用直方图统计像素">Chapter_04 : 用直方图统计像素</a></li>
        <li><a href="#chapter_05--用形态学运算变换图像">Chapter_05 : 用形态学运算变换图像</a></li>
        <li><a href="#chapter_06----图像滤波">Chapter_06  :  图像滤波</a></li>
        <li><a href="#chapter_07--提取直线轮廓和区域">Chapter_07 : 提取直线、轮廓和区域</a></li>
        <li><a href="#chapter_08--检测兴趣点">Chapter_08 : 检测兴趣点</a></li>
        <li><a href="#chapter_09--描述和匹配兴趣点">Chapter_09 : 描述和匹配兴趣点</a></li>
        <li><a href="#chapter_10--估算图像之间的投影关系">Chapter_10 : 估算图像之间的投影关系</a></li>
        <li><a href="#chapter_11-----三维重建">Chapter_11  :   三维重建</a></li>
        <li><a href="#chapter_12--处理视频序列">Chapter_12 : 处理视频序列</a></li>
        <li><a href="#chapter_13-----跟踪运动物体">Chapter_13  :   跟踪运动物体</a></li>
        <li><a href="#chapter_14------实用案列">Chapter_14  :    实用案列</a></li>
      </ul>
    </li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><blockquote>
<p>Chapter_01 : 基础知识</p>
<p>Chapter_02 : 操作像素</p>
<p>Chapter_03 : 处理图像的颜色</p>
<p>Chapter_04 : 用直方图统计像素</p>
<p>Chapter_05 : 用形态学运算变换图像</p>
<p>Chapter_06  :  图像滤波</p>
<p>Chapter_07 : 提取直线、轮廓和区域</p>
<p>Chapter_08 : 检测兴趣点</p>
<p>Chapter_09 : 描述和匹配兴趣点</p>
<p>Chapter_10 : 估算图像之间的投影关系</p>
<p>Chapter_11  :   三维重建</p>
<p>Chapter_12 : 处理视频序列</p>
<p>Chapter_13  :   跟踪运动物体</p>
<p>Chapter_14  :    实用案列</p>
</blockquote>
<h3 id="chapter_01--基础知识">Chapter_01 : 基础知识</h3>
<blockquote>
<p>1.图像的水平变换(flip),添加文字（putText）,鼠标的触发事件
2.感兴趣区</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span><span class="lnt">29
</span><span class="lnt">30
</span><span class="lnt">31
</span><span class="lnt">32
</span><span class="lnt">33
</span><span class="lnt">34
</span><span class="lnt">35
</span><span class="lnt">36
</span><span class="lnt">37
</span><span class="lnt">38
</span><span class="lnt">39
</span><span class="lnt">40
</span><span class="lnt">41
</span><span class="lnt">42
</span><span class="lnt">43
</span><span class="lnt">44
</span><span class="lnt">45
</span><span class="lnt">46
</span><span class="lnt">47
</span><span class="lnt">48
</span><span class="lnt">49
</span><span class="lnt">50
</span><span class="lnt">51
</span><span class="lnt">52
</span><span class="lnt">53
</span><span class="lnt">54
</span><span class="lnt">55
</span><span class="lnt">56
</span><span class="lnt">57
</span><span class="lnt">58
</span><span class="lnt">59
</span><span class="lnt">60
</span><span class="lnt">61
</span><span class="lnt">62
</span><span class="lnt">63
</span><span class="lnt">64
</span><span class="lnt">65
</span><span class="lnt">66
</span><span class="lnt">67
</span><span class="lnt">68
</span><span class="lnt">69
</span><span class="lnt">70
</span><span class="lnt">71
</span><span class="lnt">72
</span><span class="lnt">73
</span><span class="lnt">74
</span><span class="lnt">75
</span><span class="lnt">76
</span><span class="lnt">77
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">onMouse</span><span class="p">(</span><span class="kt">int</span> <span class="n">event</span><span class="p">,</span> <span class="kt">int</span> <span class="n">x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">y</span><span class="p">,</span> <span class="kt">int</span> <span class="n">flags</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span><span class="n">param</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//reinterpret_cast允许将任何指针转为任何其他指针类型，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//也允许将任何整数类型转化为任何指针类型以及反向转换。
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="o">*</span><span class="n">im</span> <span class="o">=</span> <span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="n">Mat</span> <span class="o">*&gt;</span><span class="p">(</span><span class="n">param</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">switch</span> <span class="p">(</span><span class="n">event</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="k">case</span> <span class="nl">EVENT_LBUTTONDOWN</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;at(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">x</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;) value is: &#34;</span> <span class="o">&lt;&lt;</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">im</span><span class="o">-&gt;</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)))</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1.图像的水平变换(flip), 添加文字（putText）, 鼠标的触发事件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="cm">/*Mat image;
</span></span></span><span class="line"><span class="cl"><span class="cm">	cout &lt;&lt; &#34;This image is &#34; &lt;&lt; image.rows &lt;&lt; &#34;x&#34; &lt;&lt; image.cols &lt;&lt; &#34;y&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	image = imread(&#34;./images/puppy.bmp&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="cm">	if (image.empty())
</span></span></span><span class="line"><span class="cl"><span class="cm">	{
</span></span></span><span class="line"><span class="cl"><span class="cm">		cout &lt;&lt; &#34;Error reading image...&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="cm">		return 0;
</span></span></span><span class="line"><span class="cl"><span class="cm">	}
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	cout &lt;&lt; &#34;This image is &#34; &lt;&lt; image.rows &lt;&lt; &#34;x&#34; &lt;&lt; image.cols &lt;&lt; &#34;y&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="cm">	cout &lt;&lt; &#34;This image has&#34; &lt;&lt; image.channels() &lt;&lt; &#34;channel(s)&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	setMouseCallback(&#34;image&#34;, onMouse, reinterpret_cast&lt;void*&gt;(&amp;image));
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="cm">	flip(image, result, 1);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	imshow(&#34;flip&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	circle(image, Point(155, 100), 65, 0, 3);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	putText(image, &#34;SHA_CUN&#34;, Point(40, 200), FONT_HERSHEY_PLAIN, 2.0, 255, 2);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	imshow(&#34;sha_cun&#34;,image);*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//2.感兴趣区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/puppy.bmp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">logo</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/smalllogo.png&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;logo&#34;</span><span class="p">,</span> <span class="n">logo</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;logo : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">logo</span><span class="p">.</span><span class="n">channels</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">imageROI</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Rect</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="n">logo</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="n">logo</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">logo</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">logo</span><span class="p">.</span><span class="n">rows</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">logo</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">imageROI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Image_logo&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/puppy.bmp&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imageROI</span> <span class="o">=</span> <span class="n">image</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="n">logo</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="n">logo</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">logo</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">logo</span><span class="p">.</span><span class="n">rows</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">mask</span><span class="p">(</span><span class="n">logo</span><span class="p">);</span> <span class="c1">//必须是灰度图，只复制值不为0的部分（0为黑色， 255为白色）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">logo</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">imageROI</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;image_mask&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>图像像素的遍历:.at()、迭代器、指针</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//1.at()方法实现图像像素的遍历
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Mat</span> <span class="n">grayim</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">Mat</span> <span class="n">colorim</span><span class="p">(</span><span class="mi">600</span><span class="p">,</span> <span class="mi">800</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">grayim</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">grayim</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	  <span class="n">grayim</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">colorim</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">     <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">colorim</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">	   <span class="n">Vec3b</span> <span class="n">pixel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	   <span class="n">pixel</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">//Blue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	   <span class="n">pixel</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">//Green
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	   <span class="n">pixel</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>       <span class="c1">//Red
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	   
</span></span><span class="line"><span class="cl">	   <span class="n">colorim</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">pixel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	 <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">   <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;grayim&#34;</span><span class="p">,</span> <span class="n">grayim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">   <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;colorim&#34;</span><span class="p">,</span> <span class="n">colorim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//2.简单的二值化处理代码
</span></span></span><span class="line"><span class="cl"><span class="c1">//如果，我们只需要图像的轮廓或者边缘的时候，那么其他像素是不是就可以认为噪声，
</span></span></span><span class="line"><span class="cl"><span class="c1">//为了减少数据量和方便计算，此时，我们就可以进行二值化
</span></span></span><span class="line"><span class="cl"><span class="c1">//而且二值化，还能去用来进行图像分割，前景后景分割
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="n">Mat</span> <span class="n">srcImage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="n">srcImage</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;4.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;srcImage1&#34;</span><span class="p">,</span><span class="n">srcImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">srcImage</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">srcImage</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	   <span class="n">Vec3b</span> <span class="n">value</span> <span class="o">=</span> <span class="n">srcImage</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	   
</span></span><span class="line"><span class="cl">	   <span class="k">for</span><span class="p">(</span><span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	   <span class="p">{</span>
</span></span><span class="line"><span class="cl">	    <span class="k">if</span><span class="p">(</span><span class="n">value</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">128</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		   <span class="n">value</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		   <span class="n">value</span><span class="p">[</span><span class="n">h</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	   <span class="p">}</span>
</span></span><span class="line"><span class="cl">	   
</span></span><span class="line"><span class="cl">	   
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="n">srcImage</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">  <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;srcImage2&#34;</span><span class="p">,</span> <span class="n">srcImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//3.使用迭代器遍历矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">grayim</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">colorim</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">MatIterator_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="n">grayit</span><span class="p">,</span> <span class="n">grayend</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">grayit</span> <span class="o">=</span> <span class="n">grayim</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">grayend</span> <span class="o">=</span> <span class="n">grayim</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">();</span> 
</span></span><span class="line"><span class="cl">		<span class="n">grayit</span> <span class="o">!=</span> <span class="n">grayend</span><span class="p">;</span> <span class="n">grayit</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="n">grayit</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">MatIterator_</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span> <span class="n">colorit</span><span class="p">,</span> <span class="n">colorend</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">colorit</span> <span class="o">=</span> <span class="n">colorim</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(),</span> <span class="n">colorend</span> <span class="o">=</span> <span class="n">colorim</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">colorit</span> <span class="o">!=</span> <span class="n">colorend</span><span class="p">;</span> <span class="n">colorit</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">colorit</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">//Blue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">(</span><span class="o">*</span><span class="n">colorit</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">//Green
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">(</span><span class="o">*</span><span class="n">colorit</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">rand</span><span class="p">()</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span> <span class="c1">//Red
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;grayim&#34;</span><span class="p">,</span> <span class="n">grayim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;colorim&#34;</span><span class="p">,</span> <span class="n">colorim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="c1">//4.使用指针来遍历
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">grayim</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">CV_8UC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">colorim</span><span class="p">(</span><span class="mi">800</span><span class="p">,</span> <span class="mi">600</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">grayim</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">grayim</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">grayim</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span> <span class="o">+</span> <span class="n">j</span><span class="p">)</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">colorim</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Vec3b</span> <span class="o">*</span><span class="n">p</span> <span class="o">=</span> <span class="n">colorim</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">colorim</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">i</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">j</span> <span class="o">%</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">p</span><span class="p">[</span><span class="n">j</span><span class="p">][</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;grayim&#34;</span><span class="p">,</span> <span class="n">grayim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;colorim&#34;</span><span class="p">,</span> <span class="n">colorim</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_02--操作像素">Chapter_02 : 操作像素</h3>
<blockquote>
<p>1.创建椒盐噪声
2.创建波浪影响remap()  &mdash;- 重映射
3.扫描图像并访问相邻像素（1、代码的运行时间 2、锐化）
4.增加图片
5.减少图片中颜色的数量(没敲，太麻烦</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span><span class="lnt">688
</span><span class="lnt">689
</span><span class="lnt">690
</span><span class="lnt">691
</span><span class="lnt">692
</span><span class="lnt">693
</span><span class="lnt">694
</span><span class="lnt">695
</span><span class="lnt">696
</span><span class="lnt">697
</span><span class="lnt">698
</span><span class="lnt">699
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">//5.减少图片中颜色的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="cp">#define NTESTS 15
</span></span></span><span class="line"><span class="cl"><span class="cp">#define NITERATIONS 10
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//2.创建波浪影响remap()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">wave</span><span class="p">(</span> <span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//the map functiuons
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">srcX</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">srcY</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//creating the mapping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">srcX</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">j</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">srcY</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">sin</span><span class="p">(</span><span class="n">j</span> <span class="o">/</span> <span class="mf">6.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// horizontal flipping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// srcX.at&lt;float&gt;(i,j)= image.cols-j-1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// srcY.at&lt;float&gt;(i,j)= i;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//applying the mapping
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">remap</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">srcX</span><span class="p">,</span> <span class="n">srcY</span><span class="p">,</span> <span class="n">INTER_LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//3.扫描图像并访问相邻像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">sharpen</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nchannels</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//处理所有的行，（除了第一行和最后一行）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">uchar</span> <span class="o">*</span><span class="n">previous</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>  <span class="c1">//previous row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">const</span> <span class="n">uchar</span> <span class="o">*</span><span class="n">current</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>       <span class="c1">//current row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">const</span> <span class="n">uchar</span> <span class="o">*</span><span class="n">next</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span>      <span class="c1">//next row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span> <span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>                   <span class="c1">//output row
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="n">nchannels</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">nchannels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//应用锐化算子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">*</span><span class="n">output</span><span class="o">++</span> <span class="o">=</span> <span class="n">saturate_cast</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">5</span> <span class="o">*</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>   <span class="o">-</span>   <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="n">nchannels</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">				                             <span class="o">-</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="n">nchannels</span><span class="p">]</span> <span class="o">-</span> <span class="n">previous</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//把未处理的像素设置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//和sharpen一样的功能，只不过用了迭代
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">sharpenIterator</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//must be a gray-level image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">CV_Assert</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">CV_8UC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//initialize iterator at row 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="o">::</span> <span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">+</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="o">::</span> <span class="n">const_iterator</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">-</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="o">::</span> <span class="n">const_iterator</span> <span class="n">itup</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="o">::</span><span class="n">const_iterator</span> <span class="n">itdown</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">+</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//setup output image and iterator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">());</span>   <span class="c1">//allocate if necessary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="o">::</span><span class="n">iterator</span> <span class="n">itout</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">()</span> <span class="o">+</span> <span class="n">result</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">,</span> <span class="o">++</span><span class="n">itout</span><span class="p">,</span> <span class="o">++</span><span class="n">itup</span><span class="p">,</span> <span class="o">++</span><span class="n">itdown</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="n">itout</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">saturate_cast</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">it</span> <span class="o">*</span> <span class="mi">5</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="n">it</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="o">*</span><span class="p">(</span><span class="n">it</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="o">*</span><span class="n">itup</span> <span class="o">-</span> <span class="o">*</span><span class="n">itdown</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the unprocessed pixels to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">sharpen2D</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//构造内核（所有入口都初始化为0）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">kernel</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//对内核赋值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">kernel</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="mf">5.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">kernel</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">kernel</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">kernel</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">kernel</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//对图像滤波
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">filter2D</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">depth</span><span class="p">(),</span> <span class="n">kernel</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//5.减少图片中颜色的数量
</span></span></span><span class="line"><span class="cl"><span class="c1">// 1st version
</span></span></span><span class="line"><span class="cl"><span class="c1">// see recipe Scanning an image with pointers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce</span><span class="p">(</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// get the address of row j
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// version with input/ouput images
</span></span></span><span class="line"><span class="cl"><span class="c1">// see recipe Scanning an image with pointers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduceIO</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="c1">// input image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span>      <span class="c1">// output image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="c1">// number of columns
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nchannels</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// number of channels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">									  <span class="c1">// allocate output image if necessary
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">type</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// get the addresses of input and output row j
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">const</span> <span class="n">uchar</span><span class="o">*</span> <span class="n">data_in</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data_out</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="o">*</span><span class="n">nchannels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="n">data_out</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data_in</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 1
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses the dereference operator *
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce1</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 2
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses the modulo operator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce2</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">v</span> <span class="o">=</span> <span class="o">*</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">=</span> <span class="n">v</span> <span class="o">-</span> <span class="n">v</span><span class="o">%</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 3
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses a binary mask
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce3</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>     <span class="c1">// masking
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">|=</span> <span class="n">div2</span><span class="p">;</span>   <span class="c1">// add div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">							   <span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 4
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses direct pointer arithmetic with a binary mask
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce4</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">step</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">step</span><span class="p">;</span> <span class="c1">// effective width
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>						   <span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">						   <span class="c1">// get the pointer to the image buffer
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="p">(</span><span class="n">data</span> <span class="o">+</span> <span class="n">i</span><span class="p">)</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">data</span> <span class="o">+=</span> <span class="n">step</span><span class="p">;</span>  <span class="c1">// next line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 5
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version recomputes row size each time
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce5</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">+=</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 6
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version optimizes the case of continuous image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce6</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// total number of elements per line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">isContinuous</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// then no padded pixels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">nc</span> <span class="o">=</span> <span class="n">nc</span><span class="o">*</span><span class="n">nl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">nl</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>  <span class="c1">// it is now a 1D array
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">						   <span class="c1">// this loop is executed only once
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>						   <span class="c1">// in case of continuous images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 7
</span></span></span><span class="line"><span class="cl"><span class="c1">// this versions applies reshape on continuous image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce7</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">isContinuous</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// no padded pixels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">image</span><span class="p">.</span><span class="n">reshape</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span>   <span class="c1">// new number of channels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="mi">1</span><span class="p">);</span> <span class="c1">// new number of rows
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// number of columns set accordingly
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="o">*</span><span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span> <span class="c1">// number of columns
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">data</span><span class="o">++</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 8
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version processes the 3 channels inside the loop with Mat_ iterators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce8</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// get iterators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 9
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses iterators on Vec3b
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce9</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// get iterators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">MatIterator_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span> <span class="n">it</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">MatIterator_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span> <span class="n">offset</span><span class="p">(</span><span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="o">*</span><span class="n">it</span> <span class="o">=</span> <span class="o">*</span><span class="n">it</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">offset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 10
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses iterators with a binary mask
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce10</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// div must be a power of 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">						   <span class="c1">// get iterators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// scan all pixels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">&amp;=</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+=</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 11
</span></span></span><span class="line"><span class="cl"><span class="c1">// this versions uses ierators from Mat_ 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce11</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// get iterators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span> <span class="n">cimage</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">cimage</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat_</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">cimage</span><span class="p">.</span><span class="n">end</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="n">it</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 12
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses the at method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce12</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nl</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">// number of lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="c1">// number of columns
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">div2</span> <span class="o">=</span> <span class="n">div</span> <span class="o">&gt;&gt;</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// div2 = div/2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">nl</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// process each pixel ---------------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="c1">// end of line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 13
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses Mat overloaded operators
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce13</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">log</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">div</span><span class="p">))</span> <span class="o">/</span> <span class="n">log</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// mask used to round the pixel value
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">uchar</span> <span class="n">mask</span> <span class="o">=</span> <span class="mh">0xFF</span> <span class="o">&lt;&lt;</span> <span class="n">n</span><span class="p">;</span> <span class="c1">// e.g. for div=16, mask= 0xF0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">							<span class="c1">// perform color reduction
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">image</span> <span class="o">=</span> <span class="p">(</span><span class="n">image</span><span class="o">&amp;</span><span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">mask</span><span class="p">))</span> <span class="o">+</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">,</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Test 14
</span></span></span><span class="line"><span class="cl"><span class="c1">// this version uses a look up table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce14</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">lookup</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">lookup</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span> <span class="o">/</span> <span class="n">div</span><span class="o">*</span><span class="n">div</span> <span class="o">+</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">LUT</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lookup</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">       
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//2.创建波浪影响remap()  ---- 重映射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="cm">/*Mat image = imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="cm">	wave(image, result);
</span></span></span><span class="line"><span class="cl"><span class="cm">
</span></span></span><span class="line"><span class="cl"><span class="cm">	imshow(&#34;result&#34;, result);*/</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////3.扫描图像并访问相邻像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/boldt.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////调用sharpen()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat result_sharpen;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////用来测试函数或者代码段的运行时间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////getTickCount()返回从最近一次计算机开机到当前的时钟周期数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//double time = static_cast&lt;double&gt;(getTickCount());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//sharpen(image, result_sharpen);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////getTickFrequency()返回每秒的时钟数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//time = (static_cast&lt;double&gt;(getTickCount()) - time) / getTickFrequency();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;time_sharpen = &#34; &lt;&lt; time &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;sharpen_Image&#34;, result_sharpen);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////调用sharpenIterator(要使用灰度图)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image3 = imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image3.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;image3&#34;, image3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat result_Iterator;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//double time3 = static_cast&lt;double&gt;(getTickCount());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//sharpenIterator(image3, result_Iterator);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//time3 = (static_cast&lt;double&gt;(getTickCount()) - time3) / getTickFrequency();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;time_Iterator = &#34; &lt;&lt; time3 &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Iterator_Image&#34;, result_Iterator);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////调用sharpen2D()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat result_sharpen2D;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//double time2 = static_cast&lt;double&gt;(getTickCount());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//sharpen2D(image, result_sharpen2D);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//time2 = (static_cast&lt;double&gt;(getTickCount()) - time2) / getTickFrequency();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;time_sharpen2D = &#34; &lt;&lt; time2 &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;sharpen2D_Image&#34;, result_sharpen2D);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//4.增加图片
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//image1 = imread(&#34;./images/boldt.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//image2 = imread(&#34;./images/rain.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image1.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Image1&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Image2&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//addWeighted(image1, 0.7, image2, 0.9, 0, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////using over loaded operator
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////result = 0.7 * image1 + 0.9 * image2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////imshow(&#34;result with operators&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//image2 = imread(&#34;./images/rain.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////imshow(&#34;image2_rain&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;Mat&gt; planes;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//split(image1, planes);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////aadd to blue channel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//planes[0] += image2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////merge the 3 1-channel images into 1 3-channel image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//merge(planes, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Blue channel&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//5.减少图片中颜色的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/boldt.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// time and process the image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="n">int64</span> <span class="n">start</span> <span class="o">=</span> <span class="n">getTickCount</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">colorReduce</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Elapsed time in seconds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">duration</span> <span class="o">=</span> <span class="p">(</span><span class="n">getTickCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">start</span><span class="p">)</span> <span class="o">/</span> <span class="n">getTickFrequency</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// display the image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Duration= &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">duration</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;secs&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">namedWindow</span><span class="p">(</span><span class="s">&#34;Image&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Image&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// test different versions of the function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">int64</span> <span class="n">t</span><span class="p">[</span><span class="n">NTESTS</span><span class="p">],</span> <span class="n">tinit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// timer values set to 0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">NTESTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">images</span><span class="p">[</span><span class="n">NTESTS</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// the versions to be tested
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">typedef</span> <span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">FunctionPointer</span><span class="p">)(</span><span class="n">Mat</span><span class="p">,</span> <span class="kt">int</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">FunctionPointer</span> <span class="n">functions</span><span class="p">[</span><span class="n">NTESTS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span> <span class="n">colorReduce</span><span class="p">,</span> <span class="n">colorReduce1</span><span class="p">,</span> <span class="n">colorReduce2</span><span class="p">,</span> <span class="n">colorReduce3</span><span class="p">,</span> <span class="n">colorReduce4</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">colorReduce5</span><span class="p">,</span> <span class="n">colorReduce6</span><span class="p">,</span> <span class="n">colorReduce7</span><span class="p">,</span> <span class="n">colorReduce8</span><span class="p">,</span> <span class="n">colorReduce9</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">colorReduce10</span><span class="p">,</span> <span class="n">colorReduce11</span><span class="p">,</span> <span class="n">colorReduce12</span><span class="p">,</span> <span class="n">colorReduce13</span><span class="p">,</span> <span class="n">colorReduce14</span> <span class="p">};</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// repeat the tests several times
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">n</span> <span class="o">=</span> <span class="n">NITERATIONS</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">k</span><span class="o">&lt;</span><span class="n">n</span><span class="p">;</span> <span class="n">k</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">k</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; of &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// test each version
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">c</span> <span class="o">&lt;</span> <span class="n">NTESTS</span><span class="p">;</span> <span class="n">c</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">images</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/boldt.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// set timer and call function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">tinit</span> <span class="o">=</span> <span class="n">getTickCount</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">functions</span><span class="p">[</span><span class="n">c</span><span class="p">](</span><span class="n">images</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="mi">64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">t</span><span class="p">[</span><span class="n">c</span><span class="p">]</span> <span class="o">+=</span> <span class="n">getTickCount</span><span class="p">()</span> <span class="o">-</span> <span class="n">tinit</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;.&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// short description of each function
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">descriptions</span><span class="p">[</span><span class="n">NTESTS</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;original version:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;with dereference operator:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;using modulo operator:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;using a binary mask:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;direct ptr arithmetic:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;row size recomputation:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;continuous image:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;reshape continuous image:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;with iterators:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;Vec3b iterators:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;iterators and mask:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;iterators from Mat_:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;at method:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;overloaded operators:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="s">&#34;look-up table:&#34;</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">	<span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NTESTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">namedWindow</span><span class="p">(</span><span class="n">descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">		<span class="n">imshow</span><span class="p">(</span><span class="n">descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">images</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// print average execution time
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;-------------------------------------------&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">NTESTS</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;. &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">descriptions</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;&lt;</span> <span class="mf">1000.</span><span class="o">*</span><span class="n">t</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">getTickFrequency</span><span class="p">()</span> <span class="o">/</span> <span class="n">n</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;ms&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><blockquote>
<p>1.使用flip来进行水平垂直方向的改变
2.使用putText添加文本
3.使用椒盐噪声
4.减色函数clolrReduce</p>
</blockquote>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Mat</span> <span class="n">srcImage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Mat</span> <span class="n">result_1</span><span class="p">,</span> <span class="n">result_0</span><span class="p">,</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="n">Mat</span> <span class="n">src_gray_img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">////3.椒盐噪声
</span></span></span><span class="line"><span class="cl"><span class="c1">//void salt(Mat image, int n)
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//C++11的随机生成器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	default_random_engine generator;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	uniform_int_distribution&lt;int&gt; randomRow(0, image.rows - 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	uniform_int_distribution&lt;int&gt; randomCol(0, image.cols - 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int i, j;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int k = 0; k &lt; n; k++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		//随机生成图形位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//		i = randomCol(generator);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		j = randomRow(generator);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		if (image.type() == CV_8UC1) // 灰度图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//单通道8位图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//			image.at&lt;uchar&gt;(j, i) = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//		else if (image.type() == CV_8UC3) //彩色图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//3通道图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//			image.at&lt;Vec3b&gt;(j, i)[0] = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1">//			image.at&lt;Vec3b&gt;(j, i)[1] = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1">//			image.at&lt;Vec3b&gt;(j, i)[2] = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//4.减色函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">colorReduce</span><span class="p">(</span><span class="n">Mat</span> <span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">div</span> <span class="o">=</span> <span class="mi">64</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">nr</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="c1">//行数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//每一行的元素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">nc</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">*</span> <span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">nr</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//取的行j的地址
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">uchar</span> <span class="o">*</span><span class="n">data</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">nc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//处理每一个元素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">/</span> <span class="n">div</span> <span class="o">*</span> <span class="n">div</span> <span class="o">+</span> <span class="n">div</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">srcImage</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;1.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">srcImage</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;srcImage is error !&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;srcImage&#34;</span><span class="p">,</span> <span class="n">srcImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//3.调用椒盐噪声
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//salt(srcImage, 3000);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;srcImage_salt&#34;, srcImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//4.减色函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">colorReduce</span><span class="p">(</span><span class="n">srcImage</span><span class="p">,</span> <span class="mi">64</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;srcImage_colorreduce&#34;</span><span class="p">,</span> <span class="n">srcImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//src_gray_img = imread(&#34;1.jpg&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;src_grat_img&#34;, src_gray_img);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//1.使用flip来进行水平垂直方向的改变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//flip(srcImage, result_1, 1); //正数表示水平
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//flip(srcImage, result_0, 0); //0表示垂直
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//flip(srcImage, result, -1); //负数表示水平和垂直
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//2.使用putText添加文本
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//putText(result_1, &#34;Wangdasha is ppp&#34;, Point(4, 200), FONT_HERSHEY_PLAIN, 2.0, 125, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;result_1&#34;, result_1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;result_0&#34;, result_0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_03--处理图像的颜色">Chapter_03 : 处理图像的颜色</h3>
<blockquote>
<p>1.用策略设计模式比较颜色
2.用GrabCut算法分割图像
3.用色调、饱和度、和亮度表示颜色</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;ColorDetector.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//3.用色调、饱和度、和亮度表示颜色 ---- 检测肤色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>       <span class="c1">//输入图像  色调区间  饱和度区间  输出掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">detectHScolor</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span> <span class="kt">double</span> <span class="n">minHue</span><span class="p">,</span> <span class="kt">double</span> <span class="n">maxHue</span><span class="p">,</span> <span class="kt">double</span> <span class="n">minSat</span><span class="p">,</span> <span class="kt">double</span> <span class="n">maxSat</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">mask</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//转到HSV空间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">hsv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">hsv</span><span class="p">,</span> <span class="n">CV_BGR2HSV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//将3通道分割成3幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">channels</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">split</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">channels</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//色调掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">mask1</span><span class="p">;</span>  <span class="c1">//小于maxHue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">threshold</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mask1</span><span class="p">,</span> <span class="n">maxHue</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">mask2</span><span class="p">;</span> <span class="c1">//大于minHue
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">threshold</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">mask2</span><span class="p">,</span> <span class="n">minHue</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">THRESH_BINARY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">hueMask</span><span class="p">;</span> <span class="c1">//色调掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">minHue</span> <span class="o">&lt;</span> <span class="n">maxHue</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">hueMask</span> <span class="o">=</span> <span class="n">mask1</span> <span class="o">&amp;</span> <span class="n">mask2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">else</span> <span class="c1">//如果区间穿越0度中轴线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hueMask</span> <span class="o">=</span> <span class="n">mask1</span> <span class="o">|</span> <span class="n">mask2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//饱和度掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//从minSat 到 maxSat
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//threshold(channels[1], mask1, maxSat, 255, THRESH_BINARY_INV);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//threshold(channels[1], mask2, minSat, 255, THRESH_BINARY);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat satMask;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//satMask = mask1 &amp; mask2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">satMask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">inRange</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">minSat</span><span class="p">,</span> <span class="n">maxSat</span><span class="p">,</span> <span class="n">satMask</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//组合掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">mask</span> <span class="o">=</span> <span class="n">hueMask</span> <span class="o">&amp;</span> <span class="n">satMask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////1.用策略设计模式比较颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////创建图像处理器对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//ColorDetector cdetect;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////读取图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/boldt.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (image.empty())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////设置输入参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cdetect.setTargetColor(230, 190, 130); // 这里表示蓝天
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////处理图像并显示结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat result = cdetect.process(image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// or using functor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// here distance is measured with the Lab color space
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//ColorDetector colordetector(230, 190, 130,  // color
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	45, true); // Lab threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//namedWindow(&#34;result (functor)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//result = colordetector(image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;result (functor)&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// testing floodfill
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//floodFill(image,            // input/ouput image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Point(100, 50),         // seed point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Scalar(255, 255, 255),  // repainted color
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	(Rect*)0,  // bounding rectangle of the repainted pixel set
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Scalar(35, 35, 35),     // low and high difference threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Scalar(35, 35, 35),     // most of the time will be identical
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	FLOODFILL_FIXED_RANGE); // pixels are compared to seed color
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//namedWindow(&#34;Flood Fill result&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//result = colordetector(image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Flood Fill result&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Creating artificial images to demonstrate color space properties
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat colors(100, 300, CV_8UC3, Scalar(100, 200, 150));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat range = colors.colRange(0, 100);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = range + Scalar(10, 10, 10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = colors.colRange(200, 300);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = range + Scalar(-10, -10, 10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//namedWindow(&#34;3 colors&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;3 colors&#34;, colors);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat labImage(100, 300, CV_8UC3, Scalar(100, 200, 150));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cvtColor(labImage, labImage, CV_BGR2Lab);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = colors.colRange(0, 100);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = range + Scalar(10, 10, 10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = colors.colRange(200, 300);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//range = range + Scalar(-10, -10, 10);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cvtColor(labImage, labImage, CV_Lab2BGR);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//namedWindow(&#34;3 colors (Lab)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;3 colors (Lab)&#34;, colors);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// brightness versus luminance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat grayLevels(100, 256, CV_8UC3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; 256; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	grayLevels.col(i) = Scalar(i, i, i);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//range = grayLevels.rowRange(50, 100);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat channels[3];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//split(range, channels);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//channels[1] = 128;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//channels[2] = 128;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//merge(channels, 3, range);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cvtColor(range, range, CV_Lab2BGR);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//namedWindow(&#34;Luminance vs Brightness&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Luminance vs Brightness&#34;, grayLevels);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//2.用GrabCut算法分割图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/boldt.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (image.empty())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Rect rectangle(5, 70, 260, 120);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat bg, fg;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////GrabCut分割算法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//grabCut(image, result, rectangle, bg, fg, 5, GC_INIT_WITH_RECT);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////取得标记可能为前景的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//compare(result, GC_PR_FGD, result, CMP_EQ);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////生成输出图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat foreground(image.size(), CV_8UC3, Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//image.copyTo(foreground, result);        //A.copyTo(B, mask);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;foreground&#34;, foreground);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;image_copy&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//3.用色调、饱和度、和亮度表示颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/boldt.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//转换成HSV
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">hsv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">hsv</span><span class="p">,</span> <span class="n">CV_BGR2HSV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;hsv&#34;</span><span class="p">,</span> <span class="n">hsv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//把三个通道放进三个图片中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">channels</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">split</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">channels</span><span class="p">);</span> <span class="c1">//0-H, 1-S, 2-V
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;H&#34;</span><span class="p">,</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span> <span class="c1">//色调
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;S&#34;</span><span class="p">,</span> <span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span> <span class="c1">//饱和度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;V&#34;</span><span class="p">,</span> <span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span> <span class="c1">//亮度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">newImage</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">tmp</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">].</span><span class="n">clone</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//改变亮度（V）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">merge</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">hsv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">newImage</span><span class="p">,</span> <span class="n">CV_HSV2BGR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;newImage_V&#34;</span><span class="p">,</span> <span class="n">newImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//改变饱和度（S）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">merge</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">hsv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">newImage</span><span class="p">,</span> <span class="n">CV_HSV2BGR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;newImage_S&#34;</span><span class="p">,</span> <span class="n">newImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">//亮度、饱和度一起改变
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">merge</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">hsv</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">newImage</span><span class="p">,</span> <span class="n">CV_HSV2BGR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;newImage_SV&#34;</span><span class="p">,</span> <span class="n">newImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//展现出所有的HS颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">hs</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="mi">360</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">s</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">s</span> <span class="o">&lt;</span> <span class="mi">128</span><span class="p">;</span> <span class="n">s</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">hs</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">h</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">h</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">hs</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">h</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span> <span class="o">-</span> <span class="n">s</span> <span class="o">*</span> <span class="mi">2</span><span class="p">;</span> <span class="c1">//从高到低
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">hs</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="n">s</span><span class="p">,</span> <span class="n">h</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">hs</span><span class="p">,</span> <span class="n">newImage</span><span class="p">,</span> <span class="n">CV_HSV2BGR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;newImage_hs&#34;</span><span class="p">,</span> <span class="n">newImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//肤色检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/girl.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;girl&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//检测肤色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">detectHScolor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="mi">160</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">166</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span> <span class="c1">//色调为320度- 20度 饱和度为~0.1 到 0.65
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//显示使用掩码后的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">detected</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8UC3</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">image</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">detected</span><span class="p">,</span> <span class="n">mask</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;detected&#34;</span><span class="p">,</span> <span class="n">detected</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// A test comparing luminance and brightness
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// create linear intensity image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">linear</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="mi">256</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">linear</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// create a Lab image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">linear</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">constante</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">128</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">constante</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="n">constante</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="n">merge</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// convert back to BGR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">brightness</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">brightness</span><span class="p">,</span> <span class="n">CV_Lab2BGR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">split</span><span class="p">(</span><span class="n">brightness</span><span class="p">,</span> <span class="n">channels</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// create combined image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">combined</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">half1</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">100</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">linear</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">half1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">half2</span><span class="p">(</span><span class="n">combined</span><span class="p">,</span> <span class="n">Rect</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">256</span><span class="p">,</span> <span class="mi">100</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">copyTo</span><span class="p">(</span><span class="n">half2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">namedWindow</span><span class="p">(</span><span class="s">&#34;Luminance vs Brightness&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Luminance vs Brightness&#34;</span><span class="p">,</span> <span class="n">combined</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined COLORDETECT
</span></span></span><span class="line"><span class="cl"><span class="cp">#define COLORDETECT
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ColorDetector</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//允许的最小差距
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">maxDist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//目标颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vec3b</span> <span class="n">target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//image containing color converted image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">converted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">useLab</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//存储二值映射结果的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//空的构造函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ColorDetector</span><span class="p">()</span> <span class="o">:</span> <span class="n">maxDist</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">target</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">useLab</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ColorDetector</span><span class="p">(</span><span class="kt">bool</span> <span class="n">useLab</span><span class="p">)</span> <span class="o">:</span> <span class="n">maxDist</span><span class="p">(</span><span class="mi">100</span><span class="p">),</span> <span class="n">target</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="n">useLab</span><span class="p">(</span><span class="n">useLab</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//另一只构造函数，使用目标颜色和颜色距离作为参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">ColorDetector</span><span class="p">(</span><span class="n">uchar</span> <span class="n">blue</span><span class="p">,</span> <span class="n">uchar</span> <span class="n">green</span><span class="p">,</span> <span class="n">uchar</span> <span class="n">red</span><span class="p">,</span> <span class="kt">int</span> <span class="n">mxDist</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">useLab</span> <span class="o">=</span> <span class="nb">false</span><span class="p">)</span> <span class="o">:</span>
</span></span><span class="line"><span class="cl">		<span class="n">maxDist</span><span class="p">(</span><span class="n">mxDist</span><span class="p">),</span> <span class="n">useLab</span><span class="p">(</span><span class="n">useLab</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//target color 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">setTargetColor</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">red</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//计算与目标颜色的差距
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">getDistanceToTargetColor</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">color</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">getColorDistance</span><span class="p">(</span><span class="n">color</span><span class="p">,</span> <span class="n">target</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//计算两个颜色之间的城区距离
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">getColorDistance</span><span class="p">(</span><span class="k">const</span> <span class="n">Vec3b</span><span class="o">&amp;</span> <span class="n">color1</span><span class="p">,</span> <span class="k">const</span> <span class="n">Vec3b</span> <span class="o">&amp;</span><span class="n">color2</span><span class="p">)</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">abs</span><span class="p">(</span><span class="n">color1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">color2</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">color1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">color2</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">abs</span><span class="p">(</span><span class="n">color1</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">color2</span><span class="p">[</span><span class="mi">2</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="nf">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="nf">operator</span><span class="p">()</span> <span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">input</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">useLab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">input</span><span class="p">,</span> <span class="n">CV_BGR2Lab</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">input</span> <span class="o">=</span> <span class="n">image</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//compute absolute difference with target color
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">absdiff</span><span class="p">(</span><span class="n">input</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="n">target</span><span class="p">),</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//split the channel into 3 images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">images</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">split</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">images</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//add the 3 channels (saturation might occurs here)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">output</span> <span class="o">=</span> <span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">images</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">images</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//apply threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">threshold</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">maxDist</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Getters and setters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置颜色差距的阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//阈值必须是正数，否则就设置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setColorDistanceThreshold</span><span class="p">(</span><span class="kt">int</span> <span class="n">distance</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">distance</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">maxDist</span> <span class="o">=</span> <span class="n">distance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//取得颜色差距的阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">getColorDistanceThreshold</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">maxDist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置需要检测的颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//given in BGR color space
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setTargetColor</span><span class="p">(</span><span class="n">uchar</span> <span class="n">blue</span><span class="p">,</span> <span class="n">uchar</span> <span class="n">green</span><span class="p">,</span> <span class="n">uchar</span> <span class="n">red</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//次序为BGR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">target</span> <span class="o">=</span> <span class="n">Vec3b</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">red</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">useLab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//Temporary 1-pixel image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">Mat</span> <span class="n">tmp</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">tmp</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="n">Vec3b</span><span class="p">(</span><span class="n">blue</span><span class="p">,</span> <span class="n">green</span><span class="p">,</span> <span class="n">red</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">//Converting the target to Lab color space
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cvtColor</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">CV_BGR2Lab</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">target</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置需要检测的颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setTargetColor</span><span class="p">(</span><span class="n">Vec3b</span> <span class="n">color</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">target</span> <span class="o">=</span> <span class="n">color</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//取得需要检测的颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Vec3b</span> <span class="nf">getTargetColor</span><span class="p">()</span> <span class="k">const</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined COLORDETECT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;ColorDetector.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="n">Mat</span> <span class="n">ColorDetector</span><span class="o">::</span><span class="n">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//必要时重新分配二值映射
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//与输入图像的尺寸相同，不过是单通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Converting to Lab color space 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">useLab</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">converted</span><span class="p">,</span> <span class="n">CV_BGR2Lab</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 取得迭代器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itend</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat_</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">itout</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// get the iterators of the converted image 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">useLab</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">it</span> <span class="o">=</span> <span class="n">converted</span><span class="p">.</span><span class="n">begin</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">itend</span> <span class="o">=</span> <span class="n">converted</span><span class="p">.</span><span class="n">end</span><span class="o">&lt;</span><span class="n">Vec3b</span><span class="o">&gt;</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 对于每一个像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(;</span> <span class="n">it</span> <span class="o">!=</span> <span class="n">itend</span><span class="p">;</span> <span class="o">++</span><span class="n">it</span><span class="p">,</span> <span class="o">++</span><span class="n">itout</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//比较与目标颜色的差距
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">getDistanceToTargetColor</span><span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)</span><span class="o">&lt;</span><span class="n">maxDist</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">itout</span> <span class="o">=</span> <span class="mi">255</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">itout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// end of pixel processing ----------------
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_04--用直方图统计像素">Chapter_04 : 用直方图统计像素</h3>
<blockquote>
<p>计算图像直方图</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span><span class="lnt">688
</span><span class="lnt">689
</span><span class="lnt">690
</span><span class="lnt">691
</span><span class="lnt">692
</span><span class="lnt">693
</span><span class="lnt">694
</span><span class="lnt">695
</span><span class="lnt">696
</span><span class="lnt">697
</span><span class="lnt">698
</span><span class="lnt">699
</span><span class="lnt">700
</span><span class="lnt">701
</span><span class="lnt">702
</span><span class="lnt">703
</span><span class="lnt">704
</span><span class="lnt">705
</span><span class="lnt">706
</span><span class="lnt">707
</span><span class="lnt">708
</span><span class="lnt">709
</span><span class="lnt">710
</span><span class="lnt">711
</span><span class="lnt">712
</span><span class="lnt">713
</span><span class="lnt">714
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//#include &#34;Histogram1D.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;ContentFinder.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include  &#34;ColorHistogram.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//读入图像，并转成灰度图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat image = imread(&#34;./images/waves.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat imageROI;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imageROI = image(Rect(216, 33, 24, 30)); //设置感兴趣区域
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;imageROI&#34;, imageROI);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//直方图对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Histogram1D h;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat hist = h.getHistogram(imageROI);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Histogram1D&#34;, h.getHistogramImage(imageROI));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//创建内容搜寻器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ContentFinder finder;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//设置用来反向投影的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// set histogram to be back-projected
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setHistogram(hist);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setThreshold(-1.0f);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get back-projection
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat result1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1 = finder.find(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Create negative image and display result
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat tmp;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1.convertTo(tmp, CV_8U, -1.0, 255.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Backprojection result&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Backprojection result&#34;, tmp);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get binary back-projection
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setThreshold(0.12f);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1 = finder.find(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Draw a rectangle around the reference area
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::rectangle(image, cv::Rect(216, 33, 24, 30), cv::Scalar(0, 0, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display result
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Detection Result&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Detection Result&#34;, result1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//装载彩色图片
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ColorHistogram hc;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat color = imread(&#34;./images/waves.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;color&#34;, color);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//提取ROI
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imageROI = color(Rect(0, 0, 100, 45));  //蓝色天空的区域
</span></span></span><span class="line"><span class="cl"><span class="c1">//    //获取3D颜色直方图（每个通道适合8个箱子）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	hc.setSize(8);        //8 * 8 * 8
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat shist = hc.getHistogram(imageROI);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//创建内容搜寻器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//设置用来反向投影的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setHistogram(shist);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setThreshold(0.05f);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//取得颜色直方图的反向投影
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1 = finder.find(color);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;result1&#34;, result1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//装载彩色图片
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat color2 = imread(&#34;./images/dog.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;color2&#34;, color2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat result2 = finder.find(color2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;result2&#34;, result2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get ab color histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	hc.setSize(256); // 256x256
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat colorhist = hc.getabHistogram(imageROI);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// display 2D histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	colorhist.convertTo(tmp, CV_8U, -1.0, 255.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;ab histogram&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;ab histogram&#34;, tmp);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// set histogram to be back - projected
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setHistogram(colorhist);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setThreshold(0.05f);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Convert to Lab space
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat lab;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::cvtColor(color, lab, CV_BGR2Lab);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get back-projection of ab histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int ch[2] = { 1,2 };
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1 = finder.find(lab, 0, 256.0f, ch);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Result ab (1)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Result ab (1)&#34;, result1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Second colour image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::cvtColor(color2, lab, CV_BGR2Lab);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get back-projection of ab histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result2 = finder.find(lab, 0, 256.0, ch);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Result ab (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Result ab (2)&#34;, result2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Draw a rectangle around the reference sky area
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::rectangle(color, cv::Rect(0, 0, 100, 45), cv::Scalar(0, 0, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Color Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Color Image&#34;, color);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get Hue colour histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	hc.setSize(180); // 180 bins
</span></span></span><span class="line"><span class="cl"><span class="c1">//	colorhist = hc.getHueHistogram(imageROI);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// set histogram to be back-projected
</span></span></span><span class="line"><span class="cl"><span class="c1">//	finder.setHistogram(colorhist);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Convert to HSV space
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat hsv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::cvtColor(color, hsv, CV_BGR2HSV);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get back-projection of hue histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ch[0] = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result1 = finder.find(hsv, 0.0f, 180.0f, ch);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Result Hue (1)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Result Hue (1)&#34;, result1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Second colour image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//color2 = cv::imread(&#34;./images/dog.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Convert to HSV space
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::cvtColor(color2, hsv, CV_BGR2HSV);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Get back-projection of hue histogram
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//result2 = finder.find(hsv, 0.0f, 180.0f, ch);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Result Hue (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Result Hue (2)&#34;, result2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined HISTOGRAM
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HISTOGRAM
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//创建灰度图像的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">Histogram1D</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>        <span class="c1">//直方图中箱子的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">float</span> <span class="n">hranges</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>       <span class="c1">//值范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="kt">float</span> <span class="o">*</span><span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span> <span class="c1">//值范围的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>        <span class="c1">//要检查的通道数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Histogram1D</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//准备一维直方图的默认参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">histSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>    <span class="c1">//256个箱子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>     <span class="c1">//从0开始（包含0）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">256.0</span><span class="p">;</span>   <span class="c1">//到256（不包含256）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>      <span class="c1">//先关注通道0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//void setChannel(int c)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	channels[0] = c;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//int getChannel()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return channels[0];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//void setRange(float minValue, float maxValue)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	hranges[0] = minValue;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	hranges[1] = maxValue;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//float getMinValue()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return hranges[0];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//float getMaxValue()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return hranges[1];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//void setNBins(int nbins)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	histSize[0] = nbins;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//int getNBins()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return histSize[0];
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//计算一维直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//用calcHist函数计算一维直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//一幅图像的直方图   一幅   使用的通道， 不使用掩码  作为结果的直方图  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//这是一维的直方图  箱子数量  像素值的范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">calcHist</span><span class="p">(</span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">channels</span><span class="p">,</span> <span class="n">Mat</span><span class="p">(),</span> <span class="n">hist</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">histSize</span><span class="p">,</span> <span class="n">ranges</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//计算一维直方图，并返回它的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getHistogramImage</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="kt">int</span> <span class="n">zoom</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//先计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">hist</span> <span class="o">=</span> <span class="n">getHistogram</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//创建图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">Histogram1D</span><span class="o">::</span><span class="n">getImageOfHistogram</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="n">zoom</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//// Stretches the source image using min number of count in bins.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat stretch(const Mat &amp;image, int minValue = 0) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Compute histogram first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat hist = getHistogram(image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// find left extremity of the histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int imin = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (; imin &lt; histSize[0]; imin++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		// ignore bins with less than minValue entries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if (hist.at&lt;float&gt;(imin) &gt; minValue)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// find right extremity of the histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int imax = histSize[0] - 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (; imax &gt;= 0; imax--) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		// ignore bins with less than minValue entries
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if (hist.at&lt;float&gt;(imax) &gt; minValue)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Create lookup table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int dims[1] = { 256 };
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat lookup(1, dims, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	for (int i = 0; i&lt;256; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		if (i &lt; imin) lookup.at&lt;uchar&gt;(i) = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		else if (i &gt; imax) lookup.at&lt;uchar&gt;(i) = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		else lookup.at&lt;uchar&gt;(i) = cvRound(255.0*(i - imin) / (imax - imin));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Apply lookup table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	result = applyLookUp(image, lookup);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	return result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Stretches the source image using percentile.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat stretch(const Mat &amp;image, float percentile) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// number of pixels in percentile
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	float number = image.total() * percentile;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Compute histogram first
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat hist = getHistogram(image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// find left extremity of the histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int imin = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (float count = 0.0; imin &lt; 256; imin++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		// number of pixel at imin and below must be &gt; number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if ((count += hist.at&lt;float&gt;(imin)) &gt;= number)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// find right extremity of the histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int imax = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (float count = 0.0; imax &gt;= 0; imax--) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		// number of pixel at imax and below must be &gt; number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if ((count += hist.at&lt;float&gt;(imax)) &gt;= number)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Create lookup table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	int dims[1] = { 256 };
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat lookup(1, dims, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	for (int i = 0; i&lt;256; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		if (i &lt; imin) lookup.at&lt;uchar&gt;(i) = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		else if (i &gt; imax) lookup.at&lt;uchar&gt;(i) = 255;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		else lookup.at&lt;uchar&gt;(i) = cvRound(255.0*(i - imin) / (imax - imin));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Apply lookup table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	result = applyLookUp(image, lookup);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	return result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//创建一个表示直方图的图像（静态方法）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">static</span> <span class="n">Mat</span> <span class="nf">getImageOfHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">hist</span><span class="p">,</span> <span class="kt">int</span> <span class="n">zoom</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//取得箱子值的最大值和最小值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">double</span> <span class="n">maxVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">double</span> <span class="n">minVal</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">minMaxLoc</span><span class="p">(</span><span class="n">hist</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minVal</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxVal</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//取得直方图的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">histSize</span> <span class="o">=</span> <span class="n">hist</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//用于显示直方图的方形图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">histImg</span><span class="p">(</span><span class="n">histSize</span> <span class="o">*</span><span class="n">zoom</span><span class="p">,</span> <span class="n">histSize</span> <span class="o">*</span><span class="n">zoom</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//设置最高点为90%（即图像高度）的箱子个数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">hpt</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="mf">0.9</span> <span class="o">*</span> <span class="n">histSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//为每个箱子画垂直线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">h</span> <span class="o">&lt;</span> <span class="n">histSize</span><span class="p">;</span> <span class="n">h</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="kt">float</span> <span class="n">binVal</span> <span class="o">=</span> <span class="n">hist</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">binVal</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="kt">int</span> <span class="n">intensity</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">binVal</span> <span class="o">*</span> <span class="n">hpt</span> <span class="o">/</span> <span class="n">maxVal</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">line</span><span class="p">(</span><span class="n">histImg</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="n">histSize</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">					<span class="n">Point</span><span class="p">(</span><span class="n">h</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">,</span> <span class="p">(</span><span class="n">histSize</span> <span class="o">-</span> <span class="n">intensity</span><span class="p">)</span> <span class="o">*</span> <span class="n">zoom</span><span class="p">),</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">zoom</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">histImg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//// Equalizes the source image.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//static Mat equalize(const Mat &amp;image) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	equalizeHist(image, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	return result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//// Applies a lookup table transforming an input image into a 1-channel image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//static Mat applyLookUp(const Mat &amp;image, // input image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	const Mat &amp;lookup) { // 1x256 uchar matrix
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//						 // the output image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// apply lookup table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	LUT(image, lookup, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	return result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Applies a lookup table transforming an input image into a 1-channel image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// this is a test version with iterator; always use function cv::LUT
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//static Mat applyLookUpWithIterator(const Mat&amp; image, const Mat&amp; lookup) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Set output image (always 1-channel)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat result(image.rows, image.cols, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat_&lt;uchar&gt;::iterator itr = result.begin&lt;uchar&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Iterates over the input image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat_&lt;uchar&gt;::const_iterator it = image.begin&lt;uchar&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Mat_&lt;uchar&gt;::const_iterator itend = image.end&lt;uchar&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	// Applies lookup to each pixel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (; it != itend; ++it, ++itr) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		*itr = lookup.at&lt;uchar&gt;(*it);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	return result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">};</span>
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined HISTOGRAM
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !define OFINDER
</span></span></span><span class="line"><span class="cl"><span class="cp">#define OFINDER
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ContentFinder</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//直方图参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">float</span> <span class="n">hranges</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="kt">float</span> <span class="o">*</span><span class="n">ranges</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">channels</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">threshold</span><span class="p">;</span>    <span class="c1">//判断阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">histogram</span><span class="p">;</span>      <span class="c1">//输入直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SparseMat</span> <span class="n">shistogram</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span>  <span class="n">isSparse</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ContentFinder</span><span class="p">()</span> <span class="o">:</span> <span class="n">threshold</span><span class="p">(</span><span class="mf">0.1f</span><span class="p">),</span> <span class="n">isSparse</span><span class="p">(</span><span class="nb">false</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//本类中所有的通道的范围相同
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Sets the threshold on histogram values [0,1]
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setThreshold</span><span class="p">(</span><span class="kt">float</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">threshold</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Gets the threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">float</span> <span class="nf">getThreshold</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">threshold</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置应用的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isSparse</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">normalize</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">histogram</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置应用的直方图----SparseMat
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">SparseMat</span> <span class="o">&amp;</span><span class="n">h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">isSparse</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">normalize</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">shistogram</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">NORM_L2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//使用全部通道，范围【0， 256】
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">find</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>    <span class="c1">//默认范围【0， 256】， hranges[1] = 256.0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">256.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>     <span class="c1">//三个通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">find</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">channels</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//查找属于直方图的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">find</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span> <span class="kt">float</span> <span class="n">minValue</span><span class="p">,</span> <span class="kt">float</span> <span class="n">maxValue</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">channels</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">minValue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">maxValue</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">isSparse</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">shistogram</span><span class="p">.</span><span class="n">dims</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="k">this</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">calcBackProject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="mi">1</span><span class="p">,</span>          <span class="c1">//只使用一幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">channels</span><span class="p">,</span>   <span class="c1">//通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">histogram</span><span class="p">,</span>  <span class="c1">//直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">result</span><span class="p">,</span>     <span class="c1">//反向投影
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">ranges</span><span class="p">,</span>     <span class="c1">//每个维度的值范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="mf">255.0</span>       <span class="c1">//选用的换算技术
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>							<span class="c1">//把概率从1映射到255
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//直方图的维度数与通道列表一致
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">histogram</span><span class="p">.</span><span class="n">dims</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="k">this</span><span class="o">-&gt;</span><span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">channels</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//calcBackProject函数和calcHist函数有些类似，而calcBackProject不会增加箱子的数量，而是从箱子读取的值赋给方向投影图像中对应的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">calcBackProject</span><span class="p">(</span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="mi">1</span><span class="p">,</span>          <span class="c1">//只使用一幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">channels</span><span class="p">,</span>   <span class="c1">//通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">histogram</span><span class="p">,</span>  <span class="c1">//直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">result</span><span class="p">,</span>     <span class="c1">//反向投影
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">ranges</span><span class="p">,</span>     <span class="c1">//每个维度的值范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="mf">255.0</span>       <span class="c1">//选用的换算技术
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>							<span class="c1">//把概率从1映射到255
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//对反射投影结果做阈值化，得到二值图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">threshold</span> <span class="o">&gt;</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="mf">255.0</span><span class="o">*</span><span class="n">threshold</span><span class="p">,</span> <span class="mf">255.0</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">result</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !define OFINDER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !define COLORHISTOGRAM
</span></span></span><span class="line"><span class="cl"><span class="cp">#define COLORHISTOGRAM
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">ColorHistogram</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>         <span class="c1">//每个维度的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">float</span> <span class="n">hranges</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>        <span class="c1">//值的大小（三个维度用同一个值）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">const</span> <span class="kt">float</span><span class="o">*</span> <span class="n">ranges</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>  <span class="c1">//每个维度的范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">channels</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>         <span class="c1">//需要处理的通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">ColorHistogram</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//准备用于彩色图像的默认参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//每个维度的范围和大小是相同的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">histSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">256</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>      <span class="c1">// BGR范围为0-256
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">256.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>   <span class="c1">//这个类中
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span>   <span class="c1">//所有通道的范围均相等
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ranges</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">hranges</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>           <span class="c1">//三个通道： B
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>           <span class="c1">//G
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">channels</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>           <span class="c1">//R
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Ã¿¸öÎ¬¶ÈµÃµ½Ö±·½Í¼µÄ´óÐ¡
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//Ã¿¸öÎ¬¶ÈµÄ´óÐ¡¶¼ÏàµÈ
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">histSize</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">histSize</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		
</span></span><span class="line"><span class="cl">		<span class="n">calcHist</span><span class="p">(</span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="c1">//单幅图像的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">channels</span><span class="p">,</span>  <span class="c1">//用到的通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">Mat</span><span class="p">(),</span>     <span class="c1">//不使用掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">hist</span><span class="p">,</span>      <span class="c1">//得到的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="mi">3</span><span class="p">,</span>         <span class="c1">//这是一个三维的直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">histSize</span><span class="p">,</span>  <span class="c1">//箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">ranges</span><span class="p">);</span>   <span class="c1">//像素值的范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">SparseMat</span> <span class="nf">getSparseHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">SparseMat</span> <span class="n">hist</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span>       <span class="c1">//维数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">histSize</span><span class="p">,</span>          <span class="c1">//每个维度的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">CV_32F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">calcHist</span><span class="p">(</span><span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">			<span class="n">channels</span><span class="p">,</span>  
</span></span><span class="line"><span class="cl">			<span class="n">Mat</span><span class="p">(),</span>    
</span></span><span class="line"><span class="cl">			<span class="n">hist</span><span class="p">,</span>      
</span></span><span class="line"><span class="cl">			<span class="mi">3</span><span class="p">,</span>         
</span></span><span class="line"><span class="cl">			<span class="n">histSize</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">			<span class="n">ranges</span><span class="p">);</span>  
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用均值平均算法查找目标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//计算一维色调直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//BGR 的原图转化为 HSV
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//忽略低饱和度的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getHueHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">minSaturation</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//转化为HSV空间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">hsv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">hsv</span><span class="p">,</span> <span class="n">CV_BGR2HSV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 掩码（可能用到，可能用不到）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">mask</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//根据需要创建掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">minSaturation</span><span class="o">&gt;</span><span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 将3个通道分割进是3个图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">v</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">cv</span><span class="o">::</span><span class="n">split</span><span class="p">(</span><span class="n">hsv</span><span class="p">,</span> <span class="n">v</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">//屏蔽低饱和度的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">mask</span><span class="p">,</span> <span class="n">minSaturation</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 准备一维色调直方图的参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">;</span>    <span class="c1">//范围为 0 - 180
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">180.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>    <span class="c1">//色调通道
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 计算直方图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">calcHist</span><span class="p">(</span><span class="o">&amp;</span><span class="n">hsv</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="mi">1</span><span class="p">,</span>			
</span></span><span class="line"><span class="cl">			<span class="n">channels</span><span class="p">,</span>	
</span></span><span class="line"><span class="cl">			<span class="n">mask</span><span class="p">,</span>		
</span></span><span class="line"><span class="cl">			<span class="n">hist</span><span class="p">,</span>		
</span></span><span class="line"><span class="cl">			<span class="mi">1</span><span class="p">,</span>			
</span></span><span class="line"><span class="cl">			<span class="n">histSize</span><span class="p">,</span>	
</span></span><span class="line"><span class="cl">			<span class="n">ranges</span>		
</span></span><span class="line"><span class="cl">		<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Computes the 2D ab histogram.
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// BGR source image is converted to Lab
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getabHistogram</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Convert to Lab color space
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">lab</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">lab</span><span class="p">,</span> <span class="n">CV_BGR2Lab</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Prepare arguments for a 2D color histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">hranges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">hranges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">256.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="c1">// the two channels used are ab 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Compute histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">calcHist</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lab</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="mi">1</span><span class="p">,</span>			<span class="c1">// histogram of 1 image only
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">channels</span><span class="p">,</span>	<span class="c1">// the channel used
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(),</span>	<span class="c1">// no mask is used
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">hist</span><span class="p">,</span>		<span class="c1">// the resulting histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="mi">2</span><span class="p">,</span>			<span class="c1">// it is a 2D histogram
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">histSize</span><span class="p">,</span>	<span class="c1">// number of bins
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">ranges</span>		<span class="c1">// pixel value range
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">hist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !define COLORHISTOGRAM
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_05--用形态学运算变换图像">Chapter_05 : 用形态学运算变换图像</h3>
<blockquote>
<p>1.腐蚀、膨胀、开始、闭合等形态学运算
2.MSER算法提取特征区域
3.用分水岭算法实现图像分割</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;WatershedSegmenter.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////1.腐蚀、膨胀、开始、闭合等形态学运算
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/binary.bmp&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat eroded; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//erode(image, eroded, Mat());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;erode&#34;, eroded);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat dilated; 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//dilate(image, dilated, Mat());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;dilate&#34;, dilated);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat element(7, 7, CV_8U, Scalar(1));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//erode(image, eroded, element);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Erode-7*7&#34;, eroded);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//erode(image, eroded, Mat(), Point(-1, -1), 3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;erode--3time&#34;, eroded);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat element5(5, 5, CV_8U, Scalar(1));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat closed;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//morphologyEx(image, closed, MORPH_CLOSE, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;close&#34;, closed);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat opened;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//morphologyEx(image, opened, MORPH_OPEN, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;open&#34;, opened);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// explicit closing
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// 1. dilate original image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::dilate(image, result, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// 2. in-place erosion of the dilated image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::erode(result, result, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Display the closed image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::namedWindow(&#34;Closed Image (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::imshow(&#34;Closed Image (2)&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Close and Open the image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::morphologyEx(image, image, cv::MORPH_CLOSE, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::morphologyEx(image, image, cv::MORPH_OPEN, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Display the close/opened image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::namedWindow(&#34;Closed|Opened Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::imshow(&#34;Closed|Opened Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::imwrite(&#34;binaryGroup.bmp&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Read input image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//image = cv::imread(&#34;./images/binary.bmp&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Open and Close the image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::morphologyEx(image, image, cv::MORPH_OPEN, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::morphologyEx(image, image, cv::MORPH_CLOSE, element5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Display the close/opened image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::namedWindow(&#34;Opened|Closed Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::imshow(&#34;Opened|Closed Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat image2 = imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;image2&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//morphologyEx(image2, result, MORPH_GRADIENT, Mat());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Edge_result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Edge_255-result&#34;, 255 - result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//int threshold(80);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::threshold(result, result, threshold, 255, THRESH_BINARY);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;threshold_result&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat image3 = imread(&#34;./images/book.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image3.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Image3&#34;, image3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//transpose(image3, image3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;transpose&#34;, image3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//flip(image3, image3, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;image3&#34;, image3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat element7(7, 7, CV_8U, Scalar(1));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//morphologyEx(image3, result, MORPH_BLACKHAT, element7);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Blackhat&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//threshold = 25;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::threshold(result, result,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	threshold, 255, cv::THRESH_BINARY);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Thresholded Black Top-hat&#34;, 255 - result);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////2.MSER算法提取特征区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/building.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////基本的MSER检测器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Ptr&lt;MSER&gt; ptrMSER = MSER::create(5,  //局部检测时使用的增量值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	200,                             //允许的最小面积
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	2000);                           //允许的最大面积
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////点集的容器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;vector&lt;Point&gt; &gt; points;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////矩形的容器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;Rect&gt; rects;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////检测MSER特征 ----检测的结果放在两个区域，第一个是区域的容器，每个区域用组成它的像素点表示，
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////第二个是矩形的容器，每个矩形包围一个区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//ptrMSER-&gt;detectRegions(image, points, rects);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cout &lt;&lt; points.size() &lt;&lt; &#34;MSERs detected&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////创建白色区域
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat output(image.size(), CV_8UC3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//output = Scalar(255, 255, 255);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">//   //Opencv随机数生成器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//RNG rng;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////针对每个检测到的特征区域， 在彩色区域显示MSER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////反向排序，先显示较大的MSER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (vector&lt;vector&lt;Point&gt; &gt; ::reverse_iterator it = points.rbegin(); it != points.rend(); ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	//生成随机颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Vec3b c(rng.uniform(0, 254), rng.uniform(0, 254), rng.uniform(0, 254));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	cout &lt;&lt; &#34;MSER size = &#34; &lt;&lt; it-&gt;size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	//针对MSER集合中的每个点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (vector&lt;Point&gt; ::iterator itPts = it-&gt;begin(); itPts != it-&gt;end(); ++itPts)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		//不重复MSER的像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if (output.at&lt;Vec3b&gt;(*itPts)[0] == 255)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			output.at&lt;Vec3b&gt;(*itPts) = c;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;MSER point sets&#34;, output);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imwrite(&#34;./images/mser.bmp&#34;, output);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////提取并显示矩形的MSER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;Rect&gt; ::iterator itr = rects.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;vector&lt;Point&gt; &gt; ::iterator  itp = points.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (; itr != rects.end(); ++itr, ++itp)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	//检查两者比例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	if (static_cast&lt;double&gt; (itp-&gt;size()) / itr-&gt;area() &gt; 0.6)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		rectangle(image, *itr, Scalar(0, 0, 255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////显示结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Rectangle MSERs&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////提取并显示椭圆形的MSER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//image = imread(&#34;./images/building.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (vector&lt;vector&lt;Point&gt; &gt; ::iterator it = points.begin(); it != points.end(); ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	//遍历MSER集合中的每一个点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (vector&lt;Point&gt; ::iterator itPts = it-&gt;begin(); itPts != it-&gt;end(); ++itPts)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		//提取封闭的矩形
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		RotatedRect rr = minAreaRect(*it);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		//检查椭圆得长宽比
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		if (rr.size.height / rr.size.width &gt; 0.2 || rr.size.height / rr.size.width &lt; 1.6)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//			ellipse(image, rr, Scalar(255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;MSER ellipses&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//3.用分水岭算法实现图像分割
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/group.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">image</span><span class="p">.</span><span class="n">data</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;image&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">binary</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">binary</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/binary.bmp&#34;</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Binary Image&#34;</span><span class="p">,</span> <span class="n">binary</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//消除噪声和细小的物体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">fg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">erode</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">fg</span><span class="p">,</span> <span class="n">Mat</span><span class="p">(),</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;erode&#34;</span><span class="p">,</span> <span class="n">fg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//标识不含物体的图像像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">bg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">dilate</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="n">Mat</span><span class="p">(),</span> <span class="n">Point</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="mi">4</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">threshold</span><span class="p">(</span><span class="n">bg</span><span class="p">,</span> <span class="n">bg</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;dilate_threshold&#34;</span><span class="p">,</span> <span class="n">bg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//创建标记图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">markers</span><span class="p">(</span><span class="n">binary</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">markers</span> <span class="o">=</span> <span class="n">fg</span> <span class="o">+</span> <span class="n">bg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Markers&#34;</span><span class="p">,</span> <span class="n">markers</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建分水岭分割类的对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">WatershedSegmenter</span> <span class="n">segmenter</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置标记图像，然后执行分割过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">segmenter</span><span class="p">.</span><span class="n">setMarkers</span><span class="p">(</span><span class="n">markers</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">segmenter</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Segmentation&#34;</span><span class="p">,</span> <span class="n">segmenter</span><span class="p">.</span><span class="n">getSegmentation</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Watersheds&#34;</span><span class="p">,</span> <span class="n">segmenter</span><span class="p">.</span><span class="n">getWatersheds</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Open another image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">image</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/tower.jpg&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Identify background pixels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">imageMask</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">imageMask</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">5</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Identify foreground pixels (in the middle of the image)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">imageMask</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set markers and process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">segmenter</span><span class="p">.</span><span class="n">setMarkers</span><span class="p">(</span><span class="n">imageMask</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">segmenter</span><span class="p">.</span><span class="n">process</span><span class="p">(</span><span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Display the image with markers
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">5</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">5</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">rectangle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">-</span> <span class="mi">10</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">10</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&#34;Image with marker&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Image with marker&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Display watersheds
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&#34;Watershed&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Watershed&#34;</span><span class="p">,</span> <span class="n">segmenter</span><span class="p">.</span><span class="n">getWatersheds</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !define WATERSHS
</span></span></span><span class="line"><span class="cl"><span class="cp">#define WATERSHS
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">WatershedSegmenter</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">markers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">void</span> <span class="n">setMarkers</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">markerImage</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//转化为整数型图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">markerImage</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">markers</span><span class="p">,</span> <span class="n">CV_32S</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="nf">process</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//应用分水岭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">watershed</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">markers</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">markers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//以图像的形式返回结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getSegmentation</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//所有标签值大于255的区域都赋值为255
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">markers</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//以图像的形式返回分水岭
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getWatersheds</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">markers</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">tmp</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">tmp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !define WATERSHS
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_06----图像滤波">Chapter_06  :  图像滤波</h3>
<blockquote>
<p>1.方块滤波、高斯滤波、resize(), pyrUp(), pyrDown()
2.Sobel滤波器
3.Laplacian算子
4.高斯差分</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/opencv.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;LaplacianZC.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace std;
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace cv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////1.方块滤波、高斯滤波、resize(), pyrUp(), pyrDown()
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image = imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cout &lt;&lt; &#34;image is error&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//  
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////方块滤波
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//blur(image, result, Size(5, 5));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Mean Image&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   //Blur the image with a mean filter 9*9
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//blur(image, result, Size(9, 9));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Mean Image(9 * 9)&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////高斯滤波
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//GaussianBlur(image, result, Size(5, 5), //滤波尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	1.5);                               //控制高斯曲线形状的参数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Gaussian Filtered Image&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the blurred image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Gaussian filtered Image (9x9)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Gaussian filtered Image (9x9)&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////Get the gaussian kernel (1.5)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat gauss = getGaussianKernel(9, 1.5, CV_32F);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////Display kernal value 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat_&lt;float&gt;::const_iterator it = gauss.begin&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat_&lt;float&gt;::const_iterator itend = gauss.end&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34;1.5 = [&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (; it != itend; ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cout &lt;&lt; &#34;]&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////Get the gaussian kernel(0.5)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//gauss = getGaussianKernel(9, 0.5, CV_32F);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display kernel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//it = gauss.begin&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//itend = gauss.end&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;0.5 = [&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (; it != itend; ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;]&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Get the gaussian kernel (2.5)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//gauss = cv::getGaussianKernel(9, 2.5, CV_32F);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display kernel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//it = gauss.begin&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//itend = gauss.end&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;2.5 = [&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (; it != itend; ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;]&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Get the gaussian kernel(9 elements)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//gauss = cv::getGaussianKernel(9, -1, CV_32F);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display kernel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//it = gauss.begin&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//itend = gauss.end&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;9 = [&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (; it != itend; ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; *it &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;]&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Get the Deriv kernel (2.5)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat kx, ky;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::getDerivKernels(kx, ky, 2, 2, 7, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display kernel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat_&lt;float&gt;::const_iterator kit = kx.begin&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat_&lt;float&gt;::const_iterator kitend = kx.end&lt;float&gt;();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;[&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (; kit != kitend; ++kit) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; *kit &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;]&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Read input image with salt&amp;pepper noise
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(&#34;./images/salted.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the S&amp;P image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;S&amp;P Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;S&amp;P Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Blur the image with a mean filter
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::blur(image, result, cv::Size(5, 5));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the blurred image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Mean filtered S&amp;P Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Mean filtered S&amp;P Image&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Applying a median filter
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::medianBlur(image, result, 5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the blurred image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Median filtered Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Median filtered Image&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Reduce by 4 the size of the image (the wrong way)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////只保留每四个像素中的一个
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat reduced(image.rows / 4, image.cols / 4, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i&lt;reduced.rows; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	for (int j = 0; j&lt;reduced.cols; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		reduced.at&lt;uchar&gt;(i, j) = image.at&lt;uchar&gt;(i * 4, j * 4);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the reduced image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Badly reduced Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Badly reduced Image&#34;, reduced);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::resize(reduced, reduced, cv::Size(), 4, 4, cv::INTER_NEAREST);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the (resized) reduced image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Badly reduced&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Badly reduced&#34;, reduced);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imwrite(&#34;badlyreducedimage.bmp&#34;, reduced);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// first remove high frequency component
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::GaussianBlur(image, image, cv::Size(11, 11), 1.75);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// keep only 1 of every 4 pixels
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat reduced2(image.rows / 4, image.cols / 4, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i&lt;reduced2.rows; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	for (int j = 0; j&lt;reduced2.cols; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		reduced2.at&lt;uchar&gt;(i, j) = image.at&lt;uchar&gt;(i * 4, j * 4);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the reduced image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Reduced Image, original size&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Reduced Image, original size&#34;, reduced2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imwrite(&#34;reducedimage.bmp&#34;, reduced2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// resizing with NN
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat newImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::resize(reduced2, newImage, cv::Size(), 4, 4, cv::INTER_NEAREST);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the (resized) reduced image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Reduced Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Reduced Image&#34;, newImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// resizing with bilinear
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::resize(reduced2, newImage, cv::Size(), 4, 4, cv::INTER_LINEAR);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the (resized) reduced image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Bilinear resizing&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Bilinear resizing&#34;, newImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Creating an image pyramid
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat pyramid(image.rows, image.cols + image.cols / 2 + image.cols / 4 + image.cols / 8, CV_8U, cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image.copyTo(pyramid(cv::Rect(0, 0, image.cols, image.rows)));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::pyrDown(image, reduced); // reduce image size by half
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//reduced.copyTo(pyramid(cv::Rect(image.cols, image.rows / 2, image.cols / 2, image.rows / 2)));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::pyrDown(reduced, reduced2); // reduce image size by another half
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//reduced2.copyTo(pyramid(cv::Rect(image.cols + image.cols / 2, image.rows - image.rows / 4, image.cols / 4, image.rows / 4)));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::pyrDown(reduced2, reduced); // reduce image size by another half
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//reduced.copyTo(pyramid(cv::Rect(image.cols + image.cols / 2 + image.cols / 4, image.rows - image.rows / 8, image.cols / 8, image.rows / 8)));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the pyramid
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Pyramid of images&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Pyramid of images&#34;, pyramid);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//2.Sobel滤波器
</span></span></span><span class="line"><span class="cl"><span class="c1">//    Mat image = imread(&#34;./images/boldt.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算Sobel滤波器的X方向
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat sobelX;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Sobel(image,    //输入 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		sobelX,     // 输出
</span></span></span><span class="line"><span class="cl"><span class="c1">//		CV_8U,      //图像类型
</span></span></span><span class="line"><span class="cl"><span class="c1">//		1, 0,       //内核规格
</span></span></span><span class="line"><span class="cl"><span class="c1">//		3,          //正方形内核的尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0.4, 128);  // 比例和偏移量
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Sobel X Image&#34;, sobelX);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算Sobel滤波器的Y方向
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat sobelY;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Sobel(image,    //输入 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		sobelY,     // 输出
</span></span></span><span class="line"><span class="cl"><span class="c1">//		CV_8U,      //图像类型
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0, 1,       //内核规格
</span></span></span><span class="line"><span class="cl"><span class="c1">//		3,          //正方形内核的尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0.4, 128);  // 比例和偏移量
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Sobel Y Image&#34;, sobelY);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//组合这两个结果   计算Sobel滤波器的范数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Sobel(image, sobelX, CV_16S, 1, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Sobel(image, sobelY, CV_16S, 0, 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat sobel;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算L1范数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	sobel = abs(sobelX) + abs(sobelY);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//找到Sobel最大值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	double sobmin, sobmax;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	minMaxLoc(sobel, &amp;sobmin, &amp;sobmax);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;sobel value range:&#34; &lt;&lt; sobmin &lt;&lt; &#34;  &#34; &lt;&lt; sobmax &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Compute Sobel X derivative (7x7)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Sobel(image, sobelX, CV_8U, 1, 0, 7, 0.001, 128);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Sobel X Image (7x7)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Sobel X Image (7x7)&#34;, sobelX);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Print window pixel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i &lt; 12; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		for (int j = 0; j &lt; 12; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//			cout &lt;&lt; setw(5) &lt;&lt; static_cast&lt;int&gt;(sobel.at&lt;short&gt;(i + 79, j + 215)) &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cout &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//转换成8位图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat sobelImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	sobel.convertTo(sobelImage, CV_8U, -255./sobmax, 255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;sobelImage&#34;, sobelImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//进行阈值化
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat sobelThresholded;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	threshold(sobelImage, sobelThresholded, 225, 255, THRESH_BINARY);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;sobelThresholded&#34;, sobelThresholded);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//3.Laplacian算子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//默认的拉普拉斯算子的核的值的大小是 3 * 3
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat laplace;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Laplacian(image, laplace, CV_8U, 1, 1, 128);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Laplacian Image&#34;, laplace);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int cx(238), cy(90);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int dx(12), dy(12);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//一个小的窗口
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat window(image, Rect(cx, cy, dx, dy));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;window&#34;, window);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imwrite(&#34;./images/window.bmp&#34;, window);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//用LaplacianZC类计算拉普拉斯
</span></span></span><span class="line"><span class="cl"><span class="c1">//	LaplactionZC laplacian;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	laplacian.setAperture(7);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat flap = laplacian.computeLaplacian(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// display min max values of the lapalcian
</span></span></span><span class="line"><span class="cl"><span class="c1">//	double lapmin, lapmax;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::minMaxLoc(flap, &amp;lapmin, &amp;lapmax);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// display laplacian image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	laplace = laplacian.getLaplacianImage();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Laplacian Image (7x7)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Laplacian Image (7x7)&#34;, laplace);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Print image values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Image values:\n\n&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i&lt;dx; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//		for (int j = 0; j&lt;dy; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			std::cout &lt;&lt; std::setw(5) &lt;&lt; static_cast&lt;int&gt;(image.at&lt;uchar&gt;(i + cy, j + cx)) &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Print Laplacian values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Laplacian value range=[&#34; &lt;&lt; lapmin &lt;&lt; &#34;,&#34; &lt;&lt; lapmax &lt;&lt; &#34;]\n&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i&lt;dx; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//		for (int j = 0; j&lt;dy; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			std::cout &lt;&lt; std::setw(5) &lt;&lt; static_cast&lt;int&gt;(flap.at&lt;float&gt;(i + cy, j + cx) / 100) &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Compute and display the zero-crossing points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat zeros;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	zeros = laplacian.getZeroCrossings(flap);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Zero-crossings&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Zero-crossings&#34;, 255 - zeros);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Print window pixel values
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Zero values:\n\n&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i&lt;dx; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//		for (int j = 0; j&lt;dy; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			std::cout &lt;&lt; std::setw(2) &lt;&lt; static_cast&lt;int&gt;(zeros.at&lt;uchar&gt;(i + cy, j + cx)) / 255 &lt;&lt; &#34; &#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//		std::cout &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// down-sample and up-sample the image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat reduced, rescaled;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::pyrDown(image, reduced);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::pyrUp(reduced, rescaled);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the rescaled image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Rescaled Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Rescaled Image&#34;, rescaled);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//4.高斯差分（DoG）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat dog;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算高斯差分
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::subtract(rescaled, image, dog, cv::Mat(), CV_16S);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat dogImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	dog.convertTo(dogImage, CV_8U, 1.0, 128);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the DoG image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;DoG Image (from pyrdown/pyrup)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;DoG Image (from pyrdown/pyrup)&#34;, dogImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Apply two Gaussian filters
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat gauss05;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat gauss15;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::GaussianBlur(image, gauss05, cv::Size(), 0.5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::GaussianBlur(image, gauss15, cv::Size(), 1.5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// compute a difference of Gaussians 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::subtract(gauss15, gauss05, dog, cv::Mat(), CV_16S);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	dog.convertTo(dogImage, CV_8U, 2.0, 128);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the DoG image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;DoG Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;DoG Image&#34;, dogImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Apply two Gaussian filters
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat gauss20;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::GaussianBlur(image, gauss20, cv::Size(), 2.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat gauss22;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::GaussianBlur(image, gauss22, cv::Size(), 2.2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// compute a difference of Gaussians 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::subtract(gauss22, gauss20, dog, cv::Mat(), CV_32F);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	dog.convertTo(dogImage, CV_8U, 10.0, 128);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the DoG image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;DoG Image (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;DoG Image (2)&#34;, dogImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// 计算高斯差分的过零点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	zeros = laplacian.getZeroCrossings(dog);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Zero-crossings of DoG&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Zero-crossings of DoG&#34;, 255 - zeros);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the image with window
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::rectangle(image, cv::Rect(cx, cy, dx, dy), cv::Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Original Image with window&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Original Image with window&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_07--提取直线轮廓和区域">Chapter_07 : 提取直线、轮廓和区域</h3>
<blockquote>
<p>1.Sobel算子的部分   Canny边缘提取
2.用霍夫变换检测直线
3.用概率霍夫变换检测直线
4.点集的直线拟合
5.提取连续区域</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/opencv.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;vector&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;EdgeDetector.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;LineFinder.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace std;
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace cv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image = imread(&#34;./images/road.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////计算Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//EdgeDetector ed;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ed.computeSobel(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////展示Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Sobel (orientation)&#34;, ed.getSobelOrientationImage());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imwrite(&#34;./images/ori.bmp&#34;, ed.getSobelOrientationImage());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the Sobel low threshold
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Sobel (low threshold)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Sobel (low threshold)&#34;, ed.getBinaryMap(125));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the Sobel high threshold
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Sobel (high threshold)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Sobel (high threshold)&#34;, ed.getBinaryMap(350));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////运用Canny边缘算子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat contours;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Canny(image,             //灰度图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	contours,            //输出轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	125,                 //低阈值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	350);                //高阈值
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Canny&#34;, 255 - contours);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////创建一个测试的图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat test(200, 200, CV_8U, Scalar(0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(100, 0), cv::Point(200, 200), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(0, 50), cv::Point(200, 200), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(0, 200), cv::Point(200, 0), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(200, 0), cv::Point(0, 200), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(100, 0), cv::Point(100, 200), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(test, cv::Point(0, 100), cv::Point(200, 100), cv::Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the test image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Test Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Test Image&#34;, test);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imwrite(&#34;test.bmp&#34;, test);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////2.用霍夫变换检测直线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Vec2f&gt; lines;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//HoughLines(contours, lines, 1,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	PI/180,          //步长
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//    60);             //最小投票数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat result(contours.rows, contours.cols, CV_8U, Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image.copyTo(result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34;Lines detected&#34; &lt;&lt; lines.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Vec2f&gt;::const_iterator it = lines.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//while (it != lines.end())
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	float rho = (*it)[0];     //第一个元素是距离rho
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	float theta = (*it)[1];   //第二个元素是角度theta
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	if (theta &lt; PI/4. || theta &gt; 3.*PI / 4) //垂直线（大致）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//直线与第一行的交叉点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		Point pt1(rho/cos(theta), 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//直线与最后一行的交叉点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		Point pt2((rho - result.rows * sin(theta)) / cos(theta), result.rows);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//画白色的线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		line(result, pt1, pt2, Scalar(255), 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	else //水平线（大致）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//直线与第一列的交叉点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		Point pt1(0, rho/sin(theta));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//直线与最后一列的交叉点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		Point pt2(result.cols, (rho - result.cols * cos(theta)) / sin(theta));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//画白色的线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		line(result, pt1, pt2, Scalar(255), 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cout &lt;&lt; &#34;line: (&#34; &lt;&lt; rho &lt;&lt; &#34;,&#34; &lt;&lt; theta &lt;&lt; &#34;)\n&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	++it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;HoughLines&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////3.用概率霍夫变换检测直线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////创建LineFinder类的实例
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//LineFinder finder;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////设置概率霍夫变换的参数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//finder.setLineLengthAndGap(100, 20);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//finder.setMinVote(60);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////检测直线并画直线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Vec4i&gt; linesp = finder.findLines(contours);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//finder.drawDetectedLines(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec4i&gt;::const_iterator it2 = linesp.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//while (it2 != linesp.end()) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; &#34;(&#34; &lt;&lt; (*it2)[0] &lt;&lt; &#34;,&#34; &lt;&lt; (*it2)[1] &lt;&lt; &#34;)-(&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		&lt;&lt; (*it2)[2] &lt;&lt; &#34;,&#34; &lt;&lt; (*it2)[3] &lt;&lt; &#34;)&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	++it2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;HoughLinesp&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////4.点集的直线拟合
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = imread(&#34;./images/road.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int n = 0;  //选用直线0
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//line(image, Point(linesp[n][0], linesp[n][1]), Point(linesp[n][2], linesp[n][3]),Scalar(255), 5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;One line of the Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////黑白图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat oneline(image.size(), CV_8U, Scalar(0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////白色直线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//line(oneline, Point(linesp[n][0], linesp[n][1]), Point(linesp[n][2], linesp[n][3]), Scalar(255), 3);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////轮廓与白色直线进行与&amp;操作
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//bitwise_and(contours, oneline, oneline);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;One line&#34;, 255 - oneline);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Point&gt; points;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////迭代遍历像素，得到所有点的位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int y = 0; y &lt; oneline.rows; y++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//行y
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	uchar *rowPtr = oneline.ptr&lt;uchar&gt;(y);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	for (int x = 0; x &lt; oneline.cols; x++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//列x
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//如果在轮廓上
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		if (rowPtr[x])
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			points.push_back(Point(x, y));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////得到点集后， 利用这些点集拟合出直线， fitLine可以轻松的得到最优的拟合直线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Vec4f line;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//fitLine(points, line,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	DIST_L2,    //距离类型
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	0,          //L2距离不用这个参数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	0.01, 0.01);//精度
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34;line: (&#34; &lt;&lt; line[0] &lt;&lt; &#34;,&#34; &lt;&lt; line[1] &lt;&lt; &#34;)(&#34; &lt;&lt; line[2] &lt;&lt; &#34;,&#34; &lt;&lt; line[3] &lt;&lt; &#34;)\n&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int x0 = line[2];      //直线上一个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int y0 = line[3];      
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int x1 = x0 + 100 * line[0];  //加上长度为100的向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int y1 = y0 + 100 * line[1];  //（用单位向量生成）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = imread(&#34;./images/road.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////绘制这条线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(image, Point(x0, y0), Point(x1, y1), Scalar(0), 0.2); //颜色和宽度
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Fitted line&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// eliminate inconsistent lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//finder.removeLinesOfInconsistentOrientations(ed.getOrientation(), 0.4, 0.1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the detected line image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(&#34;./images/road.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//finder.drawDetectedLines(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Detected Lines (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Detected Lines (2)&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////创建霍夫累加器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////这里的用的图像类型是uchar，实际类型应该是int
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat acc(200, 180, CV_8U, cv::Scalar(0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////选取一个像素点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int x = 50, y = 30;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////循环遍历所有角度
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i&lt;180; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	double theta = i*PI / 180.;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//找到对应的rho值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	double rho = x*std::cos(theta) + y*std::sin(theta);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//j对应-100到100的rho
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	int j = static_cast&lt;int&gt;(rho + 100.5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; i &lt;&lt; &#34;,&#34; &lt;&lt; j &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//增加累加器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	acc.at&lt;uchar&gt;(j, i)++;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// draw the axes
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(acc, cv::Point(0, 0), cv::Point(0, acc.rows - 1), 255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::line(acc, cv::Point(acc.cols - 1, acc.rows - 1), cv::Point(0, acc.rows - 1), 255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imwrite(&#34;./images/hough1.bmp&#34;, 255 - (acc * 100));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Choose a second point
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//x = 30, y = 10;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// loop over all angles
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i&lt;180; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	double theta = i*PI / 180.;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	double rho = x*cos(theta) + y*sin(theta);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	int j = static_cast&lt;int&gt;(rho + 100.5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	acc.at&lt;uchar&gt;(j, i)++;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Hough Accumulator&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Hough Accumulator&#34;, acc * 100);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imwrite(&#34;./images/hough2.bmp&#34;, 255 - (acc * 100));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////检测圆
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(&#34;./images/chariot.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::GaussianBlur(image, image, cv::Size(5, 5), 1.5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec3f&gt; circles;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::HoughCircles(image, circles, cv::HOUGH_GRADIENT,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	2,   // 累加器分辨率(图像尺寸 / 2) 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	20,  // 两个圆之间的最小距离
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	200, // Canny算子的高阈值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	60, // 最小投票数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	15, 50); // 最小和最大半径
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Circles: &#34; &lt;&lt; circles.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Draw the circles
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(&#34;./images/chariot.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec3f&gt;::const_iterator itc = circles.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//while (itc != circles.end()) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::circle(image,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Point((*itc)[0], (*itc)[1]), // 圆心
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		(*itc)[2], //半径
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Scalar(255), // 颜色
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		2); // 厚度
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	++itc;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Detected Circles&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Detected Circles&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//5.提取连续区域
</span></span></span><span class="line"><span class="cl"><span class="c1">//    Mat image = imread(&#34;./images/binaryGroup.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="c1">//	if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Binary Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//用于存储轮廓的向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;vector&lt;Point&gt; &gt; contours;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	findContours(image,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		contours,           //存储轮廓的向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//		RETR_EXTERNAL,      //检查外部轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//		CHAIN_APPROX_NONE); //每个轮廓的全部像素
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//查看轮廓得数量
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Contours: &#34; &lt;&lt; contours.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;vector&lt;Point&gt; &gt;::const_iterator itContours = contours.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (; itContours != contours.end(); ++itContours)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cout &lt;&lt; &#34;Size: &#34; &lt;&lt; itContours-&gt;size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//在白色图像上画黑色轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat result(image.size(), CV_8U, Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawContours(result, contours,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		-1,  //画出全部轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0,   //用黑色画
</span></span></span><span class="line"><span class="cl"><span class="c1">//		2    //厚度为2
</span></span></span><span class="line"><span class="cl"><span class="c1">//	);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Contours&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//删除太短或者太长的轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int cmin = 50;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int cmax = 500;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt; vector&lt;Point&gt; &gt; ::iterator itc = contours.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	while (itc != contours.end())
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		if (itc-&gt;size() &lt; cmin || itc-&gt;size() &gt; cmax)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			itc = contours.erase(itc);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		else
</span></span></span><span class="line"><span class="cl"><span class="c1">//			++itc;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// draw contours on the original image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat original = cv::imread(&#34;./images/group.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::drawContours(original, contours,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		-1, // draw all contours
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Scalar(255, 255, 255), // in white
</span></span></span><span class="line"><span class="cl"><span class="c1">//		2); // with a thickness of 2
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Contours on Animals&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Contours on Animals&#34;, original);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result.setTo(Scalar(255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawContours(result, contours, -1, 0, 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/binaryGroup.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//需要思考的是这个二维的矩阵，行代表什么，列代表什么？
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//首先说，行：代表了一个轮廓，每行的数据是一个数组，数组里面是一系列的点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//这些点代表了这个轮廓的位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//所以，contours[0]，代表了第一个轮廓，contours[0][0]，代表了第一个轮廓的某个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//A.测试边界框
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Rect r0 = boundingRect(contours[0]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画矩形
</span></span></span><span class="line"><span class="cl"><span class="c1">//	rectangle(result, r0, 0, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//B.测试覆盖圆
</span></span></span><span class="line"><span class="cl"><span class="c1">//	float radius;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Point2f center;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	minEnclosingCircle(contours[1], center, radius);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画圆型
</span></span></span><span class="line"><span class="cl"><span class="c1">//	circle(result, center, static_cast&lt;int&gt;(radius), 0, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//C.测试多边形逼近
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;Point&gt; poly;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	approxPolyDP(contours[2], poly, 5, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画多边形
</span></span></span><span class="line"><span class="cl"><span class="c1">//	polylines(result, poly, true, 0, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Polygon size: &#34; &lt;&lt; poly.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//D.测试凸包（另一种形式的多边形逼近）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::vector&lt;cv::Point&gt; hull;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::convexHull(contours[3], hull);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画多边形
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::polylines(result, hull, true, 0, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测轮廓矩
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//迭代遍历所有轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//在所有区域内部画出重心
</span></span></span><span class="line"><span class="cl"><span class="c1">//	itc = contours.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	while (itc != contours.end()) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		//计算所有矩形轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Moments mom = cv::moments(*itc++);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		//画重心
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::circle(result,
</span></span></span><span class="line"><span class="cl"><span class="c1">//			// 将重心位置转换成整数
</span></span></span><span class="line"><span class="cl"><span class="c1">//			cv::Point(mom.m10 / mom.m00, mom.m01 / mom.m00),
</span></span></span><span class="line"><span class="cl"><span class="c1">//			2, cv::Scalar(0), 2); // 画黑点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Some Shape descriptors&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Some Shape descriptors&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// 打开一副新的图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = cv::imread(&#34;./images/binaryGroup.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::findContours(image,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		contours, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::RETR_LIST, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::CHAIN_APPROX_NONE); 
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	result.setTo(255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::drawContours(result, contours,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		-1, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0,  
</span></span></span><span class="line"><span class="cl"><span class="c1">//		2); 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;All Contours&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;All Contours&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// get a MSER image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat components;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	components = cv::imread(&#34;./images/mser.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// create a binary version
</span></span></span><span class="line"><span class="cl"><span class="c1">//	components = components == 255;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// open the image (white background)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::morphologyEx(components, components, cv::MORPH_OPEN, cv::Mat(), cv::Point(-1, -1), 3);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;MSER image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;MSER image&#34;, components);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	contours.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//翻转图像 (background must be black)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat componentsInv = 255 - components;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//得到连续区域的轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::findContours(componentsInv,
</span></span></span><span class="line"><span class="cl"><span class="c1">//		contours, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::RETR_EXTERNAL, //检索外部向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::CHAIN_APPROX_NONE); 
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// white image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat quadri(components.size(), CV_8U, 255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//针对全部轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::vector&lt;std::vector&lt;cv::Point&gt; &gt;::iterator it = contours.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	while (it != contours.end()) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//		poly.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//		// 多边形逼近轮廓
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::approxPolyDP(*it, poly, 5, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		// 是否为四边形
</span></span></span><span class="line"><span class="cl"><span class="c1">//		if (poly.size() == 4) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//			// 画出来
</span></span></span><span class="line"><span class="cl"><span class="c1">//			cv::polylines(quadri, poly, true, 0, 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		++it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;MSER quadrilateral&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;MSER quadrilateral&#34;, quadri);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defineed SOBELEDGES
</span></span></span><span class="line"><span class="cl"><span class="cp">#define SOBELEDGES
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define PI 3.1415926
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">EdgeDetector</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// original image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 16-bit signed int image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">sobel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Aperture size of the Sobel kernel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">aperture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Sobel magnitude
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">sobelMagnitude</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Sobel orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">sobelOrientation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">EdgeDetector</span><span class="p">()</span> <span class="o">:</span> <span class="n">aperture</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the aperture size of the kernel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setAperture</span><span class="p">(</span><span class="kt">int</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">aperture</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get the aperture size of the kernel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">getAperture</span><span class="p">()</span> <span class="k">const</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">aperture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Compute the Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">computeSobel</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">sobelX</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">sobelY</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Compute Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sobelX</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">aperture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sobelY</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aperture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 将笛卡尔坐标系转化为极坐标，得到幅值和角度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">sobelX</span><span class="p">,</span> <span class="n">sobelY</span><span class="p">,</span> <span class="n">sobelMagnitude</span><span class="p">,</span> <span class="n">sobelOrientation</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Compute the Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">computeSobel</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">sobelX</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">sobelY</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Compute Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sobelX</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">aperture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Sobel</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">sobelY</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">aperture</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Compute magnitude and orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">cartToPolar</span><span class="p">(</span><span class="n">sobelX</span><span class="p">,</span> <span class="n">sobelY</span><span class="p">,</span> <span class="n">sobelMagnitude</span><span class="p">,</span> <span class="n">sobelOrientation</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get Sobel magnitude
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getMagnitude</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">sobelMagnitude</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get Sobel orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getOrientation</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">sobelOrientation</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get a thresholded binary map
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getBinaryMap</span><span class="p">(</span><span class="kt">double</span> <span class="n">threshold</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">sobelMagnitude</span><span class="p">,</span> <span class="n">bin</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get a CV_8U image of the Sobel
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getSobelImage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">double</span> <span class="n">minval</span><span class="p">,</span> <span class="n">maxval</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">minMaxLoc</span><span class="p">(</span><span class="n">sobelMagnitude</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">minval</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">sobelMagnitude</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">bin</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="mi">255</span> <span class="o">/</span> <span class="n">maxval</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Get a CV_8U image of the Sobel orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 1 gray-level = 2 degrees
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getSobelOrientationImage</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">sobelOrientation</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">bin</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">,</span> <span class="mi">90</span> <span class="o">/</span> <span class="n">PI</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">bin</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defineed SOBELEDGES
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !define LINEF
</span></span></span><span class="line"><span class="cl"><span class="cp">#define LINEF
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="cp">#define PI 3.1415926
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">LineFinder</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//原始图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">img</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//包含被检测直线的端点的向量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">lines</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//累加器分辨率参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">deltaRho</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">double</span> <span class="n">deltaTheta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//确认直线之前必须收到的最小投票数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">minVote</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//直线的最小长度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">minLength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//直线上允许的最大空隙
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">maxGap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//默认累加器分辨率是1像素，1度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//没有空隙，没有最小长度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">LineFinder</span><span class="p">()</span> <span class="o">:</span><span class="n">deltaRho</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">deltaTheta</span><span class="p">(</span><span class="n">PI</span> <span class="o">/</span> <span class="mi">180</span><span class="p">),</span> <span class="n">minVote</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">minLength</span><span class="p">(</span><span class="mf">0.</span><span class="p">),</span> <span class="n">maxGap</span><span class="p">(</span><span class="mf">0.</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置累加器的分辨率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setAccResolution</span><span class="p">(</span><span class="kt">double</span> <span class="n">dRho</span><span class="p">,</span> <span class="kt">double</span> <span class="n">dTheta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">deltaRho</span> <span class="o">=</span> <span class="n">dRho</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">deltaTheta</span> <span class="o">=</span> <span class="n">dTheta</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//设置最小投票数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setMinVote</span><span class="p">(</span><span class="kt">int</span> <span class="n">minv</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">minVote</span> <span class="o">=</span> <span class="n">minv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置直线长度和空隙
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setLineLengthAndGap</span><span class="p">(</span><span class="kt">double</span> <span class="n">length</span><span class="p">,</span> <span class="kt">double</span> <span class="n">gap</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">minLength</span> <span class="o">=</span> <span class="n">length</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">maxGap</span> <span class="o">=</span> <span class="n">gap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//应用概率霍夫变换
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">findLines</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">binary</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">lines</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">HoughLinesP</span><span class="p">(</span><span class="n">binary</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">deltaRho</span><span class="p">,</span> <span class="n">deltaTheta</span><span class="p">,</span> <span class="n">minVote</span><span class="p">,</span> <span class="n">minLength</span><span class="p">,</span> <span class="n">maxGap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">lines</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//在图像上绘制出检测出来的直线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">drawDetectedLines</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Scalar</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//画直线
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">Vec4i</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it2</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="n">it2</span> <span class="o">!=</span> <span class="n">lines</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">Point</span> <span class="n">pt1</span><span class="p">((</span><span class="o">*</span><span class="n">it2</span><span class="p">)[</span><span class="mi">0</span><span class="p">],</span> <span class="p">(</span><span class="o">*</span><span class="n">it2</span><span class="p">)[</span><span class="mi">1</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">			<span class="n">Point</span> <span class="n">pt2</span><span class="p">((</span><span class="o">*</span><span class="n">it2</span><span class="p">)[</span><span class="mi">2</span><span class="p">],</span> <span class="p">(</span><span class="o">*</span><span class="n">it2</span><span class="p">)[</span><span class="mi">3</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">line</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">pt1</span><span class="p">,</span> <span class="n">pt2</span><span class="p">,</span> <span class="n">color</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">++</span><span class="n">it2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Eliminates lines that do not have an orientation equals to
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// the ones specified in the input matrix of orientations
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// At least the given percentage of pixels on the line must 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// be within plus or minus delta of the corresponding orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;</span> <span class="n">removeLinesOfInconsistentOrientations</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">orientations</span><span class="p">,</span> <span class="kt">double</span> <span class="n">percentage</span><span class="p">,</span> <span class="kt">double</span> <span class="n">delta</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Vec4i</span><span class="o">&gt;::</span><span class="n">iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">lines</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// check all lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">while</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">lines</span><span class="p">.</span><span class="n">end</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// end points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kt">int</span> <span class="n">x1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">y1</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">x2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">y2</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// line orientation + 90o to get the parallel line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kt">double</span> <span class="n">ori1</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y1</span> <span class="o">-</span> <span class="n">y2</span><span class="p">),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">))</span> <span class="o">+</span> <span class="n">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">ori1</span><span class="o">&gt;</span><span class="n">PI</span><span class="p">)</span> <span class="n">ori1</span> <span class="o">=</span> <span class="n">ori1</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">PI</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="kt">double</span> <span class="n">ori2</span> <span class="o">=</span> <span class="n">atan2</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y2</span> <span class="o">-</span> <span class="n">y1</span><span class="p">),</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x2</span> <span class="o">-</span> <span class="n">x1</span><span class="p">))</span> <span class="o">+</span> <span class="n">PI</span> <span class="o">/</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">ori2</span><span class="o">&gt;</span><span class="n">PI</span><span class="p">)</span> <span class="n">ori2</span> <span class="o">=</span> <span class="n">ori2</span> <span class="o">-</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">PI</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// for all points on the line
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">LineIterator</span> <span class="n">lit</span><span class="p">(</span><span class="n">orientations</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lit</span><span class="p">.</span><span class="n">count</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">,</span> <span class="o">++</span><span class="n">lit</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="kt">float</span> <span class="n">ori</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="k">reinterpret_cast</span><span class="o">&lt;</span><span class="kt">float</span> <span class="o">*&gt;</span><span class="p">(</span><span class="o">*</span><span class="n">lit</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// is line orientation similar to gradient orientation ?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">min</span><span class="p">(</span><span class="n">fabs</span><span class="p">(</span><span class="n">ori</span> <span class="o">-</span> <span class="n">ori1</span><span class="p">),</span> <span class="n">fabs</span><span class="p">(</span><span class="n">ori</span> <span class="o">-</span> <span class="n">ori2</span><span class="p">))</span><span class="o">&lt;</span><span class="n">delta</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="n">count</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="kt">double</span> <span class="n">consistency</span> <span class="o">=</span> <span class="n">count</span> <span class="o">/</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// set to zero lines of inconsistent orientation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">consistency</span> <span class="o">&lt;</span> <span class="n">percentage</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="o">*</span><span class="n">it</span><span class="p">)[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">++</span><span class="n">it</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">lines</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !define LINEF
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_08--检测兴趣点">Chapter_08 : 检测兴趣点</h3>
<blockquote>
<p>1.Harris角点检测
2.GFTT(good-features-to-track)
3.drawKeypoints() 换关键点的通用函数
4.FAST角点检测
5.SURF尺度不变的特征检测
6.SIFT尺度不变特征转换
7.BRISK(二元稳健恒定可扩展关键点)检测法
8.ORB特征检测算法</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/opencv.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/core.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/features2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/imgproc.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/highgui.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/xfeatures2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;HarrisDetector.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace std;
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace cv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//1.Harris角点检测
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	if (!image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//变成水平的
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测Harris角点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat cornerStrength;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cornerHarris(image, cornerStrength, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		         3,     //领域尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//		         3,     //口径尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//		         0.01); //Harris参数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//对角点强度进行阈值化
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat harrisCorners;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	double threshold = 0.0001;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::threshold(cornerStrength, harrisCorners, threshold, 255, THRESH_BINARY_INV);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;Harris_threshold&#34;, harrisCorners);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//用一个类去封装Harris
</span></span></span><span class="line"><span class="cl"><span class="c1">//	HarrisDetected harris;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算Harris值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	harris.detect(image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测Harris角点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;Point&gt; pts;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	harris.getCorners(pts, 0.02);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画出Harris角点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	harris.drawOnImage(image, pts);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;HarrisDetected&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//2.GFTT(good-features-to-track)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// rotate the image (to produce a horizontal image)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//计算适合跟踪的特征
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt; keypoints;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//GFTT检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;GFTTDetector&gt; ptrGFTT = GFTTDetector::create(
</span></span></span><span class="line"><span class="cl"><span class="c1">//		500,   //关键点的最大值
</span></span></span><span class="line"><span class="cl"><span class="c1">//		0.01,  //质量等级
</span></span></span><span class="line"><span class="cl"><span class="c1">//		10     //角点之间允许的最短距离
</span></span></span><span class="line"><span class="cl"><span class="c1">//	);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测GFTT
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrGFTT-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//展示所有关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt;::const_iterator it = keypoints.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	while (it != keypoints.end())
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		//对每个关键点画圆
</span></span></span><span class="line"><span class="cl"><span class="c1">//		circle(image, it-&gt;pt, 3, Scalar(255, 255, 255), 1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		++it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;GFTT&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//3.drawKeypoints() 换关键点的通用函数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read input image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = cv::imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// rotate the image (to produce a horizontal image)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Opencv也提供了在图像上画关键点的通用函数
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::drawKeypoints(image,		// 原始图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//		keypoints,					// 关键点的向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//		image,						// 输出图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Scalar(255, 255, 255),	// 关键点颜色
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::DrawMatchesFlags::DRAW_OVER_OUTIMG); //画图标志
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Good Features to Track Detector&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Good Features to Track Detector&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//4.FAST角点检测
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//最终的关键点容器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//FAST特征检测器，阈值为40
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;FastFeatureDetector&gt; ptrFAST = FastFeatureDetector::create(40);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrFAST-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, image, Scalar(255, 255,255), DrawMatchesFlags::DRAW_OVER_OUTIMG);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Number of keypoints(FAST): &#34; &lt;&lt; keypoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;FAST_01&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//FAST_02----非极大抑制
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrFAST-&gt;setNonmaxSuppression(false);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrFAST-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画出关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, image, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_OVER_OUTIMG);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;FAST FEATURES(ALL)&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//FAST_03----Grid
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int total(100);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int hstep(5), vstep(3);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int hsize(image.cols / hstep), vsize(image.rows / vstep);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	int subtotal(total / (hstep * vstep));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat imageROI;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt; gridpoints;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Grid of&#34; &lt;&lt; vstep &lt;&lt; &#34;by&#34; &lt;&lt; hstep &lt;&lt; &#34;each of size&#34; &lt;&lt; vsize &lt;&lt; &#34;by&#34; &lt;&lt; hsize &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测低阈值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrFAST-&gt;setThreshold(20);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//非极大抑制
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrFAST-&gt;setNonmaxSuppression(true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//最终的关键点容器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测每一个网格
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i &lt; vstep; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//		for (int j = 0; j &lt; hstep; j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//在当前网格创建ROI
</span></span></span><span class="line"><span class="cl"><span class="c1">//			imageROI = image(Rect(j * hsize, i * vsize, hsize, vsize));
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//在网格中检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//			gridpoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//			ptrFAST-&gt;detect(imageROI, gridpoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//			cout &lt;&lt; &#34;Number of FAST in grid&#34; &lt;&lt; i &lt;&lt; &#34;,&#34; &lt;&lt; j &lt;&lt; &#34;:&#34; &lt;&lt; gridpoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//			if (gridpoints.size() &gt; subtotal)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			{
</span></span></span><span class="line"><span class="cl"><span class="c1">//				for (auto it = gridpoints.begin(); it != gridpoints.begin() + subtotal; ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1">//				{
</span></span></span><span class="line"><span class="cl"><span class="c1">//					std::cout &lt;&lt; &#34;  &#34; &lt;&lt; it-&gt;response &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//				}
</span></span></span><span class="line"><span class="cl"><span class="c1">//			}
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//获取最大强度的FAST特征
</span></span></span><span class="line"><span class="cl"><span class="c1">//			auto itEnd(gridpoints.end());
</span></span></span><span class="line"><span class="cl"><span class="c1">//			if (gridpoints.size() &gt; subtotal)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			{
</span></span></span><span class="line"><span class="cl"><span class="c1">//				//选取最强的特征
</span></span></span><span class="line"><span class="cl"><span class="c1">//				nth_element(gridpoints.begin(), gridpoints.begin() + subtotal, gridpoints.end(),
</span></span></span><span class="line"><span class="cl"><span class="c1">//					[](KeyPoint &amp;a, KeyPoint &amp;b) {return a.response &gt; b.response; });
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//				itEnd = gridpoints.begin() + subtotal;
</span></span></span><span class="line"><span class="cl"><span class="c1">//			}
</span></span></span><span class="line"><span class="cl"><span class="c1">//			//加入全局特征容器
</span></span></span><span class="line"><span class="cl"><span class="c1">//			for (auto it = gridpoints.begin(); it != itEnd; ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1">//			{
</span></span></span><span class="line"><span class="cl"><span class="c1">//				//转换成图上的坐标
</span></span></span><span class="line"><span class="cl"><span class="c1">//				it-&gt;pt += Point2f(j * hsize, i * vsize);
</span></span></span><span class="line"><span class="cl"><span class="c1">//				keypoints.push_back(*it);
</span></span></span><span class="line"><span class="cl"><span class="c1">//				cout &lt;&lt; &#34;  &#34; &lt;&lt; it-&gt;response &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//			}
</span></span></span><span class="line"><span class="cl"><span class="c1">//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, image, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_OVER_OUTIMG);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;FAST Features (grid)&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//5.SURF尺度不变的特征检测
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//   
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//创建SURF特征检测器对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;xfeatures2d::SurfFeatureDetector&gt; ptrSURF = xfeatures2d::SurfFeatureDetector::create(2000.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrSURF-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画出关键点，包括尺度和方向信息
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat featureImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;SURF&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Number of SURF keypoints: &#34; &lt;&lt; keypoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read a second input image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = cv::imread(&#34;./images/church03.jpg&#34;, cv::IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// rotate the image (to produce a horizontal image)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Detect the SURF features
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrSURF-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::drawKeypoints(image, keypoints, featureImage, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Display the keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;SURF (2)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;SURF (2)&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//6.SIFT尺度不变特征转换
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;xfeatures2d::SiftFeatureDetector&gt; ptrSIFT = xfeatures2d::SiftFeatureDetector::create();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrSIFT-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255,255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;SIFT&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Number of SIFT keypoints: &#34; &lt;&lt; keypoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//7.BRISK(二元稳健恒定可扩展关键点)检测法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//构造BRISK特征检测器对象
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;BRISK&gt; ptrBRISK = BRISK::create(60, 5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrBRISK-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;BRISK&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Number of BRISK keypoints: &#34; &lt;&lt; keypoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//8.ORB特征检测算法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	image = imread(&#34;./images/church01.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	transpose(image, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	flip(image, image, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	keypoints.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//构造ORB特征检测器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="c1">//	Ptr&lt;ORB&gt; ptrORB = ORB::create(75, 1.2, 8);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	ptrORB-&gt;detect(image, keypoints);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画出关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image, keypoints, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;ORB&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cout &lt;&lt; &#34;Number of ORB keypoints: &#34; &lt;&lt; keypoints.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !define HARRISD
</span></span></span><span class="line"><span class="cl"><span class="cp">#define HARRISD
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">HarrisDetected</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//32位浮点整数的角点强度图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">cornerStrength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//32位浮点整数的阈值化角点图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">cornerTh</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//局部最大值图像（内部）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">localMax</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//平滑导数的领域尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">neighborhood</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//梯度计算的口径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">aperture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Harris参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">k</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//阈值计算的最大强度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">maxStrength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//计算得到的阈值（内部）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">threshold</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//非最大值抑制的领域尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">nonMaxSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//非最大值抑制的内核
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">kernel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">HarrisDetected</span><span class="p">()</span> <span class="o">:</span> <span class="n">neighborhood</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">aperture</span><span class="p">(</span><span class="mi">3</span><span class="p">),</span> <span class="n">k</span><span class="p">(</span><span class="mf">0.1</span><span class="p">),</span> <span class="n">maxStrength</span><span class="p">(</span><span class="mf">0.0</span><span class="p">),</span> <span class="n">threshold</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">nonMaxSize</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">setLocalMaxWindowSize</span><span class="p">(</span><span class="n">nonMaxSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//创建用于抑制非最大值的内核
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setLocalMaxWindowSize</span><span class="p">(</span><span class="kt">int</span> <span class="n">size</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">nonMaxSize</span> <span class="o">=</span> <span class="n">size</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">kernel</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">nonMaxSize</span><span class="p">,</span> <span class="n">nonMaxSize</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//计算Harris角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">detect</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//计算Harris
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cornerHarris</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">cornerStrength</span><span class="p">,</span> <span class="n">neighborhood</span><span class="p">,</span> <span class="n">aperture</span><span class="p">,</span> <span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//计算内部阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">minMaxLoc</span><span class="p">(</span><span class="n">cornerStrength</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">maxStrength</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//检测局部最大值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">dilated</span><span class="p">;</span>  <span class="c1">//临时图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">dilate</span><span class="p">(</span><span class="n">cornerStrength</span><span class="p">,</span> <span class="n">dilated</span><span class="p">,</span> <span class="n">Mat</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">		<span class="n">compare</span><span class="p">(</span><span class="n">cornerStrength</span><span class="p">,</span> <span class="n">dilated</span><span class="p">,</span> <span class="n">localMax</span><span class="p">,</span> <span class="n">CMP_EQ</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用Harris值得到角点分布图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">getCornerMap</span><span class="p">(</span><span class="kt">double</span> <span class="n">qualityLeval</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">Mat</span> <span class="n">cornerMap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//对角点强度进行阈值化
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">threshold</span> <span class="o">=</span> <span class="n">qualityLeval</span> <span class="o">*</span> <span class="n">maxStrength</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">cornerStrength</span><span class="p">,</span> <span class="n">cornerTh</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">THRESH_BINARY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//转换成8位图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cornerTh</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">cornerMap</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//非最大值抑制
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">bitwise_and</span><span class="p">(</span><span class="n">cornerMap</span><span class="p">,</span> <span class="n">localMax</span><span class="p">,</span> <span class="n">cornerMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">cornerMap</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用Harris值得到特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">getCorners</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="kt">double</span> <span class="n">qualityLevel</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//获得角点分布图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">cornerMap</span> <span class="o">=</span> <span class="n">getCornerMap</span><span class="p">(</span><span class="n">qualityLevel</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//获得角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">getCorners</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">cornerMap</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//用角点分布图得到特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">getCorners</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">cornerMap</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//迭代遍历像素，得到所有特征
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">cornerMap</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">const</span> <span class="n">uchar</span> <span class="o">*</span><span class="n">rowPtr</span> <span class="o">=</span> <span class="n">cornerMap</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">cornerMap</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//如果他是一个特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="p">(</span><span class="n">rowPtr</span><span class="p">[</span><span class="n">x</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">				<span class="p">{</span>
</span></span><span class="line"><span class="cl">					<span class="n">points</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//在特征点的位置画圆
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">drawOnImage</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">points</span><span class="p">,</span> <span class="n">Scalar</span> <span class="n">color</span> <span class="o">=</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="kt">int</span> <span class="n">radius</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="kt">int</span> <span class="n">thickness</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">vector</span> <span class="o">&lt;</span><span class="n">Point</span><span class="o">&gt;</span> <span class="o">::</span><span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">points</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//针对所有角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">while</span> <span class="p">(</span><span class="n">it</span> <span class="o">!=</span> <span class="n">points</span><span class="p">.</span><span class="n">end</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//在每个角点位置画圆
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">circle</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="o">*</span><span class="n">it</span><span class="p">,</span> <span class="n">radius</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="n">thickness</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="o">++</span><span class="n">it</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !define HARRISD
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_09--描述和匹配兴趣点">Chapter_09 : 描述和匹配兴趣点</h3>
<blockquote>
<p>1.局部模板匹配&mdash;-两个图像的匹配和找一样的模板
2.描述并匹配局部强度值模式&mdash;-SURF和SIFT
3.用二值描述子匹配关键点</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/core.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/imgproc.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/highgui.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/features2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/objdetect.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/xfeatures2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace std;
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace cv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////1.局部模板匹配 ---- 两个图像的匹配
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image1 = imread(&#34;./images/church01.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image2 = imread(&#34;./images/church02.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image1&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image2&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义关键点容器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义特征检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Ptr&lt;FeatureDetector&gt; ptrDetector;  //泛型检测器指针
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////这里使用FAST检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrDetector = FastFeatureDetector::create(80);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrDetector-&gt;detect(image1, keypoints1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrDetector-&gt;detect(image2, keypoints2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of keypoints (image 1): &#34; &lt;&lt; keypoints1.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of keypoints (image 2): &#34; &lt;&lt; keypoints2.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义一个特定大小的矩形（11 * 11）， 用于表示每个关键点周围的图像块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义正方形的领域
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//const int nsize(11);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Rect neighborhood(0, 0, nsize, nsize); //11 * 11
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat patch1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat patch2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////将一副图像的关键点与另一幅图像的所有关键点进行比较，找出最相似的
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////在第二幅图像中找出与第一幅图像中的每个关键点最匹配的
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////针对图像一的全部关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i &lt; keypoints1.size(); i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//定义图像块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	neighborhood.x = keypoints1[i].pt.x - nsize / 2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	neighborhood.y = keypoints1[i].pt.y - nsize / 2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//如果领域超出图像范围，就继续处理下一个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	if (neighborhood.x &lt; 0 || neighborhood.y &lt; 0 || 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		neighborhood.x + nsize &gt;= image1.cols || neighborhood.y + nsize &gt;= image1.rows)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		continue;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//第一幅图像的块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	patch1 = image1(neighborhood);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//存放最匹配的值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	DMatch bestMatch;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//针对第二幅图像的全部关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	for (int j = 0; j &lt; keypoints2.size(); j++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//定义图像块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		neighborhood.x = keypoints2[j].pt.x - nsize / 2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		neighborhood.y = keypoints2[j].pt.y - nsize / 2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//如果领域超出图像范围，就继续处理下一个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		if (neighborhood.x &lt; 0 || neighborhood.y &lt; 0 ||
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			neighborhood.x + nsize &gt;= image2.cols || neighborhood.y + nsize &gt;= image2.rows)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			continue;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//第二幅图像的块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		patch2 = image2(neighborhood);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	    //匹配两个图像块
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		matchTemplate(patch1, patch2, result, TM_SQDIFF);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//cv::matchTemplate(patch1, patch2, result, cv::TM_SQDIFF);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		//检查是否为最佳匹配
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		if (result.at&lt;float&gt;(0, 0) &lt; bestMatch.distance)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			bestMatch.distance = result.at &lt;float&gt;(0, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			bestMatch.queryIdx = i;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			bestMatch.trainIdx = j;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//添加最佳匹配
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	matches.push_back(bestMatch);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matches: &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////提取50个最佳匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//nth_element(matches.begin(), matches.begin() + 50, matches.end());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matches.erase(matches.begin() + 50, matches.end());
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matches (after): &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画出匹配结果
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat matchImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, matchImage, Scalar(255, 255, 255), Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Matches&#34;, matchImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////模板匹配----寻找一样的部分
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义一个模板
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat target(image1, Rect(80, 105, 30, 30));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////展示模板
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Template&#34;, target);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义搜索区域-----这里用图像的上半部分
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat roi(image2, Rect(0, 0, image2.cols, image2.rows / 2));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////进行模板匹配
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matchTemplate(roi,  //搜索区域
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	target,         //模板
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	result,         //结果
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	TM_SQDIFF);     //相似度
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////找到最相似的位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//double minVal, maxVal;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Point minPt, maxPt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//minMaxLoc(result, &amp;minVal, &amp;maxVal, &amp;minPt, &amp;maxPt);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////在相似度最高的位置画矩形框
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////本例为minPt
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//rectangle(roi, Rect(minPt.x, minPt.y, target.cols, target.rows), 255);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////展示模板
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Best&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//////2.描述并匹配局部强度值模式----SURF和SIFT
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////SURF
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////读图片
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image1 = imread(&#34;./images/church01.jpg&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image2 = imread(&#34;./images/church02.jpg&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (!image1.data || !image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image1&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image2&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义关键点的检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义特征检测器----SURF
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SURF::create(2000.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////检测关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detect(image1, keypoints1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detect(image2, keypoints2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画出特征点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat featureImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawKeypoints(image1, keypoints1, featureImage, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;SURF&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;SURF&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SURF keypoints (image 1): &#34; &lt;&lt; keypoints1.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SURF keypoints (image 2): &#34; &lt;&lt; keypoints2.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////提取描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat descriptors1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat descriptors2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;compute(image1, keypoints1, descriptors1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;compute(image2, keypoints2, descriptors2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////构造匹配器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//BFMatcher matcher(NORM_L2);  //度量距离
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////匹配两幅图片的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.match(descriptors1, descriptors2, matches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画出匹配的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat imageMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;SURF Matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34;Number of matches: &#34; &lt;&lt; matches.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////对于每个关键点找出最符合的2个匹配点 ----比率检验法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;std::vector&lt;cv::DMatch&gt; &gt; matches2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.knnMatch(descriptors1, descriptors2,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	matches2,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	2); //找出k个最佳匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matches.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// 执行比率检验法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//double ratioMax = 0.6;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;std::vector&lt;cv::DMatch&gt; &gt;::iterator it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (it = matches2.begin(); it != matches2.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//  第一个最佳匹配项/第二个最佳匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	if ((*it)[0].distance / (*it)[1].distance &lt; ratioMax) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		// 这个匹配项可以接收
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		matches.push_back((*it)[0]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image1, keypoints1, // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image2, keypoints2, // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	matches,           // the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	imageMatches,      // the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::vector&lt; char &gt;(),    // masks if any 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matches (after ratio test): &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;SURF Matches (ratio test at 0.6)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;SURF Matches (ratio test at 0.6)&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////匹配差值的阈值化
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// 指定范围的匹配
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//float maxDist = 0.3;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matches2.clear();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.radiusMatch(descriptors1, descriptors2, matches2,maxDist); //两个描述子之间的最大允许差值
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//			
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image1, keypoints1, // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image2, keypoints2, // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="c1">//	//	matches2,          // the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	imageMatches,      // the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::vector&lt;std::vector&lt; char &gt;&gt;(),    // masks if any 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//int nmatches = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 0; i&lt; matches2.size(); i++)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	nmatches += matches2[i].size();
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matches (with max radius): &#34; &lt;&lt; nmatches &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;SURF Matches (with max radius)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;SURF Matches (with max radius)&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////SIFT
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image1 = cv::imread(&#34;./images/church01.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image2 = cv::imread(&#34;./images/church03.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SIFT keypoints (image 1): &#34; &lt;&lt; keypoints1.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SIFT keypoints (image 2): &#34; &lt;&lt; keypoints2.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image1_sift&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;image2_sift&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D = xfeatures2d::SIFT::create();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.match(descriptors1, descriptors2, matches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// extract the 50 best matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::nth_element(matches.begin(), matches.begin() + 50, matches.end());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matches.erase(matches.begin() + 50, matches.end());
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// draw matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image1, keypoints1, // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image2, keypoints2, // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	matches,            // the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	imageMatches,      // the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255), // color of points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::vector&lt;char&gt;(), cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the image of matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Multi-scale SIFT Matches&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Multi-scale SIFT Matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matches: &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//3.用二值描述子匹配关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//    Mat image1 = imread(&#34;./images/church01.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat image2 = imread(&#34;./images/church02.jpg&#34;, CV_LOAD_IMAGE_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//定义关键点容器和描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt; keypoints1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt; keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat descriptors1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat descriptors2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//定义特征检测器/描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Ptr&lt;Feature2D&gt; feature = ORB::create(60);   //大约60个特征点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测并描述关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//检测ORB特征
</span></span></span><span class="line"><span class="cl"><span class="c1">//	feature-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	feature-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	
</span></span></span><span class="line"><span class="cl"><span class="c1">//	Mat featureImage;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	drawKeypoints(image1, keypoints1, featureImage, Scalar(255, 255, 255), DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//展示角点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imshow(&#34;ORB&#34;, featureImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Number of ORB keypoints (image 1): &#34; &lt;&lt; keypoints1.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Number of ORB keypoints (image 2): &#34; &lt;&lt; keypoints2.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//构建匹配器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	BFMatcher matcher(NORM_HAMMING);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//匹配两幅图像的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	matcher.match(descriptors1, descriptors2, matches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat imageMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::drawMatches(
</span></span></span><span class="line"><span class="cl"><span class="c1">//		image1, keypoints1, // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//		image2, keypoints2, // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//		matches,           // the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//		imageMatches,      // the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Scalar(255, 255, 255),  // color of lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Scalar(255, 255, 255),  // color of points
</span></span></span><span class="line"><span class="cl"><span class="c1">//		std::vector&lt; char &gt;(),    // masks if any 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::DrawMatchesFlags::NOT_DRAW_SINGLE_POINTS | cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;ORB Matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34;Number of matches: &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_10--估算图像之间的投影关系">Chapter_10 : 估算图像之间的投影关系</h3>
<blockquote>
<p>1.计算图像对的基础矩阵
2.用RANSAC算法匹配图像
3.计算两幅图像之间的单应矩阵&mdash;-找到对应的点和拼接两幅图像
4.检测图像中的平面目标</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">   1
</span><span class="lnt">   2
</span><span class="lnt">   3
</span><span class="lnt">   4
</span><span class="lnt">   5
</span><span class="lnt">   6
</span><span class="lnt">   7
</span><span class="lnt">   8
</span><span class="lnt">   9
</span><span class="lnt">  10
</span><span class="lnt">  11
</span><span class="lnt">  12
</span><span class="lnt">  13
</span><span class="lnt">  14
</span><span class="lnt">  15
</span><span class="lnt">  16
</span><span class="lnt">  17
</span><span class="lnt">  18
</span><span class="lnt">  19
</span><span class="lnt">  20
</span><span class="lnt">  21
</span><span class="lnt">  22
</span><span class="lnt">  23
</span><span class="lnt">  24
</span><span class="lnt">  25
</span><span class="lnt">  26
</span><span class="lnt">  27
</span><span class="lnt">  28
</span><span class="lnt">  29
</span><span class="lnt">  30
</span><span class="lnt">  31
</span><span class="lnt">  32
</span><span class="lnt">  33
</span><span class="lnt">  34
</span><span class="lnt">  35
</span><span class="lnt">  36
</span><span class="lnt">  37
</span><span class="lnt">  38
</span><span class="lnt">  39
</span><span class="lnt">  40
</span><span class="lnt">  41
</span><span class="lnt">  42
</span><span class="lnt">  43
</span><span class="lnt">  44
</span><span class="lnt">  45
</span><span class="lnt">  46
</span><span class="lnt">  47
</span><span class="lnt">  48
</span><span class="lnt">  49
</span><span class="lnt">  50
</span><span class="lnt">  51
</span><span class="lnt">  52
</span><span class="lnt">  53
</span><span class="lnt">  54
</span><span class="lnt">  55
</span><span class="lnt">  56
</span><span class="lnt">  57
</span><span class="lnt">  58
</span><span class="lnt">  59
</span><span class="lnt">  60
</span><span class="lnt">  61
</span><span class="lnt">  62
</span><span class="lnt">  63
</span><span class="lnt">  64
</span><span class="lnt">  65
</span><span class="lnt">  66
</span><span class="lnt">  67
</span><span class="lnt">  68
</span><span class="lnt">  69
</span><span class="lnt">  70
</span><span class="lnt">  71
</span><span class="lnt">  72
</span><span class="lnt">  73
</span><span class="lnt">  74
</span><span class="lnt">  75
</span><span class="lnt">  76
</span><span class="lnt">  77
</span><span class="lnt">  78
</span><span class="lnt">  79
</span><span class="lnt">  80
</span><span class="lnt">  81
</span><span class="lnt">  82
</span><span class="lnt">  83
</span><span class="lnt">  84
</span><span class="lnt">  85
</span><span class="lnt">  86
</span><span class="lnt">  87
</span><span class="lnt">  88
</span><span class="lnt">  89
</span><span class="lnt">  90
</span><span class="lnt">  91
</span><span class="lnt">  92
</span><span class="lnt">  93
</span><span class="lnt">  94
</span><span class="lnt">  95
</span><span class="lnt">  96
</span><span class="lnt">  97
</span><span class="lnt">  98
</span><span class="lnt">  99
</span><span class="lnt"> 100
</span><span class="lnt"> 101
</span><span class="lnt"> 102
</span><span class="lnt"> 103
</span><span class="lnt"> 104
</span><span class="lnt"> 105
</span><span class="lnt"> 106
</span><span class="lnt"> 107
</span><span class="lnt"> 108
</span><span class="lnt"> 109
</span><span class="lnt"> 110
</span><span class="lnt"> 111
</span><span class="lnt"> 112
</span><span class="lnt"> 113
</span><span class="lnt"> 114
</span><span class="lnt"> 115
</span><span class="lnt"> 116
</span><span class="lnt"> 117
</span><span class="lnt"> 118
</span><span class="lnt"> 119
</span><span class="lnt"> 120
</span><span class="lnt"> 121
</span><span class="lnt"> 122
</span><span class="lnt"> 123
</span><span class="lnt"> 124
</span><span class="lnt"> 125
</span><span class="lnt"> 126
</span><span class="lnt"> 127
</span><span class="lnt"> 128
</span><span class="lnt"> 129
</span><span class="lnt"> 130
</span><span class="lnt"> 131
</span><span class="lnt"> 132
</span><span class="lnt"> 133
</span><span class="lnt"> 134
</span><span class="lnt"> 135
</span><span class="lnt"> 136
</span><span class="lnt"> 137
</span><span class="lnt"> 138
</span><span class="lnt"> 139
</span><span class="lnt"> 140
</span><span class="lnt"> 141
</span><span class="lnt"> 142
</span><span class="lnt"> 143
</span><span class="lnt"> 144
</span><span class="lnt"> 145
</span><span class="lnt"> 146
</span><span class="lnt"> 147
</span><span class="lnt"> 148
</span><span class="lnt"> 149
</span><span class="lnt"> 150
</span><span class="lnt"> 151
</span><span class="lnt"> 152
</span><span class="lnt"> 153
</span><span class="lnt"> 154
</span><span class="lnt"> 155
</span><span class="lnt"> 156
</span><span class="lnt"> 157
</span><span class="lnt"> 158
</span><span class="lnt"> 159
</span><span class="lnt"> 160
</span><span class="lnt"> 161
</span><span class="lnt"> 162
</span><span class="lnt"> 163
</span><span class="lnt"> 164
</span><span class="lnt"> 165
</span><span class="lnt"> 166
</span><span class="lnt"> 167
</span><span class="lnt"> 168
</span><span class="lnt"> 169
</span><span class="lnt"> 170
</span><span class="lnt"> 171
</span><span class="lnt"> 172
</span><span class="lnt"> 173
</span><span class="lnt"> 174
</span><span class="lnt"> 175
</span><span class="lnt"> 176
</span><span class="lnt"> 177
</span><span class="lnt"> 178
</span><span class="lnt"> 179
</span><span class="lnt"> 180
</span><span class="lnt"> 181
</span><span class="lnt"> 182
</span><span class="lnt"> 183
</span><span class="lnt"> 184
</span><span class="lnt"> 185
</span><span class="lnt"> 186
</span><span class="lnt"> 187
</span><span class="lnt"> 188
</span><span class="lnt"> 189
</span><span class="lnt"> 190
</span><span class="lnt"> 191
</span><span class="lnt"> 192
</span><span class="lnt"> 193
</span><span class="lnt"> 194
</span><span class="lnt"> 195
</span><span class="lnt"> 196
</span><span class="lnt"> 197
</span><span class="lnt"> 198
</span><span class="lnt"> 199
</span><span class="lnt"> 200
</span><span class="lnt"> 201
</span><span class="lnt"> 202
</span><span class="lnt"> 203
</span><span class="lnt"> 204
</span><span class="lnt"> 205
</span><span class="lnt"> 206
</span><span class="lnt"> 207
</span><span class="lnt"> 208
</span><span class="lnt"> 209
</span><span class="lnt"> 210
</span><span class="lnt"> 211
</span><span class="lnt"> 212
</span><span class="lnt"> 213
</span><span class="lnt"> 214
</span><span class="lnt"> 215
</span><span class="lnt"> 216
</span><span class="lnt"> 217
</span><span class="lnt"> 218
</span><span class="lnt"> 219
</span><span class="lnt"> 220
</span><span class="lnt"> 221
</span><span class="lnt"> 222
</span><span class="lnt"> 223
</span><span class="lnt"> 224
</span><span class="lnt"> 225
</span><span class="lnt"> 226
</span><span class="lnt"> 227
</span><span class="lnt"> 228
</span><span class="lnt"> 229
</span><span class="lnt"> 230
</span><span class="lnt"> 231
</span><span class="lnt"> 232
</span><span class="lnt"> 233
</span><span class="lnt"> 234
</span><span class="lnt"> 235
</span><span class="lnt"> 236
</span><span class="lnt"> 237
</span><span class="lnt"> 238
</span><span class="lnt"> 239
</span><span class="lnt"> 240
</span><span class="lnt"> 241
</span><span class="lnt"> 242
</span><span class="lnt"> 243
</span><span class="lnt"> 244
</span><span class="lnt"> 245
</span><span class="lnt"> 246
</span><span class="lnt"> 247
</span><span class="lnt"> 248
</span><span class="lnt"> 249
</span><span class="lnt"> 250
</span><span class="lnt"> 251
</span><span class="lnt"> 252
</span><span class="lnt"> 253
</span><span class="lnt"> 254
</span><span class="lnt"> 255
</span><span class="lnt"> 256
</span><span class="lnt"> 257
</span><span class="lnt"> 258
</span><span class="lnt"> 259
</span><span class="lnt"> 260
</span><span class="lnt"> 261
</span><span class="lnt"> 262
</span><span class="lnt"> 263
</span><span class="lnt"> 264
</span><span class="lnt"> 265
</span><span class="lnt"> 266
</span><span class="lnt"> 267
</span><span class="lnt"> 268
</span><span class="lnt"> 269
</span><span class="lnt"> 270
</span><span class="lnt"> 271
</span><span class="lnt"> 272
</span><span class="lnt"> 273
</span><span class="lnt"> 274
</span><span class="lnt"> 275
</span><span class="lnt"> 276
</span><span class="lnt"> 277
</span><span class="lnt"> 278
</span><span class="lnt"> 279
</span><span class="lnt"> 280
</span><span class="lnt"> 281
</span><span class="lnt"> 282
</span><span class="lnt"> 283
</span><span class="lnt"> 284
</span><span class="lnt"> 285
</span><span class="lnt"> 286
</span><span class="lnt"> 287
</span><span class="lnt"> 288
</span><span class="lnt"> 289
</span><span class="lnt"> 290
</span><span class="lnt"> 291
</span><span class="lnt"> 292
</span><span class="lnt"> 293
</span><span class="lnt"> 294
</span><span class="lnt"> 295
</span><span class="lnt"> 296
</span><span class="lnt"> 297
</span><span class="lnt"> 298
</span><span class="lnt"> 299
</span><span class="lnt"> 300
</span><span class="lnt"> 301
</span><span class="lnt"> 302
</span><span class="lnt"> 303
</span><span class="lnt"> 304
</span><span class="lnt"> 305
</span><span class="lnt"> 306
</span><span class="lnt"> 307
</span><span class="lnt"> 308
</span><span class="lnt"> 309
</span><span class="lnt"> 310
</span><span class="lnt"> 311
</span><span class="lnt"> 312
</span><span class="lnt"> 313
</span><span class="lnt"> 314
</span><span class="lnt"> 315
</span><span class="lnt"> 316
</span><span class="lnt"> 317
</span><span class="lnt"> 318
</span><span class="lnt"> 319
</span><span class="lnt"> 320
</span><span class="lnt"> 321
</span><span class="lnt"> 322
</span><span class="lnt"> 323
</span><span class="lnt"> 324
</span><span class="lnt"> 325
</span><span class="lnt"> 326
</span><span class="lnt"> 327
</span><span class="lnt"> 328
</span><span class="lnt"> 329
</span><span class="lnt"> 330
</span><span class="lnt"> 331
</span><span class="lnt"> 332
</span><span class="lnt"> 333
</span><span class="lnt"> 334
</span><span class="lnt"> 335
</span><span class="lnt"> 336
</span><span class="lnt"> 337
</span><span class="lnt"> 338
</span><span class="lnt"> 339
</span><span class="lnt"> 340
</span><span class="lnt"> 341
</span><span class="lnt"> 342
</span><span class="lnt"> 343
</span><span class="lnt"> 344
</span><span class="lnt"> 345
</span><span class="lnt"> 346
</span><span class="lnt"> 347
</span><span class="lnt"> 348
</span><span class="lnt"> 349
</span><span class="lnt"> 350
</span><span class="lnt"> 351
</span><span class="lnt"> 352
</span><span class="lnt"> 353
</span><span class="lnt"> 354
</span><span class="lnt"> 355
</span><span class="lnt"> 356
</span><span class="lnt"> 357
</span><span class="lnt"> 358
</span><span class="lnt"> 359
</span><span class="lnt"> 360
</span><span class="lnt"> 361
</span><span class="lnt"> 362
</span><span class="lnt"> 363
</span><span class="lnt"> 364
</span><span class="lnt"> 365
</span><span class="lnt"> 366
</span><span class="lnt"> 367
</span><span class="lnt"> 368
</span><span class="lnt"> 369
</span><span class="lnt"> 370
</span><span class="lnt"> 371
</span><span class="lnt"> 372
</span><span class="lnt"> 373
</span><span class="lnt"> 374
</span><span class="lnt"> 375
</span><span class="lnt"> 376
</span><span class="lnt"> 377
</span><span class="lnt"> 378
</span><span class="lnt"> 379
</span><span class="lnt"> 380
</span><span class="lnt"> 381
</span><span class="lnt"> 382
</span><span class="lnt"> 383
</span><span class="lnt"> 384
</span><span class="lnt"> 385
</span><span class="lnt"> 386
</span><span class="lnt"> 387
</span><span class="lnt"> 388
</span><span class="lnt"> 389
</span><span class="lnt"> 390
</span><span class="lnt"> 391
</span><span class="lnt"> 392
</span><span class="lnt"> 393
</span><span class="lnt"> 394
</span><span class="lnt"> 395
</span><span class="lnt"> 396
</span><span class="lnt"> 397
</span><span class="lnt"> 398
</span><span class="lnt"> 399
</span><span class="lnt"> 400
</span><span class="lnt"> 401
</span><span class="lnt"> 402
</span><span class="lnt"> 403
</span><span class="lnt"> 404
</span><span class="lnt"> 405
</span><span class="lnt"> 406
</span><span class="lnt"> 407
</span><span class="lnt"> 408
</span><span class="lnt"> 409
</span><span class="lnt"> 410
</span><span class="lnt"> 411
</span><span class="lnt"> 412
</span><span class="lnt"> 413
</span><span class="lnt"> 414
</span><span class="lnt"> 415
</span><span class="lnt"> 416
</span><span class="lnt"> 417
</span><span class="lnt"> 418
</span><span class="lnt"> 419
</span><span class="lnt"> 420
</span><span class="lnt"> 421
</span><span class="lnt"> 422
</span><span class="lnt"> 423
</span><span class="lnt"> 424
</span><span class="lnt"> 425
</span><span class="lnt"> 426
</span><span class="lnt"> 427
</span><span class="lnt"> 428
</span><span class="lnt"> 429
</span><span class="lnt"> 430
</span><span class="lnt"> 431
</span><span class="lnt"> 432
</span><span class="lnt"> 433
</span><span class="lnt"> 434
</span><span class="lnt"> 435
</span><span class="lnt"> 436
</span><span class="lnt"> 437
</span><span class="lnt"> 438
</span><span class="lnt"> 439
</span><span class="lnt"> 440
</span><span class="lnt"> 441
</span><span class="lnt"> 442
</span><span class="lnt"> 443
</span><span class="lnt"> 444
</span><span class="lnt"> 445
</span><span class="lnt"> 446
</span><span class="lnt"> 447
</span><span class="lnt"> 448
</span><span class="lnt"> 449
</span><span class="lnt"> 450
</span><span class="lnt"> 451
</span><span class="lnt"> 452
</span><span class="lnt"> 453
</span><span class="lnt"> 454
</span><span class="lnt"> 455
</span><span class="lnt"> 456
</span><span class="lnt"> 457
</span><span class="lnt"> 458
</span><span class="lnt"> 459
</span><span class="lnt"> 460
</span><span class="lnt"> 461
</span><span class="lnt"> 462
</span><span class="lnt"> 463
</span><span class="lnt"> 464
</span><span class="lnt"> 465
</span><span class="lnt"> 466
</span><span class="lnt"> 467
</span><span class="lnt"> 468
</span><span class="lnt"> 469
</span><span class="lnt"> 470
</span><span class="lnt"> 471
</span><span class="lnt"> 472
</span><span class="lnt"> 473
</span><span class="lnt"> 474
</span><span class="lnt"> 475
</span><span class="lnt"> 476
</span><span class="lnt"> 477
</span><span class="lnt"> 478
</span><span class="lnt"> 479
</span><span class="lnt"> 480
</span><span class="lnt"> 481
</span><span class="lnt"> 482
</span><span class="lnt"> 483
</span><span class="lnt"> 484
</span><span class="lnt"> 485
</span><span class="lnt"> 486
</span><span class="lnt"> 487
</span><span class="lnt"> 488
</span><span class="lnt"> 489
</span><span class="lnt"> 490
</span><span class="lnt"> 491
</span><span class="lnt"> 492
</span><span class="lnt"> 493
</span><span class="lnt"> 494
</span><span class="lnt"> 495
</span><span class="lnt"> 496
</span><span class="lnt"> 497
</span><span class="lnt"> 498
</span><span class="lnt"> 499
</span><span class="lnt"> 500
</span><span class="lnt"> 501
</span><span class="lnt"> 502
</span><span class="lnt"> 503
</span><span class="lnt"> 504
</span><span class="lnt"> 505
</span><span class="lnt"> 506
</span><span class="lnt"> 507
</span><span class="lnt"> 508
</span><span class="lnt"> 509
</span><span class="lnt"> 510
</span><span class="lnt"> 511
</span><span class="lnt"> 512
</span><span class="lnt"> 513
</span><span class="lnt"> 514
</span><span class="lnt"> 515
</span><span class="lnt"> 516
</span><span class="lnt"> 517
</span><span class="lnt"> 518
</span><span class="lnt"> 519
</span><span class="lnt"> 520
</span><span class="lnt"> 521
</span><span class="lnt"> 522
</span><span class="lnt"> 523
</span><span class="lnt"> 524
</span><span class="lnt"> 525
</span><span class="lnt"> 526
</span><span class="lnt"> 527
</span><span class="lnt"> 528
</span><span class="lnt"> 529
</span><span class="lnt"> 530
</span><span class="lnt"> 531
</span><span class="lnt"> 532
</span><span class="lnt"> 533
</span><span class="lnt"> 534
</span><span class="lnt"> 535
</span><span class="lnt"> 536
</span><span class="lnt"> 537
</span><span class="lnt"> 538
</span><span class="lnt"> 539
</span><span class="lnt"> 540
</span><span class="lnt"> 541
</span><span class="lnt"> 542
</span><span class="lnt"> 543
</span><span class="lnt"> 544
</span><span class="lnt"> 545
</span><span class="lnt"> 546
</span><span class="lnt"> 547
</span><span class="lnt"> 548
</span><span class="lnt"> 549
</span><span class="lnt"> 550
</span><span class="lnt"> 551
</span><span class="lnt"> 552
</span><span class="lnt"> 553
</span><span class="lnt"> 554
</span><span class="lnt"> 555
</span><span class="lnt"> 556
</span><span class="lnt"> 557
</span><span class="lnt"> 558
</span><span class="lnt"> 559
</span><span class="lnt"> 560
</span><span class="lnt"> 561
</span><span class="lnt"> 562
</span><span class="lnt"> 563
</span><span class="lnt"> 564
</span><span class="lnt"> 565
</span><span class="lnt"> 566
</span><span class="lnt"> 567
</span><span class="lnt"> 568
</span><span class="lnt"> 569
</span><span class="lnt"> 570
</span><span class="lnt"> 571
</span><span class="lnt"> 572
</span><span class="lnt"> 573
</span><span class="lnt"> 574
</span><span class="lnt"> 575
</span><span class="lnt"> 576
</span><span class="lnt"> 577
</span><span class="lnt"> 578
</span><span class="lnt"> 579
</span><span class="lnt"> 580
</span><span class="lnt"> 581
</span><span class="lnt"> 582
</span><span class="lnt"> 583
</span><span class="lnt"> 584
</span><span class="lnt"> 585
</span><span class="lnt"> 586
</span><span class="lnt"> 587
</span><span class="lnt"> 588
</span><span class="lnt"> 589
</span><span class="lnt"> 590
</span><span class="lnt"> 591
</span><span class="lnt"> 592
</span><span class="lnt"> 593
</span><span class="lnt"> 594
</span><span class="lnt"> 595
</span><span class="lnt"> 596
</span><span class="lnt"> 597
</span><span class="lnt"> 598
</span><span class="lnt"> 599
</span><span class="lnt"> 600
</span><span class="lnt"> 601
</span><span class="lnt"> 602
</span><span class="lnt"> 603
</span><span class="lnt"> 604
</span><span class="lnt"> 605
</span><span class="lnt"> 606
</span><span class="lnt"> 607
</span><span class="lnt"> 608
</span><span class="lnt"> 609
</span><span class="lnt"> 610
</span><span class="lnt"> 611
</span><span class="lnt"> 612
</span><span class="lnt"> 613
</span><span class="lnt"> 614
</span><span class="lnt"> 615
</span><span class="lnt"> 616
</span><span class="lnt"> 617
</span><span class="lnt"> 618
</span><span class="lnt"> 619
</span><span class="lnt"> 620
</span><span class="lnt"> 621
</span><span class="lnt"> 622
</span><span class="lnt"> 623
</span><span class="lnt"> 624
</span><span class="lnt"> 625
</span><span class="lnt"> 626
</span><span class="lnt"> 627
</span><span class="lnt"> 628
</span><span class="lnt"> 629
</span><span class="lnt"> 630
</span><span class="lnt"> 631
</span><span class="lnt"> 632
</span><span class="lnt"> 633
</span><span class="lnt"> 634
</span><span class="lnt"> 635
</span><span class="lnt"> 636
</span><span class="lnt"> 637
</span><span class="lnt"> 638
</span><span class="lnt"> 639
</span><span class="lnt"> 640
</span><span class="lnt"> 641
</span><span class="lnt"> 642
</span><span class="lnt"> 643
</span><span class="lnt"> 644
</span><span class="lnt"> 645
</span><span class="lnt"> 646
</span><span class="lnt"> 647
</span><span class="lnt"> 648
</span><span class="lnt"> 649
</span><span class="lnt"> 650
</span><span class="lnt"> 651
</span><span class="lnt"> 652
</span><span class="lnt"> 653
</span><span class="lnt"> 654
</span><span class="lnt"> 655
</span><span class="lnt"> 656
</span><span class="lnt"> 657
</span><span class="lnt"> 658
</span><span class="lnt"> 659
</span><span class="lnt"> 660
</span><span class="lnt"> 661
</span><span class="lnt"> 662
</span><span class="lnt"> 663
</span><span class="lnt"> 664
</span><span class="lnt"> 665
</span><span class="lnt"> 666
</span><span class="lnt"> 667
</span><span class="lnt"> 668
</span><span class="lnt"> 669
</span><span class="lnt"> 670
</span><span class="lnt"> 671
</span><span class="lnt"> 672
</span><span class="lnt"> 673
</span><span class="lnt"> 674
</span><span class="lnt"> 675
</span><span class="lnt"> 676
</span><span class="lnt"> 677
</span><span class="lnt"> 678
</span><span class="lnt"> 679
</span><span class="lnt"> 680
</span><span class="lnt"> 681
</span><span class="lnt"> 682
</span><span class="lnt"> 683
</span><span class="lnt"> 684
</span><span class="lnt"> 685
</span><span class="lnt"> 686
</span><span class="lnt"> 687
</span><span class="lnt"> 688
</span><span class="lnt"> 689
</span><span class="lnt"> 690
</span><span class="lnt"> 691
</span><span class="lnt"> 692
</span><span class="lnt"> 693
</span><span class="lnt"> 694
</span><span class="lnt"> 695
</span><span class="lnt"> 696
</span><span class="lnt"> 697
</span><span class="lnt"> 698
</span><span class="lnt"> 699
</span><span class="lnt"> 700
</span><span class="lnt"> 701
</span><span class="lnt"> 702
</span><span class="lnt"> 703
</span><span class="lnt"> 704
</span><span class="lnt"> 705
</span><span class="lnt"> 706
</span><span class="lnt"> 707
</span><span class="lnt"> 708
</span><span class="lnt"> 709
</span><span class="lnt"> 710
</span><span class="lnt"> 711
</span><span class="lnt"> 712
</span><span class="lnt"> 713
</span><span class="lnt"> 714
</span><span class="lnt"> 715
</span><span class="lnt"> 716
</span><span class="lnt"> 717
</span><span class="lnt"> 718
</span><span class="lnt"> 719
</span><span class="lnt"> 720
</span><span class="lnt"> 721
</span><span class="lnt"> 722
</span><span class="lnt"> 723
</span><span class="lnt"> 724
</span><span class="lnt"> 725
</span><span class="lnt"> 726
</span><span class="lnt"> 727
</span><span class="lnt"> 728
</span><span class="lnt"> 729
</span><span class="lnt"> 730
</span><span class="lnt"> 731
</span><span class="lnt"> 732
</span><span class="lnt"> 733
</span><span class="lnt"> 734
</span><span class="lnt"> 735
</span><span class="lnt"> 736
</span><span class="lnt"> 737
</span><span class="lnt"> 738
</span><span class="lnt"> 739
</span><span class="lnt"> 740
</span><span class="lnt"> 741
</span><span class="lnt"> 742
</span><span class="lnt"> 743
</span><span class="lnt"> 744
</span><span class="lnt"> 745
</span><span class="lnt"> 746
</span><span class="lnt"> 747
</span><span class="lnt"> 748
</span><span class="lnt"> 749
</span><span class="lnt"> 750
</span><span class="lnt"> 751
</span><span class="lnt"> 752
</span><span class="lnt"> 753
</span><span class="lnt"> 754
</span><span class="lnt"> 755
</span><span class="lnt"> 756
</span><span class="lnt"> 757
</span><span class="lnt"> 758
</span><span class="lnt"> 759
</span><span class="lnt"> 760
</span><span class="lnt"> 761
</span><span class="lnt"> 762
</span><span class="lnt"> 763
</span><span class="lnt"> 764
</span><span class="lnt"> 765
</span><span class="lnt"> 766
</span><span class="lnt"> 767
</span><span class="lnt"> 768
</span><span class="lnt"> 769
</span><span class="lnt"> 770
</span><span class="lnt"> 771
</span><span class="lnt"> 772
</span><span class="lnt"> 773
</span><span class="lnt"> 774
</span><span class="lnt"> 775
</span><span class="lnt"> 776
</span><span class="lnt"> 777
</span><span class="lnt"> 778
</span><span class="lnt"> 779
</span><span class="lnt"> 780
</span><span class="lnt"> 781
</span><span class="lnt"> 782
</span><span class="lnt"> 783
</span><span class="lnt"> 784
</span><span class="lnt"> 785
</span><span class="lnt"> 786
</span><span class="lnt"> 787
</span><span class="lnt"> 788
</span><span class="lnt"> 789
</span><span class="lnt"> 790
</span><span class="lnt"> 791
</span><span class="lnt"> 792
</span><span class="lnt"> 793
</span><span class="lnt"> 794
</span><span class="lnt"> 795
</span><span class="lnt"> 796
</span><span class="lnt"> 797
</span><span class="lnt"> 798
</span><span class="lnt"> 799
</span><span class="lnt"> 800
</span><span class="lnt"> 801
</span><span class="lnt"> 802
</span><span class="lnt"> 803
</span><span class="lnt"> 804
</span><span class="lnt"> 805
</span><span class="lnt"> 806
</span><span class="lnt"> 807
</span><span class="lnt"> 808
</span><span class="lnt"> 809
</span><span class="lnt"> 810
</span><span class="lnt"> 811
</span><span class="lnt"> 812
</span><span class="lnt"> 813
</span><span class="lnt"> 814
</span><span class="lnt"> 815
</span><span class="lnt"> 816
</span><span class="lnt"> 817
</span><span class="lnt"> 818
</span><span class="lnt"> 819
</span><span class="lnt"> 820
</span><span class="lnt"> 821
</span><span class="lnt"> 822
</span><span class="lnt"> 823
</span><span class="lnt"> 824
</span><span class="lnt"> 825
</span><span class="lnt"> 826
</span><span class="lnt"> 827
</span><span class="lnt"> 828
</span><span class="lnt"> 829
</span><span class="lnt"> 830
</span><span class="lnt"> 831
</span><span class="lnt"> 832
</span><span class="lnt"> 833
</span><span class="lnt"> 834
</span><span class="lnt"> 835
</span><span class="lnt"> 836
</span><span class="lnt"> 837
</span><span class="lnt"> 838
</span><span class="lnt"> 839
</span><span class="lnt"> 840
</span><span class="lnt"> 841
</span><span class="lnt"> 842
</span><span class="lnt"> 843
</span><span class="lnt"> 844
</span><span class="lnt"> 845
</span><span class="lnt"> 846
</span><span class="lnt"> 847
</span><span class="lnt"> 848
</span><span class="lnt"> 849
</span><span class="lnt"> 850
</span><span class="lnt"> 851
</span><span class="lnt"> 852
</span><span class="lnt"> 853
</span><span class="lnt"> 854
</span><span class="lnt"> 855
</span><span class="lnt"> 856
</span><span class="lnt"> 857
</span><span class="lnt"> 858
</span><span class="lnt"> 859
</span><span class="lnt"> 860
</span><span class="lnt"> 861
</span><span class="lnt"> 862
</span><span class="lnt"> 863
</span><span class="lnt"> 864
</span><span class="lnt"> 865
</span><span class="lnt"> 866
</span><span class="lnt"> 867
</span><span class="lnt"> 868
</span><span class="lnt"> 869
</span><span class="lnt"> 870
</span><span class="lnt"> 871
</span><span class="lnt"> 872
</span><span class="lnt"> 873
</span><span class="lnt"> 874
</span><span class="lnt"> 875
</span><span class="lnt"> 876
</span><span class="lnt"> 877
</span><span class="lnt"> 878
</span><span class="lnt"> 879
</span><span class="lnt"> 880
</span><span class="lnt"> 881
</span><span class="lnt"> 882
</span><span class="lnt"> 883
</span><span class="lnt"> 884
</span><span class="lnt"> 885
</span><span class="lnt"> 886
</span><span class="lnt"> 887
</span><span class="lnt"> 888
</span><span class="lnt"> 889
</span><span class="lnt"> 890
</span><span class="lnt"> 891
</span><span class="lnt"> 892
</span><span class="lnt"> 893
</span><span class="lnt"> 894
</span><span class="lnt"> 895
</span><span class="lnt"> 896
</span><span class="lnt"> 897
</span><span class="lnt"> 898
</span><span class="lnt"> 899
</span><span class="lnt"> 900
</span><span class="lnt"> 901
</span><span class="lnt"> 902
</span><span class="lnt"> 903
</span><span class="lnt"> 904
</span><span class="lnt"> 905
</span><span class="lnt"> 906
</span><span class="lnt"> 907
</span><span class="lnt"> 908
</span><span class="lnt"> 909
</span><span class="lnt"> 910
</span><span class="lnt"> 911
</span><span class="lnt"> 912
</span><span class="lnt"> 913
</span><span class="lnt"> 914
</span><span class="lnt"> 915
</span><span class="lnt"> 916
</span><span class="lnt"> 917
</span><span class="lnt"> 918
</span><span class="lnt"> 919
</span><span class="lnt"> 920
</span><span class="lnt"> 921
</span><span class="lnt"> 922
</span><span class="lnt"> 923
</span><span class="lnt"> 924
</span><span class="lnt"> 925
</span><span class="lnt"> 926
</span><span class="lnt"> 927
</span><span class="lnt"> 928
</span><span class="lnt"> 929
</span><span class="lnt"> 930
</span><span class="lnt"> 931
</span><span class="lnt"> 932
</span><span class="lnt"> 933
</span><span class="lnt"> 934
</span><span class="lnt"> 935
</span><span class="lnt"> 936
</span><span class="lnt"> 937
</span><span class="lnt"> 938
</span><span class="lnt"> 939
</span><span class="lnt"> 940
</span><span class="lnt"> 941
</span><span class="lnt"> 942
</span><span class="lnt"> 943
</span><span class="lnt"> 944
</span><span class="lnt"> 945
</span><span class="lnt"> 946
</span><span class="lnt"> 947
</span><span class="lnt"> 948
</span><span class="lnt"> 949
</span><span class="lnt"> 950
</span><span class="lnt"> 951
</span><span class="lnt"> 952
</span><span class="lnt"> 953
</span><span class="lnt"> 954
</span><span class="lnt"> 955
</span><span class="lnt"> 956
</span><span class="lnt"> 957
</span><span class="lnt"> 958
</span><span class="lnt"> 959
</span><span class="lnt"> 960
</span><span class="lnt"> 961
</span><span class="lnt"> 962
</span><span class="lnt"> 963
</span><span class="lnt"> 964
</span><span class="lnt"> 965
</span><span class="lnt"> 966
</span><span class="lnt"> 967
</span><span class="lnt"> 968
</span><span class="lnt"> 969
</span><span class="lnt"> 970
</span><span class="lnt"> 971
</span><span class="lnt"> 972
</span><span class="lnt"> 973
</span><span class="lnt"> 974
</span><span class="lnt"> 975
</span><span class="lnt"> 976
</span><span class="lnt"> 977
</span><span class="lnt"> 978
</span><span class="lnt"> 979
</span><span class="lnt"> 980
</span><span class="lnt"> 981
</span><span class="lnt"> 982
</span><span class="lnt"> 983
</span><span class="lnt"> 984
</span><span class="lnt"> 985
</span><span class="lnt"> 986
</span><span class="lnt"> 987
</span><span class="lnt"> 988
</span><span class="lnt"> 989
</span><span class="lnt"> 990
</span><span class="lnt"> 991
</span><span class="lnt"> 992
</span><span class="lnt"> 993
</span><span class="lnt"> 994
</span><span class="lnt"> 995
</span><span class="lnt"> 996
</span><span class="lnt"> 997
</span><span class="lnt"> 998
</span><span class="lnt"> 999
</span><span class="lnt">1000
</span><span class="lnt">1001
</span><span class="lnt">1002
</span><span class="lnt">1003
</span><span class="lnt">1004
</span><span class="lnt">1005
</span><span class="lnt">1006
</span><span class="lnt">1007
</span><span class="lnt">1008
</span><span class="lnt">1009
</span><span class="lnt">1010
</span><span class="lnt">1011
</span><span class="lnt">1012
</span><span class="lnt">1013
</span><span class="lnt">1014
</span><span class="lnt">1015
</span><span class="lnt">1016
</span><span class="lnt">1017
</span><span class="lnt">1018
</span><span class="lnt">1019
</span><span class="lnt">1020
</span><span class="lnt">1021
</span><span class="lnt">1022
</span><span class="lnt">1023
</span><span class="lnt">1024
</span><span class="lnt">1025
</span><span class="lnt">1026
</span><span class="lnt">1027
</span><span class="lnt">1028
</span><span class="lnt">1029
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;vector&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/core.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/imgproc.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/highgui.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/features2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/calib3d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/objdetect.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/xfeatures2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/stitching.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;RobustMatcher.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;TargetMatcher.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace std;
</span></span></span><span class="line"><span class="cl"><span class="c1">//using namespace cv;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////1.计算图像对的基础矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image1 = imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat image2 = imread(&#34;./images/church03.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (!image1.data || !image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the images
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Right Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Right Image&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Left Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Left Image&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////定义关键点容器和描述子、
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat descriptors1, descriptors2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////构建SIFT特征检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SIFT::create(74);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray(), keypoints1, descriptors1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SIFT points (1): &#34; &lt;&lt; keypoints1.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of SIFT points (2): &#34; &lt;&lt; keypoints2.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画关键点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat imageKP;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawKeypoints(image1, keypoints1, imageKP, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Right SIFT Features&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Right SIFT Features&#34;, imageKP);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawKeypoints(image2, keypoints2, imageKP, cv::Scalar(255, 255, 255), cv::DrawMatchesFlags::DRAW_RICH_KEYPOINTS);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Left SIFT Features&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Left SIFT Features&#34;, imageKP);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////构建匹配类的实例
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//BFMatcher matcher(NORM_L2, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////匹配描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.match(descriptors1, descriptors2, matches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;Number of matched points: &#34; &lt;&lt; matches.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////手动的选择一些匹配的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; selMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// make sure to double-check if the selected matches are valid
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[2]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[5]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[16]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[19]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[14]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[34]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//selMatches.push_back(matches[29]);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////画出选择的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat imageMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image2, keypoints2,  // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	selMatches,			// the selected matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	imageMatches,		// the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::vector&lt;char&gt;(),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	2
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//); // color of the lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Matches&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////将一维关键点转变为二维的点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;int&gt; pointIndexes1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;int&gt; pointIndexes2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (vector&lt;DMatch&gt;::const_iterator it = selMatches.begin(); it != selMatches.end(); ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	pointIndexes1.push_back(it-&gt;queryIdx);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	pointIndexes2.push_back(it-&gt;trainIdx);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////为了在findFundamentalMat中使用，需要先把这些关键点转化为Point2f类型
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Point2f&gt; selPoints1, selPoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//KeyPoint::convert(keypoints1, selPoints1, pointIndexes1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//KeyPoint::convert(keypoints2, selPoints2, pointIndexes2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////通过画点来检查
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Point2f&gt; ::const_iterator it = selPoints1.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//while (it != selPoints1.end())
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//在每个角点位置画圆
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	circle(image1, *it, 3, Scalar(255, 255, 255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	++it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//it = selPoints2.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//while (it != selPoints2.end()) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// draw a circle at each corner location
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::circle(image2, *it, 3, cv::Scalar(255, 255, 255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	++it;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////用7对匹配项计算基础矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat fundamental = findFundamentalMat(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//    selPoints1, //第一幅图像的7个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//    selPoints2, //第二幅图像的7个点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	FM_7POINT); //7个点的方法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34;F-Matrix size= &#34; &lt;&lt; fundamental.rows &lt;&lt; &#34;,&#34; &lt;&lt; fundamental.cols &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat fund(fundamental, cv::Rect(0, 0, 3, 3));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////在右侧图像上画出对极线的左侧点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Vec3f&gt; lines1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//computeCorrespondEpilines(selPoints1, //图像点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	1,                 //在第一副图像中（也可在第二幅图像中）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	fund,       //基础矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	lines1);           //对极线的向量
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34;size of F matrix:&#34; &lt;&lt; fund.rows &lt;&lt; &#34;x&#34; &lt;&lt; fund.cols &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////遍历全部对极线
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines1.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	it != lines1.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// 画出第一列和最后一列之间的线条
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::line(image2, cv::Point(0, -(*it)[2] / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Point(image2.cols, -((*it)[2] + (*it)[0] * image2.cols) / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// draw the left points corresponding epipolar lines in left image 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec3f&gt; lines2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::computeCorrespondEpilines(cv::Mat(selPoints2), 2, fund, lines2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines2.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	it != lines2.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// draw the epipolar line between first and last column
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::line(image1, cv::Point(0, -(*it)[2] / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Point(image1.cols, -((*it)[2] + (*it)[0] * image1.cols) / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// combine both images
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat both(image1.rows, image1.cols + image2.cols, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image1.copyTo(both.colRange(0, image1.cols));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image2.copyTo(both.colRange(image1.cols, image1.cols + image2.cols));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the images with points and epipolar lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Epilines&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Epilines&#34;, both);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	///*
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Convert keypoints into Point2f
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Point2f&gt; points1, points2, newPoints1, newPoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::KeyPoint::convert(keypoints1, points1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::KeyPoint::convert(keypoints2, points2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::correctMatches(fund, points1, points2, newPoints1, newPoints2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::KeyPoint::convert(newPoints1, keypoints1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::KeyPoint::convert(newPoints2, keypoints2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image2, keypoints2,  // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matches,			// the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imageMatches,		// the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Scalar(255, 255, 255),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Scalar(255, 255, 255),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;char&gt;(),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//2
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//); // color of the lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Corrected matches&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Corrected matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//*/
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//2.用RANSAC算法匹配图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//    
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read input images
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::Mat image1 = cv::imread(&#34;./images/church01.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::Mat image2 = cv::imread(&#34;./images/church03.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   if (!image1.data || !image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">// //        return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   // Display the images
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::namedWindow(&#34;Right Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::imshow(&#34;Right Image&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::namedWindow(&#34;Left Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Left Image&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////准备匹配器（用默认参数）
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////SIFT检测器和描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//RobustMatcher rmatcher(xfeatures2d::SIFT::create(250));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////匹配两幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints1, keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat fundamental = rmatcher.match(image1, image2, matches, keypoints1, keypoints2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat imageMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Matches&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Convert keypoints into Point2f	
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Point2f&gt; points1, points2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (std::vector&lt;cv::DMatch&gt;::const_iterator it = matches.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	it != matches.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// Get the position of left keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	float x = keypoints1[it-&gt;queryIdx].pt.x;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="c1">//	//	float y = keypoints1[it-&gt;queryIdx].pt.y;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	points1.push_back(keypoints1[it-&gt;queryIdx].pt);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::circle(image1, cv::Point(x, y), 3, cv::Scalar(255, 255, 255), 3);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// Get the position of right keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	x = keypoints2[it-&gt;trainIdx].pt.x;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	y = keypoints2[it-&gt;trainIdx].pt.y;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::circle(image2, cv::Point(x, y), 3, cv::Scalar(255, 255, 255), 3);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	points2.push_back(keypoints2[it-&gt;trainIdx].pt);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Draw the epipolar lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec3f&gt; lines1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::computeCorrespondEpilines(points1, 1, fundamental, lines1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines1.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	it != lines1.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::line(image2, cv::Point(0, -(*it)[2] / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Point(image2.cols, -((*it)[2] + (*it)[0] * image2.cols) / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;cv::Vec3f&gt; lines2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::computeCorrespondEpilines(points2, 2, fundamental, lines2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (std::vector&lt;cv::Vec3f&gt;::const_iterator it = lines2.begin();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	it != lines2.end(); ++it) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::line(image1, cv::Point(0, -(*it)[2] / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Point(image1.cols, -((*it)[2] + (*it)[0] * image1.cols) / (*it)[1]),
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//		cv::Scalar(255, 255, 255));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Display the images with epipolar lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Right Image Epilines (RANSAC)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Right Image Epilines (RANSAC)&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Left Image Epilines (RANSAC)&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Left Image Epilines (RANSAC)&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////3.计算两幅图像之间的单应矩阵----找到对应的点和拼接两幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Read input images
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::Mat image1 = cv::imread(&#34;./images/parliament1.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::Mat image2 = cv::imread(&#34;./images/parliament2.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   if (!image1.data || !image2.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">// //         return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   // Display the images
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::namedWindow(&#34;Image 1&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::imshow(&#34;Image 1&#34;, image1);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::namedWindow(&#34;Image 2&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   cv::imshow(&#34;Image 2&#34;, image2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////构建关键点容器和描述子
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints1;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;KeyPoint&gt; keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat descriptors1, descriptors2;
</span></span></span><span class="line"><span class="cl"><span class="c1">// //   //构建SIFT特征检测器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Ptr&lt;Feature2D&gt; ptrFeature2D = xfeatures2d::SIFT::create(74);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image1, noArray() ,keypoints1, descriptors1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//ptrFeature2D-&gt;detectAndCompute(image2, noArray(), keypoints2, descriptors2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34; Number of feature points (1):&#34; &lt;&lt; keypoints1.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; &#34; Number of feature points (2):&#34; &lt;&lt; keypoints2.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//BFMatcher matcher(NORM_L2, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//matcher.match(descriptors1, descriptors2, matches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat imageMatches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//drawMatches(image1, keypoints1, image2, keypoints2, matches, imageMatches, 
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	Scalar(255, 255, 255), Scalar(255, 255, 255), vector&lt;char&gt;(), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Matches (pure rotation case)&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////接下来使用findHomography函数实现，和findFundamentalMat函数相似
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////我们要将关键点转变为Point2f
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Point2f&gt; points1, points2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (vector&lt;DMatch&gt;::const_iterator it = matches.begin(); it != matches.end(); ++it)
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//获得左边关键点的位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	float x = keypoints1[it-&gt;queryIdx].pt.x;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	float y = keypoints1[it-&gt;queryIdx].pt.y;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	points1.push_back(Point2f(x, y));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	//获得右边关键点的位置
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//    x = keypoints2[it-&gt;trainIdx].pt.x;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	y = keypoints2[it-&gt;trainIdx].pt.y;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	points2.push_back(Point2f(x, y));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cout &lt;&lt; points1.size() &lt;&lt; &#34; &#34; &lt;&lt; points2.size() &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////找到第一幅图像和第二幅图像之间的单应矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;char&gt; inliers;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat homography = findHomography(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//    points1, points2,   //对应的点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	inliers,            //输出的局部匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	RANSAC,             //RANSAC方法
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	1.);                //到重复投影点最大的距离
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//						// Draw the inlier points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::drawMatches(image1, keypoints1,  // 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image2, keypoints2,  // 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	matches,			// the matches
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	imageMatches,		// the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of the lines
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::Scalar(255, 255, 255),  // color of the keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	inliers,
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Homography inlier points&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Homography inlier points&#34;, imageMatches);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////将第一幅图像扭曲到第二幅图像----实现两幅图像的拼接
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat result;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//warpPerspective(image1,     //输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	result,                 //输出图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	homography,             //单应矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	Size(2 * image1.cols, image1.rows)); //输出图像的尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////把第一幅图像复制到完整图像的第一个半边
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat harf(result, Rect(0, 0, image2.cols, image2.rows));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image2.copyTo(harf);  //把image2复制到image1的感兴趣区域
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//imshow(&#34;Image mosaic&#34;, result);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////图像拼接技术----用Stitcher生成全景图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////Mat img1 = imread(&#34;./images/parliament1.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////Mat img2 = imread(&#34;./images/parliament2.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////imshow(&#34;img1&#34;, img1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////imshow(&#34;img2&#34;, img2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////vector&lt;Mat&gt; images;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////images.push_back(img1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////images.push_back(img2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//vector&lt;Mat&gt; images;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//images.push_back(imread(&#34;./images/parliament1_1.jpg&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//images.push_back(imread(&#34;./images/parliament2_1.jpg&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Mat panorama;  //输出的全景图
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////创建拼接器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Stitcher stitcher = Stitcher::createDefault();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////拼接图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//Stitcher::Status status = stitcher.stitch(images, panorama);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//if (status == cv::Stitcher::OK) // success?
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//
</span></span></span><span class="line"><span class="cl"><span class="c1">// //    	cv::namedWindow(&#34;Panorama&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	cv::imshow(&#34;Panorama&#34;, panorama);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//4.检测图像中的平面目标
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read input images
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::Mat target = cv::imread(&#34;./images/cookbook1.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::Mat image = cv::imread(&#34;./images/objects.jpg&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    if (!target.data || !image.data)
</span></span></span><span class="line"><span class="cl"><span class="c1">//      return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//    // Display the images
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::namedWindow(&#34;Target&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::imshow(&#34;Target&#34;, target);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::namedWindow(&#34;Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    cv::imshow(&#34;Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//    
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//初始化匹配器
</span></span></span><span class="line"><span class="cl"><span class="c1">//	TargetMatcher tmatcher(FastFeatureDetector::create(10), BRISK::create());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	tmatcher.setNormType(NORM_HAMMING);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//定义输出数据
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;DMatch&gt; matches;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;KeyPoint&gt; keypoints1, keypoints2;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	vector&lt;Point2f&gt; corners;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//设定目标图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	tmatcher.setTarget(target);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//匹配目标图像
</span></span></span><span class="line"><span class="cl"><span class="c1">//	tmatcher.detectTarget(image, corners);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//画出目标角点
</span></span></span><span class="line"><span class="cl"><span class="c1">//	if (corners.size() == 4) { //已获得检测结果
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::line(image, cv::Point(corners[0]), cv::Point(corners[1]), cv::Scalar(255, 255, 255), 6);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::line(image, cv::Point(corners[1]), cv::Point(corners[2]), cv::Scalar(255, 255, 255), 6);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::line(image, cv::Point(corners[2]), cv::Point(corners[3]), cv::Scalar(255, 255, 255), 6);
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::line(image, cv::Point(corners[3]), cv::Point(corners[0]), cv::Scalar(255, 255, 255), 6);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::namedWindow(&#34;Target detection&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;Target detection&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined MATCHER
</span></span></span><span class="line"><span class="cl"><span class="cp">#define MATCHER
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/features2d.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/xfeatures2d.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#define NOCHECK      0
</span></span></span><span class="line"><span class="cl"><span class="cp">#define CROSSCHECK   1
</span></span></span><span class="line"><span class="cl"><span class="cp">#define RATIOCHECK   2
</span></span></span><span class="line"><span class="cl"><span class="cp">#define BOTHCHECK    3
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">RobustMatcher</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//特征点检测器对象的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FeatureDetector</span><span class="o">&gt;</span> <span class="n">detector</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//特征描述子提取器对象的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span> <span class="n">descriptor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">int</span> <span class="n">normType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">ratio</span><span class="p">;</span>   <span class="c1">//第一个和第二个NN之间的最大比率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">refineF</span><span class="p">;</span>  <span class="c1">//如果等于true，则会优化基础矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">refineM</span><span class="p">;</span>  <span class="c1">//如果等于true，则会优化匹配结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">distance</span><span class="p">;</span>    <span class="c1">//到极点的最小距离
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">confidence</span><span class="p">;</span>  <span class="c1">//可信度（概率）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">RobustMatcher</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">FeatureDetector</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">detector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">descriptor</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="o">:</span> <span class="n">detector</span><span class="p">(</span><span class="n">detector</span><span class="p">),</span> <span class="n">descriptor</span><span class="p">(</span><span class="n">descriptor</span><span class="p">),</span> <span class="n">normType</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">NORM_L2</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="n">ratio</span><span class="p">(</span><span class="mf">0.8f</span><span class="p">),</span> <span class="n">refineF</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span> <span class="n">refineM</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span> <span class="n">confidence</span><span class="p">(</span><span class="mf">0.98</span><span class="p">),</span> <span class="n">distance</span><span class="p">(</span><span class="mf">1.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//这里使用关联描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">this</span><span class="o">-&gt;</span><span class="n">descriptor</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">detector</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the feature detector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setFeatureDetector</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">FeatureDetector</span><span class="o">&gt;&amp;</span> <span class="n">detect</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">-&gt;</span><span class="n">detector</span> <span class="o">=</span> <span class="n">detect</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set descriptor extractor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setDescriptorExtractor</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DescriptorExtractor</span><span class="o">&gt;&amp;</span> <span class="n">desc</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">this</span><span class="o">-&gt;</span><span class="n">descriptor</span> <span class="o">=</span> <span class="n">desc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the norm to be used for matching
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setNormType</span><span class="p">(</span><span class="kt">int</span> <span class="n">norm</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">normType</span> <span class="o">=</span> <span class="n">norm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the minimum distance to epipolar in RANSAC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setMinDistanceToEpipolar</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">distance</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set confidence level in RANSAC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setConfidenceLevel</span><span class="p">(</span><span class="kt">double</span> <span class="n">c</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">confidence</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the NN ratio
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setRatio</span><span class="p">(</span><span class="kt">float</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">ratio</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// if you want the F matrix to be recalculated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">refineFundamental</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">refineF</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// if you want the matches to be refined using F
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">refineMatches</span><span class="p">(</span><span class="kt">bool</span> <span class="n">flag</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">refineM</span> <span class="o">=</span> <span class="n">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Clear matches for which NN ratio is &gt; than threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// return the number of removed points 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// (corresponding entries being cleared, i.e. size will be 0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">ratioTest</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">inputMatches</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">outputMatches</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">removed</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// for all matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">matchIterator</span> <span class="o">=</span> <span class="n">inputMatches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">matchIterator</span> <span class="o">!=</span> <span class="n">inputMatches</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">matchIterator</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">//   first best match/second best match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">((</span><span class="n">matchIterator</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;&amp;</span> <span class="c1">// if 2 NN has been identified 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="p">(</span><span class="o">*</span><span class="n">matchIterator</span><span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="n">distance</span> <span class="o">/</span> <span class="p">(</span><span class="o">*</span><span class="n">matchIterator</span><span class="p">)[</span><span class="mi">1</span><span class="p">].</span><span class="n">distance</span> <span class="o">&lt;</span> <span class="n">ratio</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// it is an acceptable match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">outputMatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">((</span><span class="o">*</span><span class="n">matchIterator</span><span class="p">)[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="n">removed</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">removed</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Insert symmetrical matches in symMatches vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">symmetryTest</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">matches1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">matches2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">symMatches</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// for all matches image 1 -&gt; image 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">matchIterator1</span> <span class="o">=</span> <span class="n">matches1</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">matchIterator1</span> <span class="o">!=</span> <span class="n">matches1</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">matchIterator1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// for all matches image 2 -&gt; image 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">matchIterator2</span> <span class="o">=</span> <span class="n">matches2</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">matchIterator2</span> <span class="o">!=</span> <span class="n">matches2</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">matchIterator2</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Match symmetry test
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="p">(</span><span class="n">matchIterator1</span><span class="o">-&gt;</span><span class="n">queryIdx</span> <span class="o">==</span> <span class="n">matchIterator2</span><span class="o">-&gt;</span><span class="n">trainIdx</span>  <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">					<span class="n">matchIterator2</span><span class="o">-&gt;</span><span class="n">queryIdx</span> <span class="o">==</span> <span class="n">matchIterator1</span><span class="o">-&gt;</span><span class="n">trainIdx</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="c1">// add symmetrical match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">symMatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">matchIterator1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">					<span class="k">break</span><span class="p">;</span> <span class="c1">// next match in image 1 -&gt; image 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Apply both ratio and symmetry test
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// (often an over-kill)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">ratioAndSymmetryTest</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">matches1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;&amp;</span> <span class="n">matches2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">outputMatches</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Remove matches for which NN ratio is &gt; than threshold
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// clean image 1 -&gt; image 2 matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">ratioMatches1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">removed</span> <span class="o">=</span> <span class="n">ratioTest</span><span class="p">(</span><span class="n">matches1</span><span class="p">,</span> <span class="n">ratioMatches1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2 (ratio test) : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">ratioMatches1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// clean image 2 -&gt; image 1 matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">ratioMatches2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">removed</span> <span class="o">=</span> <span class="n">ratioTest</span><span class="p">(</span><span class="n">matches2</span><span class="p">,</span> <span class="n">ratioMatches2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2 (ratio test) : &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">ratioMatches2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Remove non-symmetrical matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">symmetryTest</span><span class="p">(</span><span class="n">ratioMatches1</span><span class="p">,</span> <span class="n">ratioMatches2</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points (symmetry test): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">outputMatches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 用RANSAC算法获取优质匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 返回基础矩阵和匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">ransacTest</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">matches</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">outMatches</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//把关键点转变为Point2f类型	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">matches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">it</span> <span class="o">!=</span> <span class="n">matches</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">//获取左侧关键点的位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints1</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//获取右侧关键点的位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints2</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 用 RANSAC 计算F矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="n">inliers</span><span class="p">(</span><span class="n">points1</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">findFundamentalMat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span> <span class="c1">//匹配像素点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">inliers</span><span class="p">,</span>         <span class="c1">//匹配状态(inlier or outlier)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">FM_RANSAC</span><span class="p">,</span>   <span class="c1">// RANSAC 算法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">distance</span><span class="p">,</span>        <span class="c1">// 到对极线的距离
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">confidence</span><span class="p">);</span>     <span class="c1">// 置信度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		 <span class="c1">//取下剩下的 (inliers) 匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itIn</span> <span class="o">=</span> <span class="n">inliers</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itM</span> <span class="o">=</span> <span class="n">matches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 遍历所有的匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(;</span> <span class="n">itIn</span> <span class="o">!=</span> <span class="n">inliers</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">itIn</span><span class="p">,</span> <span class="o">++</span><span class="n">itM</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">itIn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// it is a valid match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				<span class="n">outMatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">itM</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">refineF</span> <span class="o">||</span> <span class="n">refineM</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// The F matrix will be recomputed with all accepted matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Convert keypoints into Point2f for final F computation	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points1</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">points2</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">outMatches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">it</span> <span class="o">!=</span> <span class="n">outMatches</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// Get the position of left keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">points1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints1</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// Get the position of right keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">points2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints2</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Compute 8-point F from all accepted matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">fundamental</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">findFundamentalMat</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">				<span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span> <span class="c1">// matching points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">cv</span><span class="o">::</span><span class="n">FM_8POINT</span><span class="p">);</span> <span class="c1">// 8-point method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">refineM</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">newPoints1</span><span class="p">,</span> <span class="n">newPoints2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// refine the matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">correctMatches</span><span class="p">(</span><span class="n">fundamental</span><span class="p">,</span>             <span class="c1">// F matrix
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span>        <span class="c1">// original position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">newPoints1</span><span class="p">,</span> <span class="n">newPoints2</span><span class="p">);</span> <span class="c1">// new position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span> <span class="n">points1</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints1</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints1</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">y</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;) -&gt; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">newPoints1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">newPoints1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints2</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints2</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">y</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;) -&gt; &#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;(&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">newPoints2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span>
</span></span><span class="line"><span class="cl">						<span class="o">&lt;&lt;</span> <span class="s">&#34;,&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">newPoints2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">					<span class="n">keypoints1</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">newPoints1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">keypoints1</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">newPoints1</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">keypoints2</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">newPoints2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">					<span class="n">keypoints2</span><span class="p">[</span><span class="n">outMatches</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">newPoints2</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">fundamental</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用RANSAC算法匹配特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//返回基础矩阵和输出的匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//这是一个简单的展示，和书上的一样，下面有个比较复杂的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">matchBook</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image1</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image2</span><span class="p">,</span>  <span class="c1">//输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">matches</span><span class="p">,</span>         <span class="c1">//输出匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">keypoints1</span><span class="p">,</span>    <span class="c1">//输出关键点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">keypoints2</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//1.检测特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//2.提取特征描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">,</span> <span class="n">descriptors1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//3.匹配两幅图像描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//（用于部分检测方法）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//构造匹配类的实例（带交叉检查）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">BFMatcher</span> <span class="n">matcher</span><span class="p">(</span><span class="n">normType</span><span class="p">,</span>  <span class="c1">//差距衡量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="nb">true</span><span class="p">);</span>                   <span class="c1">//交叉检查标志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//匹配描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">vector</span><span class="o">&lt;</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">outputMatches</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">matcher</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//4.用RANSAC算法验证匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">Mat</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">ransacTest</span><span class="p">(</span><span class="n">outputMatches</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">,</span> <span class="n">matches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//返回基础矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">fundamental</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用RANSAC算法匹配特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//返回基础矩阵和输出的匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">match</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image1</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image2</span><span class="p">,</span> <span class="c1">// 输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">matches</span><span class="p">,</span> <span class="c1">// 输出匹配项和关键点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints1</span><span class="p">,</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">check</span> <span class="o">=</span> <span class="n">CROSSCHECK</span><span class="p">)</span> <span class="p">{</span>  <span class="c1">// check type (symmetry or ratio or none or both)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">//检测特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of feature points (1): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of feature points (2): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 提取特征描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">,</span> <span class="n">descriptors1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;descriptor matrix size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">descriptors1</span><span class="p">.</span><span class="n">rows</span> <span class="o">&lt;&lt;</span> <span class="s">&#34; by &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">descriptors1</span><span class="p">.</span><span class="n">cols</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 3. Match the two image descriptors
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//    (optionaly apply some checking method)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="c1">// Construction of the matcher with crosscheck 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">BFMatcher</span> <span class="n">matcher</span><span class="p">(</span><span class="n">normType</span><span class="p">,</span>            <span class="c1">//distance measure
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">check</span> <span class="o">==</span> <span class="n">CROSSCHECK</span><span class="p">);</span>  <span class="c1">// crosscheck flag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">								   <span class="c1">// vectors of matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matches1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">matches2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">outputMatches</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// call knnMatch if ratio check is required
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">==</span> <span class="n">RATIOCHECK</span> <span class="o">||</span> <span class="n">check</span> <span class="o">==</span> <span class="n">BOTHCHECK</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// from image 1 to image 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">// based on k nearest neighbours (with k=2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">matcher</span><span class="p">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">matches1</span><span class="p">,</span> <span class="c1">// vector of matches (up to 2 per entry) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="mi">2</span><span class="p">);</span>		  <span class="c1">// return 2 nearest neighbours
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">matches1</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">check</span> <span class="o">==</span> <span class="n">BOTHCHECK</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// from image 2 to image 1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="c1">// based on k nearest neighbours (with k=2)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">matcher</span><span class="p">.</span><span class="n">knnMatch</span><span class="p">(</span><span class="n">descriptors2</span><span class="p">,</span> <span class="n">descriptors1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="n">matches2</span><span class="p">,</span> <span class="c1">// vector of matches (up to 2 per entry) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="mi">2</span><span class="p">);</span>		  <span class="c1">// return 2 nearest neighbours
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 2-&gt;1: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">matches2</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// select check method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">switch</span> <span class="p">(</span><span class="n">check</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="nl">CROSSCHECK</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">matcher</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2 (after cross-check): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">outputMatches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="nl">RATIOCHECK</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">ratioTest</span><span class="p">(</span><span class="n">matches1</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2 (after ratio test): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">outputMatches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="nl">BOTHCHECK</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">ratioAndSymmetryTest</span><span class="p">(</span><span class="n">matches1</span><span class="p">,</span> <span class="n">matches2</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2 (after ratio and cross-check): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">outputMatches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">case</span> <span class="nl">NOCHECK</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">		<span class="k">default</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">			<span class="n">matcher</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">descriptors1</span><span class="p">,</span> <span class="n">descriptors2</span><span class="p">,</span> <span class="n">outputMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points 1-&gt;2: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">outputMatches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 4. Validate matches using RANSAC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">fundamental</span> <span class="o">=</span> <span class="n">ransacTest</span><span class="p">(</span><span class="n">outputMatches</span><span class="p">,</span> <span class="n">keypoints1</span><span class="p">,</span> <span class="n">keypoints2</span><span class="p">,</span> <span class="n">matches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matched points (after RANSAC): &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">matches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// return the found fundamental matrix
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">fundamental</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// ！define MATCHER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined TMATCHER
</span></span></span><span class="line"><span class="cl"><span class="cp">#define TMATCHER
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#define VERBOSE 1
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/highgui.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/features2d.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/calib3d.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/features2d.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">TargetMatcher</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//特征点检测器对象的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">FeatureDetector</span><span class="o">&gt;</span> <span class="n">detector</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//特征描述子提取器对象的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span> <span class="n">descriptor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//目标图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">target</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//比较描述子容器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">normType</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//最小重投影误差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">distance</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//金字塔形图像的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">numberOfLevels</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//层级之间的范围
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">scaleFactor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//目标图像构建的金字塔以及它的关键点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">pyramid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">pyrKeypoints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">pyrDescriptors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建目标图像的金字塔
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">createPyramid</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 创建目标图像的金字塔
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">pyramid</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">layer</span><span class="p">(</span><span class="n">target</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfLevels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 逐层缩小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pyramid</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">target</span><span class="p">.</span><span class="n">clone</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">			<span class="n">resize</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(),</span> <span class="n">scaleFactor</span><span class="p">,</span> <span class="n">scaleFactor</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">pyrKeypoints</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">pyrDescriptors</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 逐层检测关键点和描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfLevels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 在第i层检测目标关键点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pyrKeypoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">			<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pyrKeypoints</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Interest points: target=&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">pyrKeypoints</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//在第i层计算描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">pyrDescriptors</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">			<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">pyramid</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pyrKeypoints</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">pyrDescriptors</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">TargetMatcher</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">FeatureDetector</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">detector</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">descriptor</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DescriptorExtractor</span><span class="o">&gt;</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">numberOfLevels</span> <span class="o">=</span> <span class="mi">8</span><span class="p">,</span> <span class="kt">double</span> <span class="n">scaleFactor</span> <span class="o">=</span> <span class="mf">0.9</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="o">:</span> <span class="n">detector</span><span class="p">(</span><span class="n">detector</span><span class="p">),</span> <span class="n">descriptor</span><span class="p">(</span><span class="n">descriptor</span><span class="p">),</span> <span class="n">normType</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">NORM_L2</span><span class="p">),</span> <span class="n">distance</span><span class="p">(</span><span class="mf">1.0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		<span class="n">numberOfLevels</span><span class="p">(</span><span class="n">numberOfLevels</span><span class="p">),</span> <span class="n">scaleFactor</span><span class="p">(</span><span class="n">scaleFactor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// in this case use the associated descriptor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="k">this</span><span class="o">-&gt;</span><span class="n">descriptor</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">this</span><span class="o">-&gt;</span><span class="n">descriptor</span> <span class="o">=</span> <span class="k">this</span><span class="o">-&gt;</span><span class="n">detector</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the norm to be used for matching
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setNormType</span><span class="p">(</span><span class="kt">int</span> <span class="n">norm</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">normType</span> <span class="o">=</span> <span class="n">norm</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the minimum reprojection distance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setReprojectionDistance</span><span class="p">(</span><span class="kt">double</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">distance</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//设置目标图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setTarget</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="n">t</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Target&#34;</span><span class="p">,</span> <span class="n">t</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">target</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">createPyramid</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Identify good matches using RANSAC
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// Return homography matrix and output matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//下面的是更好的
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">ransacTest</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">matches</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints1</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;&amp;</span> <span class="n">keypoints2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;&amp;</span> <span class="n">outMatches</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Convert keypoints into Point2f	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">outMatches</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">it</span> <span class="o">=</span> <span class="n">matches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="n">it</span> <span class="o">!=</span> <span class="n">matches</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">it</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// Get the position of left keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points1</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints1</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">queryIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// Get the position of right keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points2</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">keypoints2</span><span class="p">[</span><span class="n">it</span><span class="o">-&gt;</span><span class="n">trainIdx</span><span class="p">].</span><span class="n">pt</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// Find the homography between image 1 and image 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="n">inliers</span><span class="p">(</span><span class="n">points1</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">homography</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">findHomography</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">points1</span><span class="p">,</span> <span class="n">points2</span><span class="p">,</span> <span class="c1">// corresponding points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">inliers</span><span class="p">,</span>         <span class="c1">// match status (inlier or outlier)  
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">RHO</span><span class="p">,</span>	     <span class="c1">// RHO method
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">distance</span><span class="p">);</span>       <span class="c1">// max distance to reprojection point
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">							 <span class="c1">// extract the surviving (inliers) matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itIn</span> <span class="o">=</span> <span class="n">inliers</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itM</span> <span class="o">=</span> <span class="n">matches</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// for all matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(;</span> <span class="n">itIn</span> <span class="o">!=</span> <span class="n">inliers</span><span class="p">.</span><span class="n">end</span><span class="p">();</span> <span class="o">++</span><span class="n">itIn</span><span class="p">,</span> <span class="o">++</span><span class="n">itM</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">itIn</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// it is a valid match
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				<span class="n">outMatches</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="o">*</span><span class="n">itM</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">homography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 检测预先定义的平面目标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 返回单应矩阵和检测到的目标的4个角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">detectTarget</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">image</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 目标角点的坐标（顺时针方向）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;&amp;</span> <span class="n">detectedCorners</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 1. 检测图像的关键点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">KeyPoint</span><span class="o">&gt;</span> <span class="n">keypoints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">detector</span><span class="o">-&gt;</span><span class="n">detect</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Interest points: image=&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">keypoints</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 计算描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">descriptors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">descriptor</span><span class="o">-&gt;</span><span class="n">compute</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">matches</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">bestHomography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Size</span> <span class="n">bestSize</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">int</span> <span class="n">maxInliers</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">homography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 构建匹配器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">BFMatcher</span> <span class="n">matcher</span><span class="p">(</span><span class="n">normType</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 2. 对金字塔的每层， 鲁棒匹配单应矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">numberOfLevels</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 在目标和图像之间发现RANSAC单应矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">matches</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 匹配描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">matcher</span><span class="p">.</span><span class="n">match</span><span class="p">(</span><span class="n">pyrDescriptors</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">descriptors</span><span class="p">,</span> <span class="n">matches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of matches (level &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;)=&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">matches</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 用RANSAC验证匹配项
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">DMatch</span><span class="o">&gt;</span> <span class="n">inliers</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">homography</span> <span class="o">=</span> <span class="n">ransacTest</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="n">pyrKeypoints</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">keypoints</span><span class="p">,</span> <span class="n">inliers</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of inliers=&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">inliers</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">inliers</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&gt;</span> <span class="n">maxInliers</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 有更好的 H
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">maxInliers</span> <span class="o">=</span> <span class="n">inliers</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">				<span class="n">bestHomography</span> <span class="o">=</span> <span class="n">homography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">bestSize</span> <span class="o">=</span> <span class="n">pyramid</span><span class="p">[</span><span class="n">i</span><span class="p">].</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">imageMatches</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">drawMatches</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">pyrKeypoints</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>  <span class="c1">// 1st image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">image</span><span class="p">,</span> <span class="n">keypoints</span><span class="p">,</span>  <span class="c1">// 2nd image and its keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">inliers</span><span class="p">,</span>			<span class="c1">// the matches
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">imageMatches</span><span class="p">,</span>		<span class="c1">// the image produced
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1">// color of the lines
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span>  <span class="c1">// color of the keypoints
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">char</span><span class="o">&gt;</span><span class="p">(),</span>
</span></span><span class="line"><span class="cl">					<span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Target matches&#34;</span><span class="p">,</span> <span class="n">imageMatches</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 3. 用最佳单应矩阵找出角点坐标
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">maxInliers</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 估计值有效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="c1">//最佳尺寸的目标角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">corners</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">corners</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">corners</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="n">bestSize</span><span class="p">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">corners</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="n">bestSize</span><span class="p">.</span><span class="n">width</span> <span class="o">-</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bestSize</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">corners</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">bestSize</span><span class="p">.</span><span class="n">height</span> <span class="o">-</span> <span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 重新投影目标角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">perspectiveTransform</span><span class="p">(</span><span class="n">corners</span><span class="p">,</span> <span class="n">detectedCorners</span><span class="p">,</span> <span class="n">bestHomography</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">VERBOSE</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Best number of inliers=&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">maxInliers</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">bestHomography</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined TMATCHER
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_11-----三维重建">Chapter_11  :   三维重建</h3>
<blockquote>
<p>1.相机标定
2.相机姿态还原
3.用标定相机实现三维重建
4.计算立体图像的深度</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;iostream&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;iomanip&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;vector&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/core.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/imgproc.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/highgui.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/features2d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/viz.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &lt;opencv2/calib3d.hpp&gt;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//#include &#34;CameraCalibrator.h&#34;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//int main()
</span></span></span><span class="line"><span class="cl"><span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1">//	////1.相机标定
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat image;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::vector&lt;std::string&gt; filelist;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// generate list of chessboard image filename
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// named chessboard01 to chessboard27 in chessboard sub-dir
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//for (int i = 1; i &lt;= 27; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::stringstream str;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	str &lt;&lt; &#34;images/chessboards/chessboard&#34; &lt;&lt; std::setw(2) &lt;&lt; std::setfill(&#39;0&#39;) &lt;&lt; i &lt;&lt; &#34;.jpg&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	std::cout &lt;&lt; str.str() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	filelist.push_back(str.str());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	image = cv::imread(str.str(), 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// cv::imshow(&#34;Board Image&#34;,image);	
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	// cv::waitKey(100);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Create calibrator object
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//CameraCalibrator cameraCalibrator;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// add the corners from the chessboard
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Size boardSize(7, 5);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cameraCalibrator.addChessboardPoints(
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	filelist,	// filenames of chessboard image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//	boardSize, &#34;Detected points&#34;);	// size of chessboard
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//									// calibrate the camera
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cameraCalibrator.setCalibrationFlag(true, true);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cameraCalibrator.calibrate(image.size());
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Exampple of Image Undistortion
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//image = cv::imread(filelist[14], 0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Size newSize(static_cast&lt;int&gt;(image.cols*1.5), static_cast&lt;int&gt;(image.rows*1.5));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat uImage = cameraCalibrator.remap(image, newSize);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// display camera matrix
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::Mat cameraMatrix = cameraCalibrator.getCameraMatrix();
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; &#34; Camera intrinsic: &#34; &lt;&lt; cameraMatrix.rows &lt;&lt; &#34;x&#34; &lt;&lt; cameraMatrix.cols &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 2) &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 2) &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 2) &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Original Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Original Image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::namedWindow(&#34;Undistorted Image&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::imshow(&#34;Undistorted Image&#34;, uImage);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//// Store everything in a xml file
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//cv::FileStorage fs(&#34;calib.xml&#34;, cv::FileStorage::WRITE);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//fs &lt;&lt; &#34;Intrinsic&#34; &lt;&lt; cameraMatrix;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	//fs &lt;&lt; &#34;Distortion&#34; &lt;&lt; cameraCalibrator.getDistCoeffs();
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read the camera calibration parameters
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat cameraMatrix;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat cameraDistCoeffs;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::FileStorage fs(&#34;calib.xml&#34;, cv::FileStorage::READ);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	fs[&#34;Intrinsic&#34;] &gt;&gt; cameraMatrix;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	fs[&#34;Distortion&#34;] &gt;&gt; cameraDistCoeffs;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34; Camera intrinsic: &#34; &lt;&lt; cameraMatrix.rows &lt;&lt; &#34;x&#34; &lt;&lt; cameraMatrix.cols &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(0, 2) &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(1, 2) &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 0) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 1) &lt;&lt; &#34; &#34; &lt;&lt; cameraMatrix.at&lt;double&gt;(2, 2) &lt;&lt; std::endl &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Matx33d cMatrix(cameraMatrix);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Input image points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::vector&lt;cv::Point2f&gt; imagePoints;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(136, 113));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(379, 114));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(379, 150));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(138, 135));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(143, 146));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(381, 166));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(345, 194));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	imagePoints.push_back(cv::Point2f(103, 161));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Input object points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::vector&lt;cv::Point3f&gt; objectPoints;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(0, 45, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(242.5, 45, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(242.5, 21, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(0, 21, 0));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(0, 9, -9));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(242.5, 9, -9));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(242.5, 9, 44.5));
</span></span></span><span class="line"><span class="cl"><span class="c1">//	objectPoints.push_back(cv::Point3f(0, 9, 44.5));
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Read image
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat image = cv::imread(&#34;./images/bench2.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Draw image points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	for (int i = 0; i &lt; 8; i++) {
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::circle(image, imagePoints[i], 3, cv::Scalar(0, 0, 0), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::imshow(&#34;An image of a bench&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Create a viz window
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::viz::Viz3d visualizer(&#34;Viz window&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.setBackgroundColor(cv::viz::Color::white());
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	/// Construct the scene
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Create a virtual camera
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::viz::WCameraPosition cam(cMatrix,  // matrix of intrinsics
</span></span></span><span class="line"><span class="cl"><span class="c1">//		image,    // image displayed on the plane
</span></span></span><span class="line"><span class="cl"><span class="c1">//		30.0,     // scale factor
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::viz::Color::black());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Create a virtual bench from cuboids
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::viz::WCube plane1(cv::Point3f(0.0, 45.0, 0.0),
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Point3f(242.5, 21.0, -9.0),
</span></span></span><span class="line"><span class="cl"><span class="c1">//		true,  // show wire frame 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::viz::Color::blue());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	plane1.setRenderingProperty(cv::viz::LINE_WIDTH, 4.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::viz::WCube plane2(cv::Point3f(0.0, 9.0, -9.0),
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::Point3f(242.5, 0.0, 44.5),
</span></span></span><span class="line"><span class="cl"><span class="c1">//		true,  // show wire frame 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cv::viz::Color::blue());
</span></span></span><span class="line"><span class="cl"><span class="c1">//	plane2.setRenderingProperty(cv::viz::LINE_WIDTH, 4.0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Add the virtual objects to the environment
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.showWidget(&#34;top&#34;, plane1);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.showWidget(&#34;bottom&#34;, plane2);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.showWidget(&#34;Camera&#34;, cam);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Get the camera pose from 3D/2D points
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat rvec, tvec;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::solvePnP(objectPoints, imagePoints,      // corresponding 3D/2D pts 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		cameraMatrix, cameraDistCoeffs, // calibration 
</span></span></span><span class="line"><span class="cl"><span class="c1">//		rvec, tvec);                    // output pose
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34; rvec: &#34; &lt;&lt; rvec.rows &lt;&lt; &#34;x&#34; &lt;&lt; rvec.cols &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	std::cout &lt;&lt; &#34; tvec: &#34; &lt;&lt; tvec.rows &lt;&lt; &#34;x&#34; &lt;&lt; tvec.cols &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Mat rotation;
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// convert vector-3 rotation
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// to a 3x3 rotation matrix
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Rodrigues(rvec, rotation);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// Move the bench	
</span></span></span><span class="line"><span class="cl"><span class="c1">//	cv::Affine3d pose(rotation, tvec);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.setWidgetPose(&#34;top&#34;, pose);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	visualizer.setWidgetPose(&#34;bottom&#34;, pose);
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	// visualization loop
</span></span></span><span class="line"><span class="cl"><span class="c1">//	while (cv::waitKey(100) == -1 &amp;&amp; !visualizer.wasStopped())
</span></span></span><span class="line"><span class="cl"><span class="c1">//	{
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//		visualizer.spinOnce(1,     // pause 1ms 
</span></span></span><span class="line"><span class="cl"><span class="c1">//			true); // redraw
</span></span></span><span class="line"><span class="cl"><span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1">//	waitKey(0);
</span></span></span><span class="line"><span class="cl"><span class="c1">//	return 0;
</span></span></span><span class="line"><span class="cl"><span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined CAMERACALIBRATOR_H
</span></span></span><span class="line"><span class="cl"><span class="cp">#define CAMERACALIBRATOR_H
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">CameraCalibrator</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输入点：
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//世界坐标系中的点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//（每个正方形为一个单位）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Point3f</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">objectPoints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//点在图像中的位置（以像素为单位）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="o">&gt;</span> <span class="n">imagePoints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">cameraMatrix</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Mat</span> <span class="n">distCoeffs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//指定标定方式的标志
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">flag</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//用于图像不失真
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">mustInitUndistort</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">CameraCalibrator</span><span class="p">()</span> <span class="o">:</span> <span class="n">flag</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">mustInitUndistort</span><span class="p">(</span><span class="nb">true</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//打开棋盘图像，提取角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">addChessboardPoints</span><span class="p">(</span><span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">filelist</span><span class="p">,</span> <span class="n">Size</span> <span class="o">&amp;</span><span class="n">boardSize</span><span class="p">,</span> <span class="n">string</span> <span class="n">windowName</span> <span class="o">=</span> <span class="s">&#34;&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Add scene points and corresponding image points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">addPoints</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;&amp;</span> <span class="n">imageCorners</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="o">&gt;&amp;</span> <span class="n">objectCorners</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//标定相机
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="nf">calibrate</span><span class="p">(</span><span class="k">const</span> <span class="n">Size</span> <span class="n">imageSize</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the calibration flag
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setCalibrationFlag</span><span class="p">(</span><span class="kt">bool</span> <span class="n">radial8CoeffEnabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">tangentialParamEnabled</span> <span class="o">=</span> <span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//去除图像中的畸变（标定后）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="nf">remap</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Size</span> <span class="o">&amp;</span><span class="n">outputSize</span> <span class="o">=</span> <span class="n">Size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Getters
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getCameraMatrix</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">cameraMatrix</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">getDistCoeffs</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">distCoeffs</span><span class="p">;</span> <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined CAMERACALIBRATOR_H
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;CameraCalibrator.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//打开棋盘图像，提取角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">int</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">addChessboardPoints</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="o">&amp;</span><span class="n">filelist</span><span class="p">,</span>   <span class="c1">//文件名列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Size</span> <span class="o">&amp;</span><span class="n">boardSize</span><span class="p">,</span>                  <span class="c1">//标定面板的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">windowName</span>                 <span class="c1">//展示窗口的名字
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//棋盘上的角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">imageCorners</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point3f</span><span class="o">&gt;</span> <span class="n">objectCorners</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//场景中的三维点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//在棋盘坐标系中， 初始化棋盘中的角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//角点的三维坐标（X, Y，Z）= （i，j，0）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">boardSize</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">boardSize</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">objectCorners</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">Point3f</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="mf">0.0f</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//图像上的二维点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image</span><span class="p">;</span>  <span class="c1">//用于存储棋盘图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">successes</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//处理所有视角
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">filelist</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//打开图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="n">filelist</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//取得棋盘中的角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">bool</span> <span class="n">found</span> <span class="o">=</span> <span class="n">findChessboardCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span>       <span class="c1">//包含棋盘图案的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			                               <span class="n">boardSize</span><span class="p">,</span>   <span class="c1">//图案的大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			                               <span class="n">imageCorners</span> <span class="c1">//检测到角点的列表
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		                                   <span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//取得角点上的亚像素级精度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">found</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">cornerSubPix</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">imageCorners</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				<span class="n">Size</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="n">Size</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="n">TermCriteria</span><span class="p">(</span><span class="n">TermCriteria</span><span class="o">::</span><span class="n">MAX_ITER</span> <span class="o">+</span> <span class="n">TermCriteria</span><span class="o">::</span><span class="n">EPS</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">					<span class="mi">30</span><span class="p">,</span>   <span class="c1">//最大迭代次数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>					<span class="mf">0.1</span><span class="p">));</span><span class="c1">//最小精度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="c1">//如果棋盘是完好的，就把它加入结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">imageCorners</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">boardSize</span><span class="p">.</span><span class="n">area</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//加入从同一个视角得到的图像和场景点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">addPoints</span><span class="p">(</span><span class="n">imageCorners</span><span class="p">,</span> <span class="n">objectCorners</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">successes</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">windowName</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">&gt;</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">imageCorners</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="n">boardSize</span><span class="p">.</span><span class="n">area</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//画角点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">drawChessboardCorners</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">boardSize</span><span class="p">,</span> <span class="n">imageCorners</span><span class="p">,</span> <span class="n">found</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">imshow</span><span class="p">(</span><span class="n">windowName</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">waitKey</span><span class="p">(</span><span class="mi">100</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">successes</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Add scene points and corresponding image points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">addPoints</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point2f</span><span class="o">&gt;&amp;</span> <span class="n">imageCorners</span><span class="p">,</span> <span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Point3f</span><span class="o">&gt;&amp;</span> <span class="n">objectCorners</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 2D image points from one view
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">imagePoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">imageCorners</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// corresponding 3D scene points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">objectPoints</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">objectCorners</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 标定相机
</span></span></span><span class="line"><span class="cl"><span class="c1">// 返回重投影误差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">double</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">calibrate</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span> <span class="n">imageSize</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// undistorter must be reinitialized
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">mustInitUndistort</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//输出旋转量和平移量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">rvecs</span><span class="p">,</span> <span class="n">tvecs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 开始标定
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">return</span>
</span></span><span class="line"><span class="cl">		<span class="nf">calibrateCamera</span><span class="p">(</span><span class="n">objectPoints</span><span class="p">,</span> <span class="c1">// 三维点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">imagePoints</span><span class="p">,</span>  <span class="c1">// 图像点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">imageSize</span><span class="p">,</span>    <span class="c1">// 图像尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cameraMatrix</span><span class="p">,</span> <span class="c1">// 输出相机矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">distCoeffs</span><span class="p">,</span>   <span class="c1">// 输出畸变矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">rvecs</span><span class="p">,</span> <span class="n">tvecs</span><span class="p">,</span> <span class="c1">// Rs, Ts 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">flag</span><span class="p">);</span>        <span class="c1">// 设置选项,CV_CALIB_USE_INTRINSIC_GUESS);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 去除图像中的畸变(标定后)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">remap</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span> <span class="o">&amp;</span><span class="n">outputSize</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">undistorted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">outputSize</span><span class="p">.</span><span class="n">height</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">outputSize</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">mustInitUndistort</span><span class="p">)</span> <span class="p">{</span> <span class="c1">// 每个标定过程调用一次
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">initUndistortRectifyMap</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">			<span class="n">cameraMatrix</span><span class="p">,</span>  <span class="c1">// 计算得到的相机矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">distCoeffs</span><span class="p">,</span>    <span class="c1">// 计算得到的畸变矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(),</span>     <span class="c1">// 可选矫正项 (无) 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="p">(),</span>     <span class="c1">// 生成无畸变的相机矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">outputSize</span><span class="p">,</span>    <span class="c1">// 无畸变图像的尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">CV_32FC1</span><span class="p">,</span>      <span class="c1">// 输出图片的类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">);</span>   <span class="c1">// x 和 y 映射功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="n">mustInitUndistort</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 映射功能
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">remap</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">undistorted</span><span class="p">,</span> <span class="n">map1</span><span class="p">,</span> <span class="n">map2</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">INTER_LINEAR</span><span class="p">);</span> <span class="c1">// 插值类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="n">undistorted</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Set the calibration options
</span></span></span><span class="line"><span class="cl"><span class="c1">// 8radialCoeffEnabled should be true if 8 radial coefficients are required (5 is default)
</span></span></span><span class="line"><span class="cl"><span class="c1">// tangentialParamEnabled should be true if tangeantial distortion is present
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="n">CameraCalibrator</span><span class="o">::</span><span class="n">setCalibrationFlag</span><span class="p">(</span><span class="kt">bool</span> <span class="n">radial8CoeffEnabled</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">tangentialParamEnabled</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the flag used in cv::calibrateCamera()
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">flag</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tangentialParamEnabled</span><span class="p">)</span> <span class="n">flag</span> <span class="o">+=</span> <span class="n">CV_CALIB_ZERO_TANGENT_DIST</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">if</span> <span class="p">(</span><span class="n">radial8CoeffEnabled</span><span class="p">)</span> <span class="n">flag</span> <span class="o">+=</span> <span class="n">CV_CALIB_RATIONAL_MODEL</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_12--处理视频序列">Chapter_12 : 处理视频序列</h3>
<blockquote>
<p>1.读取视频处理
2.处理视频帧
3.提取视频中的眼前物体</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span><span class="lnt">484
</span><span class="lnt">485
</span><span class="lnt">486
</span><span class="lnt">487
</span><span class="lnt">488
</span><span class="lnt">489
</span><span class="lnt">490
</span><span class="lnt">491
</span><span class="lnt">492
</span><span class="lnt">493
</span><span class="lnt">494
</span><span class="lnt">495
</span><span class="lnt">496
</span><span class="lnt">497
</span><span class="lnt">498
</span><span class="lnt">499
</span><span class="lnt">500
</span><span class="lnt">501
</span><span class="lnt">502
</span><span class="lnt">503
</span><span class="lnt">504
</span><span class="lnt">505
</span><span class="lnt">506
</span><span class="lnt">507
</span><span class="lnt">508
</span><span class="lnt">509
</span><span class="lnt">510
</span><span class="lnt">511
</span><span class="lnt">512
</span><span class="lnt">513
</span><span class="lnt">514
</span><span class="lnt">515
</span><span class="lnt">516
</span><span class="lnt">517
</span><span class="lnt">518
</span><span class="lnt">519
</span><span class="lnt">520
</span><span class="lnt">521
</span><span class="lnt">522
</span><span class="lnt">523
</span><span class="lnt">524
</span><span class="lnt">525
</span><span class="lnt">526
</span><span class="lnt">527
</span><span class="lnt">528
</span><span class="lnt">529
</span><span class="lnt">530
</span><span class="lnt">531
</span><span class="lnt">532
</span><span class="lnt">533
</span><span class="lnt">534
</span><span class="lnt">535
</span><span class="lnt">536
</span><span class="lnt">537
</span><span class="lnt">538
</span><span class="lnt">539
</span><span class="lnt">540
</span><span class="lnt">541
</span><span class="lnt">542
</span><span class="lnt">543
</span><span class="lnt">544
</span><span class="lnt">545
</span><span class="lnt">546
</span><span class="lnt">547
</span><span class="lnt">548
</span><span class="lnt">549
</span><span class="lnt">550
</span><span class="lnt">551
</span><span class="lnt">552
</span><span class="lnt">553
</span><span class="lnt">554
</span><span class="lnt">555
</span><span class="lnt">556
</span><span class="lnt">557
</span><span class="lnt">558
</span><span class="lnt">559
</span><span class="lnt">560
</span><span class="lnt">561
</span><span class="lnt">562
</span><span class="lnt">563
</span><span class="lnt">564
</span><span class="lnt">565
</span><span class="lnt">566
</span><span class="lnt">567
</span><span class="lnt">568
</span><span class="lnt">569
</span><span class="lnt">570
</span><span class="lnt">571
</span><span class="lnt">572
</span><span class="lnt">573
</span><span class="lnt">574
</span><span class="lnt">575
</span><span class="lnt">576
</span><span class="lnt">577
</span><span class="lnt">578
</span><span class="lnt">579
</span><span class="lnt">580
</span><span class="lnt">581
</span><span class="lnt">582
</span><span class="lnt">583
</span><span class="lnt">584
</span><span class="lnt">585
</span><span class="lnt">586
</span><span class="lnt">587
</span><span class="lnt">588
</span><span class="lnt">589
</span><span class="lnt">590
</span><span class="lnt">591
</span><span class="lnt">592
</span><span class="lnt">593
</span><span class="lnt">594
</span><span class="lnt">595
</span><span class="lnt">596
</span><span class="lnt">597
</span><span class="lnt">598
</span><span class="lnt">599
</span><span class="lnt">600
</span><span class="lnt">601
</span><span class="lnt">602
</span><span class="lnt">603
</span><span class="lnt">604
</span><span class="lnt">605
</span><span class="lnt">606
</span><span class="lnt">607
</span><span class="lnt">608
</span><span class="lnt">609
</span><span class="lnt">610
</span><span class="lnt">611
</span><span class="lnt">612
</span><span class="lnt">613
</span><span class="lnt">614
</span><span class="lnt">615
</span><span class="lnt">616
</span><span class="lnt">617
</span><span class="lnt">618
</span><span class="lnt">619
</span><span class="lnt">620
</span><span class="lnt">621
</span><span class="lnt">622
</span><span class="lnt">623
</span><span class="lnt">624
</span><span class="lnt">625
</span><span class="lnt">626
</span><span class="lnt">627
</span><span class="lnt">628
</span><span class="lnt">629
</span><span class="lnt">630
</span><span class="lnt">631
</span><span class="lnt">632
</span><span class="lnt">633
</span><span class="lnt">634
</span><span class="lnt">635
</span><span class="lnt">636
</span><span class="lnt">637
</span><span class="lnt">638
</span><span class="lnt">639
</span><span class="lnt">640
</span><span class="lnt">641
</span><span class="lnt">642
</span><span class="lnt">643
</span><span class="lnt">644
</span><span class="lnt">645
</span><span class="lnt">646
</span><span class="lnt">647
</span><span class="lnt">648
</span><span class="lnt">649
</span><span class="lnt">650
</span><span class="lnt">651
</span><span class="lnt">652
</span><span class="lnt">653
</span><span class="lnt">654
</span><span class="lnt">655
</span><span class="lnt">656
</span><span class="lnt">657
</span><span class="lnt">658
</span><span class="lnt">659
</span><span class="lnt">660
</span><span class="lnt">661
</span><span class="lnt">662
</span><span class="lnt">663
</span><span class="lnt">664
</span><span class="lnt">665
</span><span class="lnt">666
</span><span class="lnt">667
</span><span class="lnt">668
</span><span class="lnt">669
</span><span class="lnt">670
</span><span class="lnt">671
</span><span class="lnt">672
</span><span class="lnt">673
</span><span class="lnt">674
</span><span class="lnt">675
</span><span class="lnt">676
</span><span class="lnt">677
</span><span class="lnt">678
</span><span class="lnt">679
</span><span class="lnt">680
</span><span class="lnt">681
</span><span class="lnt">682
</span><span class="lnt">683
</span><span class="lnt">684
</span><span class="lnt">685
</span><span class="lnt">686
</span><span class="lnt">687
</span><span class="lnt">688
</span><span class="lnt">689
</span><span class="lnt">690
</span><span class="lnt">691
</span><span class="lnt">692
</span><span class="lnt">693
</span><span class="lnt">694
</span><span class="lnt">695
</span><span class="lnt">696
</span><span class="lnt">697
</span><span class="lnt">698
</span><span class="lnt">699
</span><span class="lnt">700
</span><span class="lnt">701
</span><span class="lnt">702
</span><span class="lnt">703
</span><span class="lnt">704
</span><span class="lnt">705
</span><span class="lnt">706
</span><span class="lnt">707
</span><span class="lnt">708
</span><span class="lnt">709
</span><span class="lnt">710
</span><span class="lnt">711
</span><span class="lnt">712
</span><span class="lnt">713
</span><span class="lnt">714
</span><span class="lnt">715
</span><span class="lnt">716
</span><span class="lnt">717
</span><span class="lnt">718
</span><span class="lnt">719
</span><span class="lnt">720
</span><span class="lnt">721
</span><span class="lnt">722
</span><span class="lnt">723
</span><span class="lnt">724
</span><span class="lnt">725
</span><span class="lnt">726
</span><span class="lnt">727
</span><span class="lnt">728
</span><span class="lnt">729
</span><span class="lnt">730
</span><span class="lnt">731
</span><span class="lnt">732
</span><span class="lnt">733
</span><span class="lnt">734
</span><span class="lnt">735
</span><span class="lnt">736
</span><span class="lnt">737
</span><span class="lnt">738
</span><span class="lnt">739
</span><span class="lnt">740
</span><span class="lnt">741
</span><span class="lnt">742
</span><span class="lnt">743
</span><span class="lnt">744
</span><span class="lnt">745
</span><span class="lnt">746
</span><span class="lnt">747
</span><span class="lnt">748
</span><span class="lnt">749
</span><span class="lnt">750
</span><span class="lnt">751
</span><span class="lnt">752
</span><span class="lnt">753
</span><span class="lnt">754
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/bgsegm.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;VideoProcessor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;BGFGSegmentor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">draw</span><span class="p">(</span><span class="k">const</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">img</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">img</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">out</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">circle</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Point</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="mi">5</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">void</span> <span class="nf">canny</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">img</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span> <span class="n">out</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 转换为灰度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">img</span><span class="p">.</span><span class="n">channels</span><span class="p">()</span> <span class="o">==</span> <span class="mi">3</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">img</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">COLOR_BGR2GRAY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 计算Canny边缘
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Canny</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 反转图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">out</span><span class="p">,</span> <span class="n">out</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////1.读取视频处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">//   //打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//VideoCapture capture(&#34;./images/bike.avi&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////检查视频是否打开成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!capture.isOpened() )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////取得帧速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//double rate = capture.get(CV_CAP_PROP_FPS);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//bool stop(false);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat frame;  //当前视频帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//namedWindow(&#34;Extracted Frame&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////根据帧速率计算帧之间的等待时间， 单位为ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//int delay = 1000 / rate;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////循环遍历视频中的全部帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//while (!stop)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	//读取下一帧（如果有）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	if (!capture.read(frame) )
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	imshow(&#34;Extracted Frame&#34;, frame);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	//等待一段时间，或者通过按键停止
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	if (waitKey(delay) &gt;= 0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		stop = true;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////关闭视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////不是必须的，因为类的析构函数会调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//capture.release();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////2.处理视频帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//VideoCapture capture(&#34;./images/bike.avi&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////检查视频是否打开
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!capture.isOpened())
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return 1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////获取帧速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//double rate = capture.get(CV_CAP_PROP_FPS);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;Frame rate: &#34; &lt;&lt; rate &lt;&lt; &#34;fps&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//double stop(false);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat frame;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////根据帧速率计算镇之间的等待时间，单位为ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//int delay = 1000 / rate;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//long long i = 0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//string b = &#34;bike&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//string ext = &#34;.bmp&#34;;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////循环遍历视频中的全部帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//while (!stop)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//{
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	//读取下一帧（如果有）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	if (!capture.read(frame))
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		break;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	imshow(&#34;Extracted Frame&#34;, frame);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	string name(b);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	ostringstream ss;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	ss &lt;&lt; setfill(&#39;0&#39;) &lt;&lt; setw(3) &lt;&lt; i;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	name += ss.str();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	i++;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	name += ext;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	cout &lt;&lt; name &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	Mat test;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//	//等待一段时间， 或者通过按键停止
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	if (waitKey(delay) &gt;= 0)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//		stop = true;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//capture.release();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//waitKey();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////现在创建一个自定义类VideoProcessor完整的封装了视频处理任务
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//VideoProcessor processor;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setInput(&#34;./images/bike.avi&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////声明显示视频的窗口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.displayInput(&#34;Input Video&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.displayOutput(&#34;Output Video&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////用原始帧速率播放视频
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setDelay(1000. / processor.getFrameRate());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////设置处理帧的回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setFrameProcessor(canny);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////输出视频
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setOutput(&#34;./images/bikeCanny.avi&#34;, -1, 15);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////在当前帧停止处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.stopAtFrameNo(51);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////开始处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.run();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//waitKey();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//3.提取视频中的眼前物体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 打开视频
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">VideoCapture</span> <span class="n">capture</span><span class="p">(</span><span class="s">&#34;./images/bike.avi&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 检查是否打开成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capture</span><span class="p">.</span><span class="n">isOpened</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 当前视频帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 前景的二值图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">foreground</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 背景图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">background</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="s">&#34;Extracted Foreground&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 混合高斯模型类的对象，全部采用默认参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">cv</span><span class="o">::</span><span class="n">BackgroundSubtractor</span><span class="o">&gt;</span> <span class="n">ptrMOG</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">bgsegm</span><span class="o">::</span><span class="n">createBackgroundSubtractorMOG</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">stop</span><span class="p">(</span><span class="nb">false</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 遍历视频中的所有帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">stop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 读取下一帧（如果有）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">capture</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 更新背景并返回前景
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">ptrMOG</span><span class="o">-&gt;</span><span class="n">apply</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">foreground</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 改进图像效果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">foreground</span><span class="p">,</span> <span class="n">foreground</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 显示前景
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Extracted Foreground&#34;</span><span class="p">,</span> <span class="n">foreground</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 产生延时或者按键结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">stop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//// Create video procesor instance
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//VideoProcessor processor;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Create background/foreground segmentor 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//BGFGSegmentor segmentor;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//segmentor.setThreshold(25);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Open video file
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setInput(&#34;./images/bike.avi&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// set frame processor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setFrameProcessor(&amp;segmentor);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Declare a window to display the video
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.displayOutput(&#34;Extracted Foreground&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Play the video at the original frame rate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setDelay(1000. / processor.getFrameRate());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Start the process
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.run();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::waitKey();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined VPROCESSOR
</span></span></span><span class="line"><span class="cl"><span class="cp">#define VPROCESSOR
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//帧处理的接口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="k">class</span> <span class="nc">FrameProcessor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//处理方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">virtual</span> <span class="kt">void</span> <span class="n">process</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">input</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VideoProcessor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Opencv视频捕获对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VideoCapture</span> <span class="n">capture</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//处理每一帧时都会调用的回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">process</span><span class="p">)</span> <span class="p">(</span><span class="n">Mat</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">Mat</span><span class="o">&amp;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">FrameProcessor</span> <span class="o">*</span><span class="n">frameProcessor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//布尔型变量，表示该回调函数是否会被调用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">callIt</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输入窗口的显示名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">windowNameInput</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出窗口的显示名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">windowNameOutput</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//帧之间的延时
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">delay</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//已经处理的帧数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="n">fnumber</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//达到这个帧数时结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="n">frameToStop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//结束处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="n">stop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用作输入图像的图像文件名向量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">images</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//图像容器的迭代器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itImg</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Opencv写视频对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VideoWriter</span> <span class="n">writer</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">outputFile</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出图像的当前序号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">currentIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出图像文件名中数字的位数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">digits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//输出图像的扩展名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">string</span> <span class="n">extension</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//取得下一帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//可以是视频文件、摄像机、图像向量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">readNextFrame</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span><span class="o">==</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">read</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">itImg</span> <span class="o">!=</span> <span class="n">images</span><span class="p">.</span><span class="n">end</span><span class="p">()</span> <span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">frame</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="o">*</span><span class="n">itImg</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="n">itImg</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="n">frame</span><span class="p">.</span><span class="n">data</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//写输出的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//可以是视频文件或者图像组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">void</span> <span class="nf">writeNextFrame</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="n">extension</span><span class="p">.</span><span class="n">length</span><span class="p">())</span>  <span class="c1">//写入到图像组
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">stringstream</span> <span class="n">ss</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">outputFile</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="n">digits</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">currentIndex</span><span class="o">++</span> <span class="o">&lt;&lt;</span> <span class="n">extension</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">				<span class="n">imwrite</span><span class="p">(</span><span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">(),</span> <span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span>   <span class="c1">//写入到视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="n">writer</span><span class="p">.</span><span class="n">write</span><span class="p">(</span><span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 构造函数设置默认的值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VideoProcessor</span><span class="p">()</span> <span class="o">:</span> <span class="n">callIt</span><span class="p">(</span><span class="nb">false</span><span class="p">),</span> <span class="n">delay</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">fnumber</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">stop</span><span class="p">(</span><span class="nb">false</span><span class="p">),</span> <span class="n">digits</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">frameToStop</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">),</span><span class="n">process</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">frameProcessor</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置视频文件的名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setInput</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">filename</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">fnumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 防止已经有资源和VideoCapture实例关联
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">capture</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">images</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">filename</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置相机id
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setInput</span><span class="p">(</span><span class="kt">int</span> <span class="n">id</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">fnumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 防止已经有资源和VideoCapture实例关联
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">capture</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">images</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">id</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置输入图像的向量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setInput</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;&amp;</span> <span class="n">imgs</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">fnumber</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 防止已经有资源和VideoCapture实例关联
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">capture</span><span class="p">.</span><span class="n">release</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 将这个图像向量作为输入对象
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">images</span> <span class="o">=</span> <span class="n">imgs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">itImg</span> <span class="o">=</span> <span class="n">images</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置输出视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 默认情况下会使用与输入视频相同的参数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setOutput</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">filename</span><span class="p">,</span> <span class="kt">int</span> <span class="n">codec</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="kt">double</span> <span class="n">framerate</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isColor</span> <span class="o">=</span> <span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">outputFile</span> <span class="o">=</span> <span class="n">filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">extension</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">framerate</span> <span class="o">==</span> <span class="mf">0.0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="n">framerate</span> <span class="o">=</span> <span class="n">getFrameRate</span><span class="p">();</span> <span class="c1">// 与输入相同
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="kt">char</span> <span class="n">c</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//使用与输入相同的编解码器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">codec</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">codec</span> <span class="o">=</span> <span class="n">getCodec</span><span class="p">(</span><span class="n">c</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//打开输出视频
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">writer</span><span class="p">.</span><span class="n">open</span><span class="p">(</span><span class="n">outputFile</span><span class="p">,</span> <span class="c1">//文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">codec</span><span class="p">,</span> <span class="c1">// 所用的编解码器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">framerate</span><span class="p">,</span>      <span class="c1">// 视频的帧速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">getFrameSize</span><span class="p">(),</span> <span class="c1">// 帧的尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">isColor</span><span class="p">);</span>       <span class="c1">// 彩色视频？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置输出一系列图像文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 扩展名是 &#34;.jpg&#34;,或者&#34;.bmp&#34; ...
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setOutput</span><span class="p">(</span><span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">filename</span><span class="p">,</span> <span class="c1">// 前缀
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">const</span> <span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="o">&amp;</span><span class="n">ext</span><span class="p">,</span> <span class="c1">// 图像文件的扩展名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">numberOfDigits</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span>   <span class="c1">//数字的位数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">startIndex</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>     <span class="c1">// 开始序号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	    <span class="c1">// 数字的位数必须是正数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">numberOfDigits</span><span class="o">&lt;</span><span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 文件名和常用的扩展名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">outputFile</span> <span class="o">=</span> <span class="n">filename</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">extension</span> <span class="o">=</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 文件编号方案中数字的位数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">digits</span> <span class="o">=</span> <span class="n">numberOfDigits</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 从这个序号开始编码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">currentIndex</span> <span class="o">=</span> <span class="n">startIndex</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// set the callback function that will be called for each frame
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setFrameProcessor</span><span class="p">(</span><span class="kt">void</span><span class="p">(</span><span class="o">*</span><span class="n">frameProcessingCallback</span><span class="p">)(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span><span class="o">&amp;</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 使回调函数失效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">frameProcessor</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 这个就是即将被调用的帧处理实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">process</span> <span class="o">=</span> <span class="n">frameProcessingCallback</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">callProcess</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置实现 FrameProcessor接口的实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setFrameProcessor</span><span class="p">(</span><span class="n">FrameProcessor</span><span class="o">*</span> <span class="n">frameProcessorPtr</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 使回调函数失效
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">process</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 这个就是即将被调用的帧处理实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">frameProcessor</span> <span class="o">=</span> <span class="n">frameProcessorPtr</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">callProcess</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// stop streaming at this frame number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">stopAtFrameNo</span><span class="p">(</span><span class="kt">long</span> <span class="n">frame</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">frameToStop</span> <span class="o">=</span> <span class="n">frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//需要调用回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">callProcess</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">callIt</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//不需要调用回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">dontCallProcess</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">callIt</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用于显示输入的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">displayInput</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">wn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">windowNameInput</span> <span class="o">=</span> <span class="n">wn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="n">windowNameInput</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//用于显示处理过的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">displayOutput</span><span class="p">(</span><span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">wn</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">windowNameOutput</span> <span class="o">=</span> <span class="n">wn</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">namedWindow</span><span class="p">(</span><span class="n">windowNameOutput</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// do not display the processed frames
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">dontDisplay</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">destroyWindow</span><span class="p">(</span><span class="n">windowNameInput</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">cv</span><span class="o">::</span><span class="n">destroyWindow</span><span class="p">(</span><span class="n">windowNameOutput</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">windowNameInput</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">windowNameOutput</span><span class="p">.</span><span class="n">clear</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置帧之间的延迟
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 0 表示每一帧都在等待
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 负数表示不延时
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setDelay</span><span class="p">(</span><span class="kt">int</span> <span class="n">d</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">delay</span> <span class="o">=</span> <span class="n">d</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// a count is kept of the processed frames
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="nf">getNumberOfProcessedFrames</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">fnumber</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// return the size of the video frame
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Size</span> <span class="n">getFrameSize</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// get size of from the capture device
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kt">int</span> <span class="n">w</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_FRAME_WIDTH</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">h</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_FRAME_HEIGHT</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span> <span class="c1">// if input is vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">tmp</span> <span class="o">=</span> <span class="n">cv</span><span class="o">::</span><span class="n">imread</span><span class="p">(</span><span class="n">images</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">tmp</span><span class="p">.</span><span class="n">data</span><span class="p">)</span> <span class="k">return</span> <span class="n">cv</span><span class="o">::</span><span class="n">Size</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> <span class="k">return</span> <span class="n">tmp</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 返回下一帧的编号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="nf">getFrameNumber</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">//从捕获设备获取信息
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kt">long</span> <span class="n">f</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span> <span class="c1">// if input is vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">itImg</span> <span class="o">-</span> <span class="n">images</span><span class="p">.</span><span class="n">begin</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// return the position in ms
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="nf">getPositionMS</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// undefined for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mf">0.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">double</span> <span class="n">t</span> <span class="o">=</span> <span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_POS_MSEC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// return the frame rate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="nf">getFrameRate</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// undefined for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">double</span> <span class="n">r</span> <span class="o">=</span> <span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_FPS</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// return the number of frames in video
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">long</span> <span class="nf">getTotalFrameCount</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="kt">long</span> <span class="n">t</span> <span class="o">=</span> <span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_FRAME_COUNT</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// get the codec of input video
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="nf">getCodec</span><span class="p">(</span><span class="kt">char</span> <span class="n">codec</span><span class="p">[</span><span class="mi">4</span><span class="p">])</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// undefined for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">union</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="kt">int</span> <span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="kt">char</span> <span class="n">code</span><span class="p">[</span><span class="mi">4</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span> <span class="n">returned</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">returned</span><span class="p">.</span><span class="n">value</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">capture</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_FOURCC</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">codec</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">returned</span><span class="p">.</span><span class="n">code</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">codec</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">returned</span><span class="p">.</span><span class="n">code</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">codec</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">returned</span><span class="p">.</span><span class="n">code</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">		<span class="n">codec</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">returned</span><span class="p">.</span><span class="n">code</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">returned</span><span class="p">.</span><span class="n">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// go to this frame number
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setFrameNumber</span><span class="p">(</span><span class="kt">long</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// move to position in vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">itImg</span> <span class="o">=</span> <span class="n">images</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">pos</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// is it a valid position?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">pos</span> <span class="o">&lt;</span> <span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span> <span class="c1">// if input is a capture device
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_POS_FRAMES</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// go to this position
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setPositionMS</span><span class="p">(</span><span class="kt">double</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// not defined in vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_POS_MSEC</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// go to this position expressed in fraction of total film length
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">setRelativePosition</span><span class="p">(</span><span class="kt">double</span> <span class="n">pos</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// for vector of images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// move to position in vector
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="kt">long</span> <span class="n">posI</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">long</span><span class="o">&gt;</span><span class="p">(</span><span class="n">pos</span><span class="o">*</span><span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">itImg</span> <span class="o">=</span> <span class="n">images</span><span class="p">.</span><span class="n">begin</span><span class="p">()</span> <span class="o">+</span> <span class="n">posI</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// is it a valid position?
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">posI</span> <span class="o">&lt;</span> <span class="n">images</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span>
</span></span><span class="line"><span class="cl">				<span class="k">return</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> <span class="p">{</span> <span class="c1">// if input is a capture device
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">set</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">CAP_PROP_POS_AVI_RATIO</span><span class="p">,</span> <span class="n">pos</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//结束处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">stopIt</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">stop</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 处理过程是否已经停止？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">isStopped</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">stop</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 捕获设备是否已经打开？
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">isOpened</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">capture</span><span class="p">.</span><span class="n">isOpened</span><span class="p">()</span> <span class="o">||</span> <span class="o">!</span><span class="n">images</span><span class="p">.</span><span class="n">empty</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 抓取并处理序列中的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">run</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//当前帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//输出帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">output</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">//如果没有设置捕获设备
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">isOpened</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">stop</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">isStopped</span><span class="p">())</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 读取下一帧（如果有）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">readNextFrame</span><span class="p">(</span><span class="n">frame</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">				<span class="k">break</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 显示输入的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">windowNameInput</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="n">windowNameInput</span><span class="p">,</span> <span class="n">frame</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 调用处理函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">callIt</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">				<span class="c1">// 处理帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="k">if</span> <span class="p">(</span><span class="n">process</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">frameProcessor</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">					<span class="n">frameProcessor</span><span class="o">-&gt;</span><span class="n">process</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">				<span class="c1">// 递增帧数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">fnumber</span><span class="o">++</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">			<span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//没有处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">output</span> <span class="o">=</span> <span class="n">frame</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 写入输出序列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">outputFile</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">writeNextFrame</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 显示输出的帧
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">windowNameOutput</span><span class="p">.</span><span class="n">length</span><span class="p">()</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">cv</span><span class="o">::</span><span class="n">imshow</span><span class="p">(</span><span class="n">windowNameOutput</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 产生延迟
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">delay</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">stopIt</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 检查是否需要结束
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">frameToStop</span> <span class="o">&gt;=</span> <span class="mi">0</span> <span class="o">&amp;&amp;</span> <span class="n">getFrameNumber</span><span class="p">()</span> <span class="o">==</span> <span class="n">frameToStop</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">				<span class="n">stopIt</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined VPROCESSOR
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined BGFGSeg
</span></span></span><span class="line"><span class="cl"><span class="cp">#define BGFGSeg
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/highgui/highgui.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;videoprocessor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">BGFGSegmentor</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FrameProcessor</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">gray</span><span class="p">;</span>			<span class="c1">// 当前灰度图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">background</span><span class="p">;</span>		<span class="c1">// 累积的背景
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">backImage</span><span class="p">;</span>		<span class="c1">// 当前背景图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="n">foreground</span><span class="p">;</span>		<span class="c1">// 前景图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">learningRate</span><span class="p">;</span>    <span class="c1">// 累积背景时使用的学习效率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">threshold</span><span class="p">;</span>			<span class="c1">// 提取前景的阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">BGFGSegmentor</span><span class="p">()</span> <span class="o">:</span> <span class="n">threshold</span><span class="p">(</span><span class="mi">10</span><span class="p">),</span> <span class="n">learningRate</span><span class="p">(</span><span class="mf">0.01</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the threshold used to declare a foreground
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setThreshold</span><span class="p">(</span><span class="kt">int</span> <span class="n">t</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">threshold</span> <span class="o">=</span> <span class="n">t</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// Set the learning rate
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setLearningRate</span><span class="p">(</span><span class="kt">double</span> <span class="n">r</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">learningRate</span> <span class="o">=</span> <span class="n">r</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 处理方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 转换为灰度图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">COLOR_BGR2GRAY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 采用第一针初始化背景
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">background</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="n">gray</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">background</span><span class="p">,</span> <span class="n">CV_32F</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 将背景转化为 8U类型
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">background</span><span class="p">.</span><span class="n">convertTo</span><span class="p">(</span><span class="n">backImage</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 计算图像与背景之间的差异
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">absdiff</span><span class="p">(</span><span class="n">backImage</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">foreground</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 在前景图像上应用
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">threshold</span><span class="p">(</span><span class="n">foreground</span><span class="p">,</span> <span class="n">output</span><span class="p">,</span> <span class="n">threshold</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="n">cv</span><span class="o">::</span><span class="n">THRESH_BINARY_INV</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 积累背景
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cv</span><span class="o">::</span><span class="n">accumulateWeighted</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span> <span class="n">background</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// alpha*gray + (1-alpha)*background
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">learningRate</span><span class="p">,</span>  <span class="c1">// 学习速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">output</span><span class="p">);</span>       <span class="c1">// 掩码
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_13-----跟踪运动物体">Chapter_13  :   跟踪运动物体</h3>
<blockquote>
<p>1.跟踪视频中的特征点
2.估算光流
3.跟踪视频中的物体</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;FeatureTracker.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;VideoProcessor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;VisualTracker.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="c1">//绘制光流向量图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">drawOpticalFlow</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span><span class="o">&amp;</span> <span class="n">oflow</span><span class="p">,</span> <span class="c1">//光流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                 <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">flowImage</span><span class="p">,</span>   <span class="c1">//绘制的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                 <span class="kt">int</span>  <span class="n">stride</span><span class="p">,</span>      <span class="c1">//显示向量的步长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                 <span class="kt">float</span> <span class="n">scale</span><span class="p">,</span>      <span class="c1">//放大因子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                 <span class="k">const</span> <span class="n">Scalar</span><span class="o">&amp;</span> <span class="n">color</span><span class="p">)</span>  <span class="c1">//显示向量的颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//必要时创建图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">if</span> <span class="p">(</span><span class="n">flowImage</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">!=</span> <span class="n">oflow</span><span class="p">.</span><span class="n">size</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="n">flowImage</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">oflow</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8UC3</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">flowImage</span> <span class="o">=</span> <span class="n">Vec3i</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//对所有向量， 以stride作为步长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">y</span> <span class="o">&lt;</span> <span class="n">oflow</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span> <span class="n">y</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">x</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">x</span> <span class="o">&lt;</span> <span class="n">oflow</span><span class="p">.</span><span class="n">cols</span><span class="p">;</span> <span class="n">x</span> <span class="o">+=</span> <span class="n">stride</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 获取向量	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">Point2f</span> <span class="n">vector</span> <span class="o">=</span> <span class="n">oflow</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span> <span class="n">Point2f</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">x</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 画线条
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">line</span><span class="p">(</span><span class="n">flowImage</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="n">Point</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">vector</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">					<span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">vector</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)),</span> <span class="n">color</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 画顶端圆圈	
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">circle</span><span class="p">(</span><span class="n">flowImage</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">vector</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">				<span class="k">static_cast</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span><span class="p">(</span><span class="n">y</span> <span class="o">+</span> <span class="n">scale</span><span class="o">*</span><span class="n">vector</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="mf">0.5</span><span class="p">)),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">   <span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="c1">////1.跟踪视频中的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////创建视频处理类的实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//VideoProcessor processor;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////创建特征跟踪类的实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//FeatureTracker tracker;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setInput(&#34;./images/bike.avi&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////设置帧处理类
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setFrameProcessor(&amp;tracker);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////声明显示视频的窗口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.displayOutput(&#34;Tracked Feature&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////以原始帧速率播放视频
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.setDelay(1000. / processor.getFrameRate());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//processor.stopAtFrameNo(90);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////开始处理
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//processor.run();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//waitKey();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////2.估算光流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat frame1 = imread(&#34;./images/goose/goose230.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat frame2 = imread(&#34;./images/goose/goose237.bmp&#34;, 0);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;frame1&#34;, frame1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;frame2&#34;, frame2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Combined display
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat combined(frame1.rows, frame1.cols + frame2.cols, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//frame1.copyTo(combined.colRange(0, frame1.cols));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//frame2.copyTo(combined.colRange(frame1.cols, frame1.cols + frame2.cols));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Frames&#34;, combined);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// 创建光流算法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Ptr&lt;DualTVL1OpticalFlow&gt; tvl1 = createOptFlow_DualTVL1();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cout &lt;&lt; &#34;regularization coeeficient: &#34; &lt;&lt; tvl1-&gt;getLambda() &lt;&lt; endl; // the smaller the soomther
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;Number of scales: &#34; &lt;&lt; tvl1-&gt;getScalesNumber() &lt;&lt; endl; // number of scales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;Scale step: &#34; &lt;&lt; tvl1-&gt;getScaleStep() &lt;&lt; endl; // size between scales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;Number of warpings: &#34; &lt;&lt; tvl1-&gt;getWarpingsNumber() &lt;&lt; endl; // size between scales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cout &lt;&lt; &#34;Stopping criteria: &#34; &lt;&lt; tvl1-&gt;getEpsilon() &lt;&lt; &#34; and &#34; &lt;&lt; tvl1-&gt;getOuterIterations() &lt;&lt; endl; // size between scales
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//														// compute the optical flow between 2 frames
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat oflow; // 二维光流向量的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// 计算frame1和frame2之间的光流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//tvl1-&gt;calc(frame1, frame2, oflow);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// 绘制光流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat flowImage;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//drawOpticalFlow(oflow,     // 输入光流向量 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	flowImage, // 生成的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	8,         // 每隔8个像素显示一个向量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	2,         // 长度延长2倍
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Scalar(0, 0, 0)); // 向量颜色
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Optical Flow&#34;, flowImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// 计算两个帧之间更加光滑的光流
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//tvl1-&gt;setLambda(0.075);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//tvl1-&gt;calc(frame1, frame2, oflow);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Draw the optical flow image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat flowImage2;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//drawOpticalFlow(oflow,     // input flow vectors 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	flowImage2, // image to be generated
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	8,         // display vectors every 8 pixels
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	2,         // multiply size of vectors by 2
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	Scalar(0, 0, 0)); // vector color
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Smoother Optical Flow&#34;, flowImage2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span> <span class="c1">//   waitKey();
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   
</span></span><span class="line"><span class="cl">	<span class="c1">//3.跟踪视频中的物体
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">// 创建视频处理器实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VideoProcessor</span> <span class="n">processor</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 生成文件名
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="n">std</span><span class="o">::</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">imgs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;images/goose/goose&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">std</span><span class="o">::</span><span class="n">string</span> <span class="n">ext</span> <span class="o">=</span> <span class="s">&#34;.bmp&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 添加用于跟踪的图像名称
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">130</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">317</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="n">prefix</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">ostringstream</span> <span class="n">ss</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">name</span> <span class="o">+=</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">		<span class="n">name</span> <span class="o">+=</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">name</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">imgs</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">name</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 创建特征提取器实例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">TrackerMedianFlow</span><span class="o">&gt;</span> <span class="n">ptr</span> <span class="o">=</span> <span class="n">TrackerMedianFlow</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	<span class="n">VisualTracker</span> <span class="n">tracker</span><span class="p">(</span><span class="n">ptr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="c1">// VisualTracker tracker(TrackerKCF::createTracker());
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 打开视频文件
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">processor</span><span class="p">.</span><span class="n">setInput</span><span class="p">(</span><span class="n">imgs</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 设置帧处理器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">processor</span><span class="p">.</span><span class="n">setFrameProcessor</span><span class="p">(</span><span class="o">&amp;</span><span class="n">tracker</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 声明显示视频的窗口
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">processor</span><span class="p">.</span><span class="n">displayOutput</span><span class="p">(</span><span class="s">&#34;Tracked object&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 定义显示的帧速率
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">processor</span><span class="p">.</span><span class="n">setDelay</span><span class="p">(</span><span class="mi">50</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 指定初始目标位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">cv</span><span class="o">::</span><span class="n">Rect</span> <span class="n">bb</span><span class="p">(</span><span class="mi">290</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">65</span><span class="p">,</span> <span class="mi">40</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">tracker</span><span class="p">.</span><span class="n">setBoundingBox</span><span class="p">(</span><span class="n">bb</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 开始跟踪
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">processor</span><span class="p">.</span><span class="n">run</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">cv</span><span class="o">::</span><span class="n">waitKey</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 中值流量跟踪算法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image1</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/goose/goose130.bmp&#34;</span><span class="p">,</span> <span class="n">ImreadModes</span><span class="o">::</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 定义一个10 * 10 的网格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">grid</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">10</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="n">Point2f</span> <span class="n">p</span><span class="p">(</span><span class="n">bb</span><span class="p">.</span><span class="n">x</span> <span class="o">+</span> <span class="n">i</span><span class="o">*</span><span class="n">bb</span><span class="p">.</span><span class="n">width</span> <span class="o">/</span> <span class="mf">10.</span><span class="p">,</span> <span class="n">bb</span><span class="p">.</span><span class="n">y</span> <span class="o">+</span> <span class="n">j</span><span class="o">*</span><span class="n">bb</span><span class="p">.</span><span class="n">height</span> <span class="o">/</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">grid</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">p</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// track in next image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">image2</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/goose/goose131.bmp&#34;</span><span class="p">,</span> <span class="n">ImreadModes</span><span class="o">::</span><span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">newPoints</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="n">status</span><span class="p">;</span> <span class="c1">// status of tracked features
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">err</span><span class="p">;</span>    <span class="c1">// error in tracking
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">							   <span class="c1">// track the points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">calcOpticalFlowPyrLK</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">image2</span><span class="p">,</span> <span class="c1">// 2 consecutive images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">grid</span><span class="p">,</span>      <span class="c1">// input point position in first image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">newPoints</span><span class="p">,</span> <span class="c1">// output point postion in the second image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">status</span><span class="p">,</span>    <span class="c1">// tracking success
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">err</span><span class="p">);</span>      <span class="c1">// tracking error
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">				   <span class="c1">// Draw the points
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="n">Point2f</span> <span class="nl">p</span> <span class="p">:</span> <span class="n">grid</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	   <span class="n">circle</span><span class="p">(</span><span class="n">image1</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Initial points&#34;</span><span class="p">,</span> <span class="n">image1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="n">Point2f</span> <span class="nl">p</span> <span class="p">:</span> <span class="n">newPoints</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">circle</span><span class="p">(</span><span class="n">image2</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Tracked points&#34;</span><span class="p">,</span> <span class="n">image2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined FTRACKER
</span></span></span><span class="line"><span class="cl"><span class="cp">#define FTRACKER
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;string&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;vector&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;VideoProcessor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">FeatureTracker</span> <span class="o">:</span><span class="k">public</span> <span class="n">FrameProcessor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//当前的灰度图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">gray</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//上一个灰度图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">Mat</span> <span class="n">gray_prev</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//被跟踪的特征，从0到1
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">points</span><span class="p">[</span><span class="mi">2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//被跟踪特征点的初始位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">initial</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//被监测的特征
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">Point2f</span><span class="o">&gt;</span> <span class="n">features</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//检测特征点的最大个数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">int</span> <span class="n">max_count</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//检测特征点的质量等级
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">qlevel</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//两个特征点之间的最小差距
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">double</span> <span class="n">minDist</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//被跟踪特征的状态
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span> <span class="n">status</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//跟踪中出现的误差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">err</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">FeatureTracker</span><span class="p">()</span><span class="o">:</span><span class="n">max_count</span><span class="p">(</span><span class="mi">500</span><span class="p">),</span> <span class="n">qlevel</span><span class="p">(</span><span class="mf">0.01</span><span class="p">),</span> <span class="n">minDist</span><span class="p">(</span><span class="mf">10.</span><span class="p">){}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//处理方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//装换成灰度图
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">cvtColor</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">CV_BGR2GRAY</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">frame</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//1.如果必须添加新的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">addNewPoints</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//检测特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">detectFeaturePoints</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//在当前跟踪列表中添加检测的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">insert</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">end</span><span class="p">(),</span> <span class="n">features</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">features</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">			<span class="n">initial</span><span class="p">.</span><span class="n">insert</span><span class="p">(</span><span class="n">initial</span><span class="p">.</span><span class="n">end</span><span class="p">(),</span> <span class="n">features</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">features</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//对于序列中的第一幅图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">if</span> <span class="p">(</span><span class="n">gray_prev</span><span class="p">.</span><span class="n">empty</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">			<span class="n">gray</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">gray_prev</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//2.跟踪特征
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">calcOpticalFlowPyrLK</span><span class="p">(</span><span class="n">gray_prev</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="c1">//两个连续图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>       <span class="c1">//输入第一幅图像的特征点位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>       <span class="c1">//输入第二幅图像的特征点位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">status</span><span class="p">,</span>          <span class="c1">//跟踪成功
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">err</span><span class="p">);</span>              <span class="c1">//跟踪误差
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="c1">//3.循环检查被跟踪的特征点，剔除部分特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">int</span> <span class="n">k</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//是否保留这个特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="k">if</span> <span class="p">(</span><span class="n">acceptTrackedPoint</span><span class="p">(</span><span class="n">i</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">			<span class="p">{</span>
</span></span><span class="line"><span class="cl">				<span class="c1">//在向量中保留这个特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>				<span class="n">initial</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">initial</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">				<span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">k</span><span class="o">++</span><span class="p">]</span> <span class="o">=</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">			<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//删除跟踪失败的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">resize</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">initial</span><span class="p">.</span><span class="n">resize</span><span class="p">(</span><span class="n">k</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//4.处理已经认可的被跟踪特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">handleTrackedPoints</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//5.让当前特征点和图像变成前一个
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">swap</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">		<span class="n">swap</span><span class="p">(</span><span class="n">gray_prev</span><span class="p">,</span> <span class="n">gray</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//特征点检测方法
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">detectFeaturePoints</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//检测特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">goodFeaturesToTrack</span><span class="p">(</span><span class="n">gray</span><span class="p">,</span>  <span class="c1">//图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">features</span><span class="p">,</span>  <span class="c1">//输出检测到的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">max_count</span><span class="p">,</span> <span class="c1">//特征点的最大数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">qlevel</span><span class="p">,</span>    <span class="c1">//质量等级
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">minDist</span><span class="p">);</span>   <span class="c1">//特征点之间的最小差距
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//判断是否需要添加新的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">addNewPoints</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//如果特征点数量太少
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">return</span> <span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mi">10</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//判断需要保留的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">bool</span> <span class="nf">acceptTrackedPoint</span><span class="p">(</span><span class="kt">int</span> <span class="n">i</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">return</span> <span class="n">status</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&amp;&amp;</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//如果特征点已将移动
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">x</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">x</span><span class="p">)</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">			<span class="p">(</span><span class="n">abs</span><span class="p">(</span><span class="n">points</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">y</span> <span class="o">-</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">].</span><span class="n">y</span><span class="p">))</span> <span class="o">&gt;</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//处理当前跟踪的特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">handleTrackedPoints</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">//遍历所有特征点
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">//画线和圆
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">line</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">initial</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">circle</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">points</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="n">i</span><span class="p">],</span> <span class="mi">3</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>		
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined FTRACKER
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#pragma once
</span></span></span><span class="line"><span class="cl"><span class="cp">#if !defined VTRACKER
</span></span></span><span class="line"><span class="cl"><span class="cp">#define VTRACKER
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/opencv.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/tracking/tracker.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&#34;VideoProcessor.h&#34;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">class</span> <span class="nc">VisualTracker</span> <span class="o">:</span> <span class="k">public</span> <span class="n">FrameProcessor</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl"><span class="k">private</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Tracker</span><span class="o">&gt;</span> <span class="n">tracker</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">Rect2d</span> <span class="n">box</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">bool</span> <span class="n">reset</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">public</span><span class="o">:</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//构造函数指定选用的跟踪器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">VisualTracker</span><span class="p">(</span><span class="n">Ptr</span><span class="o">&lt;</span><span class="n">Tracker</span><span class="o">&gt;</span> <span class="n">tracker</span><span class="p">)</span> <span class="o">:</span><span class="n">reset</span><span class="p">(</span><span class="nb">true</span><span class="p">),</span> <span class="n">tracker</span><span class="p">(</span><span class="n">tracker</span><span class="p">)</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">	
</span></span><span class="line"><span class="cl">	<span class="c1">//设置矩形，以启动跟踪过程
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">setBoundingBox</span><span class="p">(</span><span class="k">const</span> <span class="n">Rect2d</span><span class="o">&amp;</span> <span class="n">bb</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">box</span> <span class="o">=</span> <span class="n">bb</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">reset</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="c1">//回调函数
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="kt">void</span> <span class="nf">process</span><span class="p">(</span><span class="n">Mat</span> <span class="o">&amp;</span><span class="n">frame</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">output</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">if</span> <span class="p">(</span><span class="n">reset</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		<span class="p">{</span> 
</span></span><span class="line"><span class="cl">			<span class="c1">// 新跟踪会话
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">reset</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="n">tracker</span><span class="o">-&gt;</span><span class="n">init</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">		<span class="k">else</span> 
</span></span><span class="line"><span class="cl">		<span class="p">{</span> 
</span></span><span class="line"><span class="cl">			<span class="c1">// 更新目标位置
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">tracker</span><span class="o">-&gt;</span><span class="n">update</span><span class="p">(</span><span class="n">frame</span><span class="p">,</span> <span class="n">box</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 在当前帧中绘制矩形
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="n">frame</span><span class="p">.</span><span class="n">copyTo</span><span class="p">(</span><span class="n">output</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="n">rectangle</span><span class="p">(</span><span class="n">output</span><span class="p">,</span> <span class="n">box</span><span class="p">,</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="cp">#endif </span><span class="c1">// !defined VTRACKER
</span></span></span></code></pre></td></tr></table>
</div>
</div><h3 id="chapter_14------实用案列">Chapter_14  :    实用案列</h3>
<blockquote>
<p>1.用最邻近局部二值模式实现人脸识别
2.通过级联Haar特征实现物体和人脸定位
3.用支持向量机和方向梯度直方图实现物体与行人检测</p>
</blockquote>
<!--more-->
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span><span class="lnt">121
</span><span class="lnt">122
</span><span class="lnt">123
</span><span class="lnt">124
</span><span class="lnt">125
</span><span class="lnt">126
</span><span class="lnt">127
</span><span class="lnt">128
</span><span class="lnt">129
</span><span class="lnt">130
</span><span class="lnt">131
</span><span class="lnt">132
</span><span class="lnt">133
</span><span class="lnt">134
</span><span class="lnt">135
</span><span class="lnt">136
</span><span class="lnt">137
</span><span class="lnt">138
</span><span class="lnt">139
</span><span class="lnt">140
</span><span class="lnt">141
</span><span class="lnt">142
</span><span class="lnt">143
</span><span class="lnt">144
</span><span class="lnt">145
</span><span class="lnt">146
</span><span class="lnt">147
</span><span class="lnt">148
</span><span class="lnt">149
</span><span class="lnt">150
</span><span class="lnt">151
</span><span class="lnt">152
</span><span class="lnt">153
</span><span class="lnt">154
</span><span class="lnt">155
</span><span class="lnt">156
</span><span class="lnt">157
</span><span class="lnt">158
</span><span class="lnt">159
</span><span class="lnt">160
</span><span class="lnt">161
</span><span class="lnt">162
</span><span class="lnt">163
</span><span class="lnt">164
</span><span class="lnt">165
</span><span class="lnt">166
</span><span class="lnt">167
</span><span class="lnt">168
</span><span class="lnt">169
</span><span class="lnt">170
</span><span class="lnt">171
</span><span class="lnt">172
</span><span class="lnt">173
</span><span class="lnt">174
</span><span class="lnt">175
</span><span class="lnt">176
</span><span class="lnt">177
</span><span class="lnt">178
</span><span class="lnt">179
</span><span class="lnt">180
</span><span class="lnt">181
</span><span class="lnt">182
</span><span class="lnt">183
</span><span class="lnt">184
</span><span class="lnt">185
</span><span class="lnt">186
</span><span class="lnt">187
</span><span class="lnt">188
</span><span class="lnt">189
</span><span class="lnt">190
</span><span class="lnt">191
</span><span class="lnt">192
</span><span class="lnt">193
</span><span class="lnt">194
</span><span class="lnt">195
</span><span class="lnt">196
</span><span class="lnt">197
</span><span class="lnt">198
</span><span class="lnt">199
</span><span class="lnt">200
</span><span class="lnt">201
</span><span class="lnt">202
</span><span class="lnt">203
</span><span class="lnt">204
</span><span class="lnt">205
</span><span class="lnt">206
</span><span class="lnt">207
</span><span class="lnt">208
</span><span class="lnt">209
</span><span class="lnt">210
</span><span class="lnt">211
</span><span class="lnt">212
</span><span class="lnt">213
</span><span class="lnt">214
</span><span class="lnt">215
</span><span class="lnt">216
</span><span class="lnt">217
</span><span class="lnt">218
</span><span class="lnt">219
</span><span class="lnt">220
</span><span class="lnt">221
</span><span class="lnt">222
</span><span class="lnt">223
</span><span class="lnt">224
</span><span class="lnt">225
</span><span class="lnt">226
</span><span class="lnt">227
</span><span class="lnt">228
</span><span class="lnt">229
</span><span class="lnt">230
</span><span class="lnt">231
</span><span class="lnt">232
</span><span class="lnt">233
</span><span class="lnt">234
</span><span class="lnt">235
</span><span class="lnt">236
</span><span class="lnt">237
</span><span class="lnt">238
</span><span class="lnt">239
</span><span class="lnt">240
</span><span class="lnt">241
</span><span class="lnt">242
</span><span class="lnt">243
</span><span class="lnt">244
</span><span class="lnt">245
</span><span class="lnt">246
</span><span class="lnt">247
</span><span class="lnt">248
</span><span class="lnt">249
</span><span class="lnt">250
</span><span class="lnt">251
</span><span class="lnt">252
</span><span class="lnt">253
</span><span class="lnt">254
</span><span class="lnt">255
</span><span class="lnt">256
</span><span class="lnt">257
</span><span class="lnt">258
</span><span class="lnt">259
</span><span class="lnt">260
</span><span class="lnt">261
</span><span class="lnt">262
</span><span class="lnt">263
</span><span class="lnt">264
</span><span class="lnt">265
</span><span class="lnt">266
</span><span class="lnt">267
</span><span class="lnt">268
</span><span class="lnt">269
</span><span class="lnt">270
</span><span class="lnt">271
</span><span class="lnt">272
</span><span class="lnt">273
</span><span class="lnt">274
</span><span class="lnt">275
</span><span class="lnt">276
</span><span class="lnt">277
</span><span class="lnt">278
</span><span class="lnt">279
</span><span class="lnt">280
</span><span class="lnt">281
</span><span class="lnt">282
</span><span class="lnt">283
</span><span class="lnt">284
</span><span class="lnt">285
</span><span class="lnt">286
</span><span class="lnt">287
</span><span class="lnt">288
</span><span class="lnt">289
</span><span class="lnt">290
</span><span class="lnt">291
</span><span class="lnt">292
</span><span class="lnt">293
</span><span class="lnt">294
</span><span class="lnt">295
</span><span class="lnt">296
</span><span class="lnt">297
</span><span class="lnt">298
</span><span class="lnt">299
</span><span class="lnt">300
</span><span class="lnt">301
</span><span class="lnt">302
</span><span class="lnt">303
</span><span class="lnt">304
</span><span class="lnt">305
</span><span class="lnt">306
</span><span class="lnt">307
</span><span class="lnt">308
</span><span class="lnt">309
</span><span class="lnt">310
</span><span class="lnt">311
</span><span class="lnt">312
</span><span class="lnt">313
</span><span class="lnt">314
</span><span class="lnt">315
</span><span class="lnt">316
</span><span class="lnt">317
</span><span class="lnt">318
</span><span class="lnt">319
</span><span class="lnt">320
</span><span class="lnt">321
</span><span class="lnt">322
</span><span class="lnt">323
</span><span class="lnt">324
</span><span class="lnt">325
</span><span class="lnt">326
</span><span class="lnt">327
</span><span class="lnt">328
</span><span class="lnt">329
</span><span class="lnt">330
</span><span class="lnt">331
</span><span class="lnt">332
</span><span class="lnt">333
</span><span class="lnt">334
</span><span class="lnt">335
</span><span class="lnt">336
</span><span class="lnt">337
</span><span class="lnt">338
</span><span class="lnt">339
</span><span class="lnt">340
</span><span class="lnt">341
</span><span class="lnt">342
</span><span class="lnt">343
</span><span class="lnt">344
</span><span class="lnt">345
</span><span class="lnt">346
</span><span class="lnt">347
</span><span class="lnt">348
</span><span class="lnt">349
</span><span class="lnt">350
</span><span class="lnt">351
</span><span class="lnt">352
</span><span class="lnt">353
</span><span class="lnt">354
</span><span class="lnt">355
</span><span class="lnt">356
</span><span class="lnt">357
</span><span class="lnt">358
</span><span class="lnt">359
</span><span class="lnt">360
</span><span class="lnt">361
</span><span class="lnt">362
</span><span class="lnt">363
</span><span class="lnt">364
</span><span class="lnt">365
</span><span class="lnt">366
</span><span class="lnt">367
</span><span class="lnt">368
</span><span class="lnt">369
</span><span class="lnt">370
</span><span class="lnt">371
</span><span class="lnt">372
</span><span class="lnt">373
</span><span class="lnt">374
</span><span class="lnt">375
</span><span class="lnt">376
</span><span class="lnt">377
</span><span class="lnt">378
</span><span class="lnt">379
</span><span class="lnt">380
</span><span class="lnt">381
</span><span class="lnt">382
</span><span class="lnt">383
</span><span class="lnt">384
</span><span class="lnt">385
</span><span class="lnt">386
</span><span class="lnt">387
</span><span class="lnt">388
</span><span class="lnt">389
</span><span class="lnt">390
</span><span class="lnt">391
</span><span class="lnt">392
</span><span class="lnt">393
</span><span class="lnt">394
</span><span class="lnt">395
</span><span class="lnt">396
</span><span class="lnt">397
</span><span class="lnt">398
</span><span class="lnt">399
</span><span class="lnt">400
</span><span class="lnt">401
</span><span class="lnt">402
</span><span class="lnt">403
</span><span class="lnt">404
</span><span class="lnt">405
</span><span class="lnt">406
</span><span class="lnt">407
</span><span class="lnt">408
</span><span class="lnt">409
</span><span class="lnt">410
</span><span class="lnt">411
</span><span class="lnt">412
</span><span class="lnt">413
</span><span class="lnt">414
</span><span class="lnt">415
</span><span class="lnt">416
</span><span class="lnt">417
</span><span class="lnt">418
</span><span class="lnt">419
</span><span class="lnt">420
</span><span class="lnt">421
</span><span class="lnt">422
</span><span class="lnt">423
</span><span class="lnt">424
</span><span class="lnt">425
</span><span class="lnt">426
</span><span class="lnt">427
</span><span class="lnt">428
</span><span class="lnt">429
</span><span class="lnt">430
</span><span class="lnt">431
</span><span class="lnt">432
</span><span class="lnt">433
</span><span class="lnt">434
</span><span class="lnt">435
</span><span class="lnt">436
</span><span class="lnt">437
</span><span class="lnt">438
</span><span class="lnt">439
</span><span class="lnt">440
</span><span class="lnt">441
</span><span class="lnt">442
</span><span class="lnt">443
</span><span class="lnt">444
</span><span class="lnt">445
</span><span class="lnt">446
</span><span class="lnt">447
</span><span class="lnt">448
</span><span class="lnt">449
</span><span class="lnt">450
</span><span class="lnt">451
</span><span class="lnt">452
</span><span class="lnt">453
</span><span class="lnt">454
</span><span class="lnt">455
</span><span class="lnt">456
</span><span class="lnt">457
</span><span class="lnt">458
</span><span class="lnt">459
</span><span class="lnt">460
</span><span class="lnt">461
</span><span class="lnt">462
</span><span class="lnt">463
</span><span class="lnt">464
</span><span class="lnt">465
</span><span class="lnt">466
</span><span class="lnt">467
</span><span class="lnt">468
</span><span class="lnt">469
</span><span class="lnt">470
</span><span class="lnt">471
</span><span class="lnt">472
</span><span class="lnt">473
</span><span class="lnt">474
</span><span class="lnt">475
</span><span class="lnt">476
</span><span class="lnt">477
</span><span class="lnt">478
</span><span class="lnt">479
</span><span class="lnt">480
</span><span class="lnt">481
</span><span class="lnt">482
</span><span class="lnt">483
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-c++" data-lang="c++"><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iostream&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/core.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/highgui.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/imgproc.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/face.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;iomanip&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/objdetect.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp">#include</span> <span class="cpf">&lt;opencv2/ml.hpp&gt;</span><span class="cp">
</span></span></span><span class="line"><span class="cl"><span class="cp"></span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">std</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="k">using</span> <span class="k">namespace</span> <span class="n">cv</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//1.用最邻近局部二值模式实现人脸识别
</span></span></span><span class="line"><span class="cl"><span class="c1">//计算灰度图像的局部二值模式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">lbp</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">	<span class="n">assert</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">channels</span><span class="p">()</span> <span class="o">==</span> <span class="mi">1</span><span class="p">);</span> <span class="c1">// input image must be gray scale
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">CV_8U</span><span class="p">);</span> <span class="c1">// 必要时分配空间
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>										
</span></span><span class="line"><span class="cl">     <span class="c1">// 逐行处理，除了第一行和最后一行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 输入行的指针
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="k">const</span> <span class="n">uchar</span><span class="o">*</span> <span class="n">previous</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span> <span class="o">-</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">uchar</span><span class="o">*</span> <span class="n">current</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>	 
</span></span><span class="line"><span class="cl">		<span class="k">const</span> <span class="n">uchar</span><span class="o">*</span> <span class="n">next</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="mi">1</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">uchar</span><span class="o">*</span> <span class="n">output</span> <span class="o">=</span> <span class="n">result</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="n">uchar</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">);</span>	<span class="c1">// 输出行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="c1">// 构建局部二值模式
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="o">*</span><span class="n">output</span> <span class="o">=</span> <span class="n">previous</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">1</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">previous</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">2</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">previous</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">4</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">8</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">16</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">next</span><span class="p">[</span><span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">32</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">next</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">64</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">			<span class="o">*</span><span class="n">output</span> <span class="o">|=</span> <span class="n">next</span><span class="p">[</span><span class="n">i</span> <span class="o">+</span> <span class="mi">1</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">current</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">?</span> <span class="mi">128</span> <span class="o">:</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">			<span class="n">output</span><span class="o">++</span><span class="p">;</span> <span class="c1">// 下一个像素
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 未处理的设置为0
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">row</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">rows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">	<span class="n">result</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">cols</span> <span class="o">-</span> <span class="mi">1</span><span class="p">).</span><span class="n">setTo</span><span class="p">(</span><span class="n">Scalar</span><span class="p">(</span><span class="mi">0</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">//3.用支持向量机和方向梯度直方图实现物体与行人检测
</span></span></span><span class="line"><span class="cl"><span class="c1">// 画出一个单元格的HOG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">drawHOG</span><span class="p">(</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">hog</span><span class="p">,</span> <span class="c1">// HOG迭代器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	         <span class="kt">int</span> <span class="n">numberOfBins</span><span class="p">,</span>        <span class="c1">// HOG中的箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	         <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>              <span class="c1">// 单元格的图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	         <span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">)</span>       <span class="c1">// 长度缩放比例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>       
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">const</span> <span class="kt">float</span> <span class="n">PI</span> <span class="o">=</span> <span class="mf">3.1415927</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">binStep</span> <span class="o">=</span> <span class="n">PI</span> <span class="o">/</span> <span class="n">numberOfBins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">maxLength</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">cx</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">cy</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mf">2.</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 逐个箱子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">bin</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">bin</span> <span class="o">&lt;</span> <span class="n">numberOfBins</span><span class="p">;</span> <span class="n">bin</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 箱子方向
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">float</span> <span class="n">angle</span> <span class="o">=</span> <span class="n">bin</span><span class="o">*</span><span class="n">binStep</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">dirX</span> <span class="o">=</span> <span class="n">cos</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">dirY</span> <span class="o">=</span> <span class="n">sin</span><span class="p">(</span><span class="n">angle</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">		<span class="c1">// 线条长度， 与箱子大小成正比
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">float</span> <span class="n">length</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">maxLength</span><span class="o">*</span> <span class="o">*</span><span class="p">(</span><span class="n">hog</span> <span class="o">+</span> <span class="n">bin</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="c1">// 画线条
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		<span class="kt">float</span> <span class="n">x1</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">-</span> <span class="n">dirX</span> <span class="o">*</span> <span class="n">length</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">y1</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">-</span> <span class="n">dirY</span> <span class="o">*</span> <span class="n">length</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">cx</span> <span class="o">+</span> <span class="n">dirX</span> <span class="o">*</span> <span class="n">length</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="kt">float</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">cy</span> <span class="o">+</span> <span class="n">dirY</span> <span class="o">*</span> <span class="n">length</span> <span class="o">*</span> <span class="n">scale</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="n">line</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">Point</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">),</span> <span class="n">Point</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">y2</span><span class="p">),</span> <span class="n">CV_RGB</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// 在图像上绘制 HOG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kt">void</span> <span class="nf">drawHOGDescriptors</span><span class="p">(</span><span class="k">const</span> <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">image</span><span class="p">,</span>  <span class="c1">// 输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                    <span class="n">Mat</span> <span class="o">&amp;</span><span class="n">hogImage</span><span class="p">,</span>     <span class="c1">// 结果HOG图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                    <span class="n">Size</span> <span class="n">cellSize</span><span class="p">,</span>     <span class="c1">// 每个单元格的大小（忽略区块）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                    <span class="kt">int</span> <span class="n">nBins</span><span class="p">)</span>         <span class="c1">// 箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="p">{</span>                             
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">// 区块大小等于图像大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">HOGDescriptor</span> <span class="n">hog</span><span class="p">(</span><span class="n">Size</span><span class="p">(</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		              <span class="n">Size</span><span class="p">(</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">)</span> <span class="o">*</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">)</span> <span class="o">*</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">		              <span class="n">cellSize</span><span class="p">,</span>    <span class="c1">// 区块步长（这里只有一个区块）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		              <span class="n">cellSize</span><span class="p">,</span>    <span class="c1">// 单元格大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>		              <span class="n">nBins</span><span class="p">);</span>      <span class="c1">// 箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">// 计算 HOG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">descriptors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">	<span class="n">hog</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">descriptors</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="kt">float</span> <span class="n">scale</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="o">*</span> <span class="n">max_element</span><span class="p">(</span><span class="n">descriptors</span><span class="p">.</span><span class="n">begin</span><span class="p">(),</span> <span class="n">descriptors</span><span class="p">.</span><span class="n">end</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">hogImage</span><span class="p">.</span><span class="n">create</span><span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;::</span><span class="n">const_iterator</span> <span class="n">itDesc</span> <span class="o">=</span> <span class="n">descriptors</span><span class="p">.</span><span class="n">begin</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">		<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">			<span class="c1">// 画出每个单元格
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>			<span class="n">hogImage</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">,</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">			<span class="n">drawHOG</span><span class="p">(</span><span class="n">itDesc</span><span class="p">,</span> <span class="n">nBins</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">				    <span class="n">hogImage</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">,</span><span class="n">cellSize</span><span class="p">.</span><span class="n">width</span><span class="p">,</span> <span class="n">cellSize</span><span class="p">.</span><span class="n">height</span><span class="p">)),</span> <span class="n">scale</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">			<span class="n">itDesc</span> <span class="o">+=</span> <span class="n">nBins</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		<span class="p">}</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////1.用最邻近局部二值模式实现人脸识别
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat image = imread(&#34;./images/girl.jpg&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;Original image&#34;, image);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Mat lbpImage;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//lbp(image, lbpImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//imshow(&#34;LBP image&#34;, lbpImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//Ptr&lt;face::FaceRecognizer&gt; recognizer =  face::LBPHFaceRecognizer::create(1,   //LBP模式的半径
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	8,     //使用邻近像素的数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	8, 8,  //网格大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	200.); //最邻近的距离阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////参考图像和标签的向量 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;Mat&gt; referenceImages;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//vector&lt;int&gt; labels;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">////打开参考图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face0_1.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(0); // 编号为0的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face0_2.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(0); // 编号为0的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face0_2.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(0); // 编号为0的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face1_1.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(1); // 编号为1的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face1_2.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(1); // 编号为1的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(imread(&#34;./images/face1_2.png&#34;, IMREAD_GRAYSCALE));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//labels.push_back(1); // 编号为1的人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">///*Mat i1 = imread(&#34;./images/face0_1.png&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat i2 = imread(&#34;./images/face0_2.png&#34;, IMREAD_GRAYSCALE);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;i1&#34;, i1);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;i2&#34;, i2);*/
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// the 6 positive samples
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat faceImages(2 * referenceImages[0].rows, 3 * referenceImages[0].cols, CV_8U);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; 2; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (int j = 0; j &lt; 3; j++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		referenceImages[i * 2 + j].copyTo(faceImages(Rect(j*referenceImages[i * 2 + j].cols, i*referenceImages[i * 2 + j].rows, referenceImages[i * 2 + j].cols, referenceImages[i * 2 + j].rows)));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//resize(faceImages, faceImages, Size(), 0.5, 0.5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Reference faces&#34;, faceImages);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">////通过计算LBPH进行训练
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//recognizer-&gt;train(referenceImages, labels);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//int predictedLabel = -1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//double confidence = 0.0;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Extract a face image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//Mat inputImage;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//resize(image(Rect(160, 75, 90, 90)), inputImage, Size(256, 256));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//imshow(&#34;Input image&#34;, inputImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// 识别图像对应的编号
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//recognizer-&gt;predict(inputImage,     // 人脸图像 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	predictedLabel, // 识别结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	confidence);    // 置信度
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cout &lt;&lt; &#34;Image label= &#34; &lt;&lt; predictedLabel &lt;&lt; &#34; (&#34; &lt;&lt; confidence &lt;&lt; &#34;)&#34; &lt;&lt; endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">////2.通过级联Haar特征实现物体和人脸定位
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// open the positive sample images
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//std::vector&lt;cv::Mat&gt; referenceImages;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop00.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop01.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop02.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop03.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop04.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop05.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop06.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//referenceImages.push_back(cv::imread(&#34;./images/stopSamples/stop07.png&#34;));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// create a composite image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::Mat positveImages(2 * referenceImages[0].rows, 4 * referenceImages[0].cols, CV_8UC3);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; 2; i++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	for (int j = 0; j &lt; 4; j++) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//		referenceImages[i * 2 + j].copyTo(positveImages(cv::Rect(j*referenceImages[i * 2 + j].cols, i*referenceImages[i * 2 + j].rows, referenceImages[i * 2 + j].cols, referenceImages[i * 2 + j].rows)));
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::imshow(&#34;Positive samples&#34;, positveImages);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::Mat negative = cv::imread(&#34;./images/stopSamples/bg01.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::resize(negative, negative, cv::Size(), 0.33, 0.33);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::imshow(&#34;One negative sample&#34;, negative);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::Mat inputImage = cv::imread(&#34;./images/stopSamples/stop9.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::resize(inputImage, inputImage, cv::Size(), 0.5, 0.5);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::CascadeClassifier cascade;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!cascade.load(&#34;./images/stopSamples/classifier/cascade.xml&#34;)) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	std::cout &lt;&lt; &#34;Error when loading the cascade classfier!&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return -1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// predict the label of this image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//std::vector&lt;cv::Rect&gt; detections;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cascade.detectMultiScale(inputImage, // 输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	detections, // 检测结果
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	1.1,        // 缩小比例
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	1,          // 所需近邻数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	0,          // 标志位（不用）
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(48, 48),    // 检测对象的最小尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(128, 128)); // 检测对象的最大尺寸
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//std::cout &lt;&lt; &#34;detections= &#34; &lt;&lt; detections.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; detections.size(); i++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::rectangle(inputImage, detections[i], cv::Scalar(255, 255, 255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::imshow(&#34;Stop sign detection&#34;, inputImage);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Detecting faces
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::Mat picture = cv::imread(&#34;./images/girl.jpg&#34;);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::CascadeClassifier faceCascade;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!faceCascade.load(&#34;D:\\Project_OpenCV\\Cmake\\install\\etc\\haarcascades\\haarcascade_frontalface_default.xml&#34;)) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	std::cout &lt;&lt; &#34;Error when loading the face cascade classfier!&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return -1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//faceCascade.detectMultiScale(picture, // input image 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	detections, // detection results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	1.1,        // scale reduction factor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	3,          // number of required neighbor detections
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	0,          // flags (not used)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(48, 48),    // minimum object size to be detected
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(128, 128)); // maximum object size to be detected
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//std::cout &lt;&lt; &#34;detections= &#34; &lt;&lt; detections.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// draw detections on image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; detections.size(); i++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::rectangle(picture, detections[i], cv::Scalar(255, 255, 255), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//// Detecting eyes
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//cv::CascadeClassifier eyeCascade;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//if (!eyeCascade.load(&#34;D:\\Project_OpenCV\\Cmake\\install\\etc\\haarcascades\\haarcascade_eye.xml&#34;)) {
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	std::cout &lt;&lt; &#34;Error when loading the eye cascade classfier!&#34; &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	return -1;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//}
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//eyeCascade.detectMultiScale(picture, // input image 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	detections, // detection results
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	1.1,        // scale reduction factor
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	3,          // number of required neighbor detections
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	0,          // flags (not used)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(24, 24),    // minimum object size to be detected
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::Size(64, 64)); // maximum object size to be detected
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//std::cout &lt;&lt; &#34;detections= &#34; &lt;&lt; detections.size() &lt;&lt; std::endl;
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//// draw detections on image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//for (int i = 0; i &lt; detections.size(); i++)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	<span class="c1">//	cv::rectangle(picture, detections[i], cv::Scalar(0, 0, 0), 2);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">	<span class="c1">//cv::imshow(&#34;Detection results&#34;, picture);
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="c1">//3.用支持向量机和方向梯度直方图实现物体与行人检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Mat</span> <span class="n">image</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/girl.jpg&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Original image&#34;</span><span class="p">,</span> <span class="n">image</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">HOGDescriptor</span> <span class="n">hog</span><span class="p">(</span><span class="n">Size</span><span class="p">((</span><span class="n">image</span><span class="p">.</span><span class="n">cols</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">,</span> <span class="p">(</span><span class="n">image</span><span class="p">.</span><span class="n">rows</span> <span class="o">/</span> <span class="mi">16</span><span class="p">)</span> <span class="o">*</span> <span class="mi">16</span><span class="p">),</span> <span class="c1">// 窗口大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                  <span class="n">Size</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>    <span class="c1">// 区块大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                  <span class="n">Size</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span>    <span class="c1">// 区块步长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                  <span class="n">Size</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>      <span class="c1">// 单元格大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>                      <span class="mi">9</span><span class="p">);</span>              <span class="c1">// 箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">descriptors</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 调用 drawHOGDescriptors函数，在图像上绘制HOG
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Mat</span> <span class="n">hogImage</span> <span class="o">=</span> <span class="n">image</span><span class="p">.</span><span class="n">clone</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">drawHOGDescriptors</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">hogImage</span><span class="p">,</span> <span class="n">Size</span><span class="p">(</span><span class="mi">16</span><span class="p">,</span> <span class="mi">16</span><span class="p">),</span> <span class="mi">9</span><span class="p">);</span> 
</span></span><span class="line"><span class="cl">	<span class="n">imshow</span><span class="p">(</span><span class="s">&#34;HOG image&#34;</span><span class="p">,</span> <span class="n">hogImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// generate the filename
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="n">string</span><span class="o">&gt;</span> <span class="n">imgs</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">string</span> <span class="n">prefix</span> <span class="o">=</span> <span class="s">&#34;./images/stopSamples/stop&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">string</span> <span class="n">ext</span> <span class="o">=</span> <span class="s">&#34;.png&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// loading 8 positive samples
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">positives</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	     <span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="n">prefix</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	     <span class="n">ostringstream</span> <span class="n">ss</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">		 <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span> 
</span></span><span class="line"><span class="cl">		 <span class="n">name</span> <span class="o">+=</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	     <span class="n">name</span> <span class="o">+=</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	     <span class="n">positives</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// the first 8 positive samples
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Mat</span> <span class="n">posSamples</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">positives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">copyTo</span><span class="p">(</span><span class="n">posSamples</span><span class="p">(</span><span class="n">Rect</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">positives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">positives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">rows</span><span class="p">,</span> <span class="n">positives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">positives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">rows</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Positive samples&#34;</span><span class="p">,</span> <span class="n">posSamples</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// loading 8 negative samples
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">string</span> <span class="n">nprefix</span> <span class="o">=</span> <span class="s">&#34;./images/stopSamples/neg&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">vector</span><span class="o">&lt;</span><span class="n">Mat</span><span class="o">&gt;</span> <span class="n">negatives</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">long</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">8</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	     <span class="n">string</span> <span class="n">name</span><span class="p">(</span><span class="n">nprefix</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	     <span class="n">ostringstream</span> <span class="n">ss</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		 <span class="n">ss</span> <span class="o">&lt;&lt;</span> <span class="n">setfill</span><span class="p">(</span><span class="sc">&#39;0&#39;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">setw</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">		 <span class="n">name</span> <span class="o">+=</span> <span class="n">ss</span><span class="p">.</span><span class="n">str</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">	     <span class="n">name</span> <span class="o">+=</span> <span class="n">ext</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	     <span class="n">negatives</span><span class="p">.</span><span class="n">push_back</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// the first 8 negative samples
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Mat</span> <span class="n">negSamples</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">negatives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span><span class="p">,</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">negatives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">CV_8U</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">		<span class="n">negatives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">copyTo</span><span class="p">(</span><span class="n">negSamples</span><span class="p">(</span><span class="n">cv</span><span class="o">::</span><span class="n">Rect</span><span class="p">(</span><span class="n">j</span><span class="o">*</span><span class="n">negatives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="o">*</span><span class="n">negatives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">rows</span><span class="p">,</span> <span class="n">negatives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">cols</span><span class="p">,</span> <span class="n">negatives</span><span class="p">[</span><span class="n">i</span> <span class="o">*</span> <span class="mi">4</span> <span class="o">+</span> <span class="n">j</span><span class="p">].</span><span class="n">rows</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">	<span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;Negative samples&#34;</span><span class="p">,</span> <span class="n">negSamples</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// The HOG descriptor for stop sign detection
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">HOGDescriptor</span> <span class="n">hogDesc</span><span class="p">(</span><span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">size</span><span class="p">(),</span> <span class="c1">// 窗口大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                      <span class="n">Size</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">8</span><span class="p">),</span>    <span class="c1">// 区块大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                      <span class="n">Size</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>    <span class="c1">// 区块步长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                      <span class="n">Size</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>    <span class="c1">// 单元格大小
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                      <span class="mi">9</span><span class="p">);</span>            <span class="c1">//  箱子数量
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 计算第一个描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">vector</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span> <span class="n">desc</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Positive sample size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">rows</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;x&#34;</span> <span class="o">&lt;&lt;</span> <span class="n">positives</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="n">cols</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;HOG descriptor size: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">desc</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 样本描述子矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="kt">int</span> <span class="n">featureSize</span> <span class="o">=</span> <span class="n">desc</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="kt">int</span> <span class="n">numberOfSamples</span> <span class="o">=</span> <span class="n">positives</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">+</span> <span class="n">negatives</span><span class="p">.</span><span class="n">size</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建存储样本HOG的矩阵
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Mat</span> <span class="n">samples</span><span class="p">(</span><span class="n">numberOfSamples</span><span class="p">,</span> <span class="n">featureSize</span><span class="p">,</span> <span class="n">CV_32FC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 用第一个描述子填第一行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">samples</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 计算正样本的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">positives</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">	<span class="p">{</span>
</span></span><span class="line"><span class="cl">	   <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">positives</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	   <span class="c1">// 用当前描述子填下一行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="n">samples</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">     <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// 计算负样本的描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">j</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">negatives</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">	 <span class="p">{</span>
</span></span><span class="line"><span class="cl">	     <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">negatives</span><span class="p">[</span><span class="n">j</span><span class="p">],</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	     <span class="c1">// 用当前描述子填下一行
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	     <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">		    <span class="n">samples</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">j</span> <span class="o">+</span> <span class="n">positives</span><span class="p">.</span><span class="n">size</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">     <span class="c1">// 创建标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="n">Mat</span> <span class="n">labels</span><span class="p">(</span><span class="n">numberOfSamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">CV_32SC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// 正样本的标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="n">labels</span><span class="p">.</span><span class="n">rowRange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">positives</span><span class="p">.</span><span class="n">size</span><span class="p">())</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">     <span class="c1">// 负样本的标签
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>     <span class="n">labels</span><span class="p">.</span><span class="n">rowRange</span><span class="p">(</span><span class="n">positives</span><span class="p">.</span><span class="n">size</span><span class="p">(),</span> <span class="n">numberOfSamples</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 创建SVM分类器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ml</span><span class="o">::</span><span class="n">SVM</span><span class="o">&gt;</span> <span class="n">svm</span> <span class="o">=</span> <span class="n">ml</span><span class="o">::</span><span class="n">SVM</span><span class="o">::</span><span class="n">create</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">    <span class="n">svm</span><span class="o">-&gt;</span><span class="n">setType</span><span class="p">(</span><span class="n">ml</span><span class="o">::</span><span class="n">SVM</span><span class="o">::</span><span class="n">C_SVC</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="n">svm</span><span class="o">-&gt;</span><span class="n">setKernel</span><span class="p">(</span><span class="n">ml</span><span class="o">::</span><span class="n">SVM</span><span class="o">::</span><span class="n">LINEAR</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 准备训练数据
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">Ptr</span><span class="o">&lt;</span><span class="n">ml</span><span class="o">::</span><span class="n">TrainData</span><span class="o">&gt;</span> <span class="n">trainingData</span> <span class="o">=</span>
</span></span><span class="line"><span class="cl">    <span class="n">ml</span><span class="o">::</span><span class="n">TrainData</span><span class="o">::</span><span class="n">create</span><span class="p">(</span><span class="n">samples</span><span class="p">,</span> <span class="n">ml</span><span class="o">::</span><span class="n">SampleTypes</span><span class="o">::</span><span class="n">ROW_SAMPLE</span><span class="p">,</span> <span class="n">labels</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// SVM 训练
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">svm</span><span class="o">-&gt;</span><span class="n">train</span><span class="p">(</span><span class="n">trainingData</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">Mat</span> <span class="n">queries</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="n">featureSize</span><span class="p">,</span> <span class="n">CV_32FC1</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 每行填入查询描述子
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/stopSamples/stop08.png&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">),</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="n">queries</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">0</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">         <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/stopSamples/stop09.png&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">),</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	     <span class="n">queries</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">1</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">         <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/stopSamples/neg08.png&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">),</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">queries</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">2</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">        <span class="n">hogDesc</span><span class="p">.</span><span class="n">compute</span><span class="p">(</span><span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/stopSamples/neg09.png&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">),</span> <span class="n">desc</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">featureSize</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">queries</span><span class="p">.</span><span class="n">ptr</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">)[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">desc</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="n">Mat</span> <span class="n">predictions</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1">// 测试分类器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="n">svm</span><span class="o">-&gt;</span><span class="n">predict</span><span class="p">(</span><span class="n">queries</span><span class="p">,</span> <span class="n">predictions</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="mi">4</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	    <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;query: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">i</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;: &#34;</span> <span class="o">&lt;&lt;</span> <span class="p">((</span><span class="n">predictions</span><span class="p">.</span><span class="n">at</span><span class="o">&lt;</span><span class="kt">float</span><span class="o">&gt;</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">?</span> <span class="s">&#34;Negative&#34;</span> <span class="o">:</span> <span class="s">&#34;Positive&#34;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// 行人检测
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">Mat</span> <span class="n">myImage</span> <span class="o">=</span> <span class="n">imread</span><span class="p">(</span><span class="s">&#34;./images/person.jpg&#34;</span><span class="p">,</span> <span class="n">IMREAD_GRAYSCALE</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="c1">// 创建检测器
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">vector</span><span class="o">&lt;</span><span class="n">Rect</span><span class="o">&gt;</span> <span class="n">peoples</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="n">HOGDescriptor</span> <span class="n">peopleHog</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="n">peopleHog</span><span class="p">.</span><span class="n">setSVMDetector</span><span class="p">(</span><span class="n">HOGDescriptor</span><span class="o">::</span><span class="n">getDefaultPeopleDetector</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">   <span class="c1">// 检测图像中的行人
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">peopleHog</span><span class="p">.</span><span class="n">detectMultiScale</span><span class="p">(</span><span class="n">myImage</span><span class="p">,</span> <span class="c1">// 输入图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="n">peoples</span><span class="p">,</span> <span class="c1">// 输出矩形列表 
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="mi">0</span><span class="p">,</span>       <span class="c1">// 判断检测结果是否有效的阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="n">Size</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>       <span class="c1">// 窗口步长
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="n">Size</span><span class="p">(</span><span class="mi">32</span><span class="p">,</span> <span class="mi">32</span><span class="p">),</span>     <span class="c1">// 填充图像
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="mf">1.1</span><span class="p">,</span>              <span class="c1">// 缩放比列
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>	                          <span class="mi">2</span><span class="p">);</span>               <span class="c1">// 分组阈值
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>
</span></span><span class="line"><span class="cl">   <span class="c1">// draw detections on image
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>   <span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&#34;Number of peoples detected: &#34;</span> <span class="o">&lt;&lt;</span> <span class="n">peoples</span><span class="p">.</span><span class="n">size</span><span class="p">()</span> <span class="o">&lt;&lt;</span> <span class="n">endl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">   <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">peoples</span><span class="p">.</span><span class="n">size</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">	  <span class="n">rectangle</span><span class="p">(</span><span class="n">myImage</span><span class="p">,</span> <span class="n">peoples</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">Scalar</span><span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">,</span> <span class="mi">255</span><span class="p">),</span> <span class="mi">2</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">   <span class="n">imshow</span><span class="p">(</span><span class="s">&#34;People detection&#34;</span><span class="p">,</span> <span class="n">myImage</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">	<span class="n">waitKey</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">	<span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div></div><div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>更新于 2019-03-28</span>
            </div></div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share">
                <span><a href="javascript:void(0);" title="分享到 微博" data-sharer="weibo" data-url="https://gsscsd.github.io/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/" data-title="OpenCV计算机视觉编程攻略"><i class="fab fa-weibo fa-fw" aria-hidden="true"></i></a><a href="javascript:void(0);" title="分享到 百度" data-sharer="baidu" data-url="https://gsscsd.github.io/opencv%E8%AE%A1%E7%AE%97%E6%9C%BA%E8%A7%86%E8%A7%89%E7%BC%96%E7%A8%8B%E6%94%BB%E7%95%A5/" data-title="OpenCV计算机视觉编程攻略"><i data-svg-src="https://cdn.jsdelivr.net/npm/simple-icons@7.0.0/icons/baidu.svg" aria-hidden="true"></i></a></span>
            </div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw" aria-hidden="true"></i>&nbsp;<a href="/tags/opencv/">opencv</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="window.history.back();">返回</a></span>&nbsp;|&nbsp;<span><a href="/">主页</a></span>
        </section>
    </div>

    <div class="post-nav"><a href="/opencv%E4%B9%8Bpractice/" class="prev" rel="prev" title="OpenCV之Practice"><i class="fas fa-angle-left fa-fw" aria-hidden="true"></i>OpenCV之Practice</a>
            <a href="/%E5%89%91%E6%8C%87offer%E4%B9%8B%E6%97%8B%E8%BD%AC%E6%95%B0%E7%BB%84%E7%9A%84%E6%9C%80%E5%B0%8F%E6%95%B0%E5%AD%97/" class="next" rel="next" title="剑指Offer之旋转数组的最小数字">剑指Offer之旋转数组的最小数字<i class="fas fa-angle-right fa-fw" aria-hidden="true"></i></a></div>
</div>
<div id="comments"><div id="valine" class="comment"></div><noscript>
                Please enable JavaScript to view the comments powered by <a href="https://valine.js.org/">Valine</a>.
            </noscript></div></article></div>
            </main><footer class="footer">
        <div class="footer-container"><div class="footer-line">由 <a href="https://gohugo.io/" target="_blank" rel="noopener noreffer" title="Hugo 0.101.0">Hugo</a> 强力驱动 | 主题 - <a href="https://github.com/dillonzq/LoveIt" target="_blank" rel="noopener noreffer" title="LoveIt 0.2.11"><i class="far fa-kiss-wink-heart fa-fw" aria-hidden="true"></i> LoveIt</a>
                </div><div class="footer-line" itemscope itemtype="http://schema.org/CreativeWork"><i class="far fa-copyright fa-fw" aria-hidden="true"></i><span itemprop="copyrightYear">2019 - 2022</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="/" target="_blank">Gsscsd</a></span></div>
        </div>
    </footer></div>

        <div id="fixed-buttons"><a href="#" id="back-to-top" class="fixed-button" title="回到顶部">
                <i class="fas fa-arrow-up fa-fw" aria-hidden="true"></i>
            </a><a href="#" id="view-comments" class="fixed-button" title="查看评论">
                <i class="fas fa-comment fa-fw" aria-hidden="true"></i>
            </a>
        </div><link rel="stylesheet" href="/lib/valine/valine.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.css"><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/valine@1.5.0/dist/Valine.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/autocomplete.js@0.38.1/dist/autocomplete.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lunr@2.3.9/lunr.min.js"></script><script type="text/javascript" src="/lib/lunr/lunr.stemmer.support.min.6867e554c019e9277423b0f08fa2f10633c0b4a2e736319d9fe99f73a35a205705d41b0fa3615656587f72e0f073de501a6fc69f66f2aa479482864f959af053.js" integrity="sha512-aGflVMAZ6Sd0I7Dwj6LxBjPAtKLnNjGdn+mfc6NaIFcF1BsPo2FWVlh/cuDwc95QGm/Gn2byqkeUgoZPlZrwUw=="></script><script type="text/javascript" src="/lib/lunr/lunr.zh.min.918bdd059e2c518e24c32fb5fd89144a49778f21f2166db93bf1e2ed311b3589660feb5777210257aee209f6d8bdde8c296883e34ff8bf4d5338f4be53132976.js" integrity="sha512-kYvdBZ4sUY4kwy+1/YkUSkl3jyHyFm25O/Hi7TEbNYlmD+tXdyECV67iCfbYvd6MKWiD40/4v01TOPS+UxMpdg=="></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lazysizes@5.3.2/lazysizes.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.11/dist/clipboard.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.5.1/sharer.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/katex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/auto-render.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/copy-tex.min.js"></script><script type="text/javascript" src="https://cdn.jsdelivr.net/npm/katex@0.16.0/dist/contrib/mhchem.min.js"></script><script type="text/javascript">window.config={"code":{"copyTitle":"复制到剪贴板","maxShownLines":50},"comment":{"valine":{"appId":"QGzwQXOqs5JOhN4RGPOkR2mR-MdYXbMMI","appKey":"WBmoGyJtbqUswvfLh6L8iEBr","avatar":"mp","el":"#valine","emojiCDN":"https://cdn.jsdelivr.net/npm/emoji-datasource-google@14.0.0/img/google/64/","emojiMaps":{"100":"1f4af.png","alien":"1f47d.png","anger":"1f4a2.png","angry":"1f620.png","anguished":"1f627.png","astonished":"1f632.png","black_heart":"1f5a4.png","blue_heart":"1f499.png","blush":"1f60a.png","bomb":"1f4a3.png","boom":"1f4a5.png","broken_heart":"1f494.png","brown_heart":"1f90e.png","clown_face":"1f921.png","cold_face":"1f976.png","cold_sweat":"1f630.png","confounded":"1f616.png","confused":"1f615.png","cry":"1f622.png","crying_cat_face":"1f63f.png","cupid":"1f498.png","dash":"1f4a8.png","disappointed":"1f61e.png","disappointed_relieved":"1f625.png","dizzy":"1f4ab.png","dizzy_face":"1f635.png","drooling_face":"1f924.png","exploding_head":"1f92f.png","expressionless":"1f611.png","face_vomiting":"1f92e.png","face_with_cowboy_hat":"1f920.png","face_with_hand_over_mouth":"1f92d.png","face_with_head_bandage":"1f915.png","face_with_monocle":"1f9d0.png","face_with_raised_eyebrow":"1f928.png","face_with_rolling_eyes":"1f644.png","face_with_symbols_on_mouth":"1f92c.png","face_with_thermometer":"1f912.png","fearful":"1f628.png","flushed":"1f633.png","frowning":"1f626.png","ghost":"1f47b.png","gift_heart":"1f49d.png","green_heart":"1f49a.png","grimacing":"1f62c.png","grin":"1f601.png","grinning":"1f600.png","hankey":"1f4a9.png","hear_no_evil":"1f649.png","heart":"2764-fe0f.png","heart_decoration":"1f49f.png","heart_eyes":"1f60d.png","heart_eyes_cat":"1f63b.png","heartbeat":"1f493.png","heartpulse":"1f497.png","heavy_heart_exclamation_mark_ornament":"2763-fe0f.png","hole":"1f573-fe0f.png","hot_face":"1f975.png","hugging_face":"1f917.png","hushed":"1f62f.png","imp":"1f47f.png","innocent":"1f607.png","japanese_goblin":"1f47a.png","japanese_ogre":"1f479.png","joy":"1f602.png","joy_cat":"1f639.png","kiss":"1f48b.png","kissing":"1f617.png","kissing_cat":"1f63d.png","kissing_closed_eyes":"1f61a.png","kissing_heart":"1f618.png","kissing_smiling_eyes":"1f619.png","laughing":"1f606.png","left_speech_bubble":"1f5e8-fe0f.png","love_letter":"1f48c.png","lying_face":"1f925.png","mask":"1f637.png","money_mouth_face":"1f911.png","nauseated_face":"1f922.png","nerd_face":"1f913.png","neutral_face":"1f610.png","no_mouth":"1f636.png","open_mouth":"1f62e.png","orange_heart":"1f9e1.png","partying_face":"1f973.png","pensive":"1f614.png","persevere":"1f623.png","pleading_face":"1f97a.png","pouting_cat":"1f63e.png","purple_heart":"1f49c.png","rage":"1f621.png","relaxed":"263a-fe0f.png","relieved":"1f60c.png","revolving_hearts":"1f49e.png","right_anger_bubble":"1f5ef-fe0f.png","robot_face":"1f916.png","rolling_on_the_floor_laughing":"1f923.png","scream":"1f631.png","scream_cat":"1f640.png","see_no_evil":"1f648.png","shushing_face":"1f92b.png","skull":"1f480.png","skull_and_crossbones":"2620-fe0f.png","sleeping":"1f634.png","sleepy":"1f62a.png","slightly_frowning_face":"1f641.png","slightly_smiling_face":"1f642.png","smile":"1f604.png","smile_cat":"1f638.png","smiley":"1f603.png","smiley_cat":"1f63a.png","smiling_face_with_3_hearts":"1f970.png","smiling_imp":"1f608.png","smirk":"1f60f.png","smirk_cat":"1f63c.png","sneezing_face":"1f927.png","sob":"1f62d.png","space_invader":"1f47e.png","sparkling_heart":"1f496.png","speak_no_evil":"1f64a.png","speech_balloon":"1f4ac.png","star-struck":"1f929.png","stuck_out_tongue":"1f61b.png","stuck_out_tongue_closed_eyes":"1f61d.png","stuck_out_tongue_winking_eye":"1f61c.png","sunglasses":"1f60e.png","sweat":"1f613.png","sweat_drops":"1f4a6.png","sweat_smile":"1f605.png","thinking_face":"1f914.png","thought_balloon":"1f4ad.png","tired_face":"1f62b.png","triumph":"1f624.png","two_hearts":"1f495.png","unamused":"1f612.png","upside_down_face":"1f643.png","weary":"1f629.png","white_frowning_face":"2639-fe0f.png","white_heart":"1f90d.png","wink":"1f609.png","woozy_face":"1f974.png","worried":"1f61f.png","yawning_face":"1f971.png","yellow_heart":"1f49b.png","yum":"1f60b.png","zany_face":"1f92a.png","zipper_mouth_face":"1f910.png","zzz":"1f4a4.png"},"enableQQ":false,"highlight":true,"lang":"zh-CN","pageSize":10,"placeholder":"你的评论 ...","recordIP":true,"serverURLs":"https://leancloud.hugoloveit.com","visitor":true}},"math":{"delimiters":[{"display":true,"left":"$$","right":"$$"},{"display":true,"left":"\\[","right":"\\]"},{"display":true,"left":"\\begin{equation}","right":"\\end{equation}"},{"display":true,"left":"\\begin{equation*}","right":"\\end{equation*}"},{"display":true,"left":"\\begin{align}","right":"\\end{align}"},{"display":true,"left":"\\begin{align*}","right":"\\end{align*}"},{"display":true,"left":"\\begin{alignat}","right":"\\end{alignat}"},{"display":true,"left":"\\begin{alignat*}","right":"\\end{alignat*}"},{"display":true,"left":"\\begin{gather}","right":"\\end{gather}"},{"display":true,"left":"\\begin{CD}","right":"\\end{CD}"},{"display":false,"left":"$","right":"$"},{"display":false,"left":"\\(","right":"\\)"}],"strict":false},"search":{"highlightTag":"em","lunrIndexURL":"/index.json","lunrLanguageCode":"zh","lunrSegmentitURL":"/lib/lunr/lunr.segmentit.js","maxResultLength":10,"noResultsFound":"没有找到结果","snippetLength":50,"type":"lunr"}};</script><script type="text/javascript" src="/js/theme.min.8f3907fa55b08d1250417a302a5836b4095aeba0e8de276226fbabed0058c004aec93be43d27a90cb1c7b80dffd331535aae064d507b1c9f140b42edb18d7d90.js" integrity="sha512-jzkH+lWwjRJQQXowKlg2tAla66Do3idiJvur7QBYwASuyTvkPSepDLHHuA3/0zFTWq4GTVB7HJ8UC0LtsY19kA=="></script></body>
</html>
